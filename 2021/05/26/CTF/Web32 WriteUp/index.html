<!DOCTYPE html><html lang="cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><title>Web33 WriteUp • Webb</title><meta name="description" content="Web33 WriteUp - Webb"><link rel="icon" href="/57182600.jpeg"><link rel="stylesheet" href="https://unpkg.com/nanoreset@3.0.1/nanoreset.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="Webb"><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Webb" type="application/atom+xml">
</head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/" title="Webb"><img class="logo-image" src="/57182600.jpeg" alt="logo"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/" target="_self">主页</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/about" target="_self">关于</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/works" target="_self">作品</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/archives" target="_self">档案</a></li><li class="nav-list-item"></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Web33 WriteUp</h1><div class="post-info"><a></a>2021-05-26</div><div class="post-content"><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p><img src="/../../images/Web32%20WriteUp/index.png" alt="index.png"></p>
<h3 id="加密代码："><a href="#加密代码：" class="headerlink" title="加密代码："></a>加密代码：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params">data,key</span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     key = <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;ISCC&#x27;</span>);x = <span class="number">0</span>;</span><br><span class="line">     len = <span class="title function_ invoke__">strlen</span>(data);</span><br><span class="line">     klen = <span class="title function_ invoke__">strlen</span>(key);</span><br><span class="line">     <span class="keyword">for</span> (i=<span class="number">0</span>;i &lt; len;i++) &#123; </span><br><span class="line">         <span class="keyword">if</span> (x ==klen)</span><br><span class="line">        &#123;</span><br><span class="line">            x = <span class="number">0</span>;</span><br><span class="line">        &#125;char .= key[x];</span><br><span class="line">        x+=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;len; i++) &#123;str .= <span class="title function_ invoke__">chr</span>((<span class="title function_ invoke__">ord</span>(data[i]) + <span class="title function_ invoke__">ord</span>(char[i])) % <span class="number">128</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$str</span>);</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>$key = md5(&#39;ISCC&#39;);</code> 这里的key&#x3D;729623334f0aa2784a1599fd374c120d。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>;i &lt; len;i++) &#123; </span><br><span class="line">    <span class="keyword">if</span> (x ==klen)</span><br><span class="line">     &#123;</span><br><span class="line">         x = <span class="number">0</span>;</span><br><span class="line">     &#125;char .= key[x];</span><br><span class="line">     x+=<span class="number">1</span>;</span><br><span class="line">&#125; <span class="comment">// 根据用户传入的data长度执行循环，并且根据x的值在key提取字符串给$char。</span></span><br></pre></td></tr></table></figure>

<ul>
<li>上面的代码都不是重点。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>;i &lt; len;i++) &#123;</span><br><span class="line">    str .= <span class="title function_ invoke__">chr</span>((<span class="title function_ invoke__">ord</span>(data[i]) + <span class="title function_ invoke__">ord</span>(char[<span class="variable">$i</span>])) % <span class="number">128</span>);</span><br><span class="line">&#125; <span class="comment">// 这里的for循环和上方的for循环一模一样，主要需要我们解密的代码在18行。</span></span><br></pre></td></tr></table></figure>

<ul>
<li>根据i为索引在data中提取出一个字符然后转换为int型，在加上char中提取出来的int型数据余上128，然后再将得出来的结果转换成char类型并拼接到str中。</li>
</ul>
<p><strong>例如：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;a&#x27;</span>=<span class="number">97</span>, <span class="string">&#x27;7&#x27;</span>=<span class="number">55</span></span><br><span class="line"><span class="title function_ invoke__">chr</span>((<span class="title function_ invoke__">ord</span>(<span class="string">&#x27;a&#x27;</span>) + <span class="title function_ invoke__">ord</span>(<span class="string">&#x27;7&#x27;</span>)) % <span class="number">128</span>)</span><br><span class="line"><span class="title function_ invoke__">chr</span>((<span class="number">97</span> + <span class="number">55</span>) % <span class="number">128</span>)</span><br><span class="line"><span class="title function_ invoke__">chr</span>((<span class="number">97</span> + <span class="number">55</span>) % <span class="number">128</span>)</span><br><span class="line"><span class="title function_ invoke__">chr</span>((<span class="number">97</span> + <span class="number">55</span>) % <span class="number">128</span>)</span><br><span class="line"><span class="title function_ invoke__">chr</span>(<span class="number">152</span>%<span class="number">128</span>)</span><br><span class="line"><span class="title function_ invoke__">chr</span>(<span class="number">24</span>)</span><br><span class="line"><span class="number">24</span>=<span class="string">&#x27;取消&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>为什么要余上128?<ul>
<li>答：因为ascii表一共只有128个，如果超出去无法让int型转化成char型。</li>
</ul>
</li>
<li><code>20| return base64_encode($str);</code> 将循环结束后的结果进行base64编码并返回给用户。</li>
</ul>
<h3 id="解密代码："><a href="#解密代码：" class="headerlink" title="解密代码："></a>解密代码：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="title function_ invoke__">decrypt</span>(<span class="string">&quot;GA==&quot;</span>);</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">decrypt</span>(<span class="params">data</span>)</span></span><br><span class="line"><span class="function"> </span>&#123;data = <span class="title function_ invoke__">base64_decode</span>(data);key = <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;ISCC&#x27;</span>);</span><br><span class="line">     x = <span class="number">0</span>;len = <span class="title function_ invoke__">strlen</span>(data);klen = <span class="title function_ invoke__">strlen</span>(key);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == klen) &#123;x = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        char .=key[x];x += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>;i &lt; len;i++) &#123;</span><br><span class="line">        result = <span class="title function_ invoke__">ord</span>(data[i]) - <span class="title function_ invoke__">ord</span>(char[i]);</span><br><span class="line">           <span class="keyword">if</span> (result &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">           str .= <span class="title function_ invoke__">chr</span>(result);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           str .= <span class="title function_ invoke__">chr</span>(result + <span class="number">128</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;str = <span class="subst">$str</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>5| data = base64_decode(data);</code> 先把base64加密的数据进行解密，解密出来的int型数据为24，char类型数据为’取消’。</li>
<li><code>6| $key = md5(&#39;ISCC&#39;);</code> 这里和加解密的key都是一样的。key&#x3D;729623334f0aa2784a1599fd374c120d</li>
<li>其他的代码都是和加密代码一致。</li>
<li>重点在这里。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]) - <span class="title function_ invoke__">ord</span>(<span class="variable">$char</span>[<span class="variable">$i</span>]);</span><br><span class="line"> <span class="keyword">if</span> (<span class="variable">$result</span> &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">   <span class="variable">$str</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$result</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="variable">$str</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$result</span> + <span class="number">128</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>第20行用data[i]-char[i]&#x3D;原来的数，如果&gt;&#x3D;0那么就可以直接输出字符，如果&lt;&#x3D;0的话在ASCII表中是不存在所有我们需要加上128。</p>
<p>data[i]&#x3D;’取消’&#x3D;24，char[i]&#x3D;’7’&#x3D;55。</p>
<p>第21行判断result是否大于等于0，如果大于等于零就跳转到第22行，如果不是就跳转到第24行。</p>
<p>第22行将result变量的值转换成char型并字符串拼接到str中。</p>
<p>第24行将result变量值小于0的值+128变成ASCII表中存在的数值，并将int型的数据转换成char型数据并把字符串拼接到str中。</p>
<p>这里的result&#x3D;-31很明显它是要跳转到第24行。</p>
<p>结果：-32+128&#x3D;97&#x3D;‘a’</p>
</blockquote>
<ul>
<li>把GA替换成题目中的描述就可以得到flag。</li>
</ul>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2021/10/26/SQL/SQLi-LABS/">prev</a></div><div class="copyright"><p>&copy; 2022 <a href="http://webb-l.top">Webb</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script></body></html>